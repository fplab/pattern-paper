\section{Normal Match Constraint Language}
$\arraycolsep=4pt\begin{array}{lll}
\xi & ::= &
  \ctruth ~\vert~
  \cfalsity ~\vert~
  \cnum{n} ~\vert~
  \cnotnum{n} ~\vert~
  \cand{\xi_1}{\xi_2} ~\vert~
  \cor{\xi_1}{\xi_2} ~\vert~
  \cinl{\xi} ~\vert~
  \cinr{\xi} ~\vert~
  \cpair{\xi_1}{\xi_2}
\end{array}$

\judgboxa{\ctyp{\xi}{\tau}}{$\xi$ constrains final expressions of type $\tau$}
\begin{subequations}\label{rules:CCTyp}
\begin{equation}\label{rule:CCTTruth}
\inferrule[CTTruth]{ }{
  \ctyp{\ctruth}{\tau}
}
\end{equation}
\begin{equation}\label{rule:CCTFalsity}
\inferrule[CTFalsity]{ }{
  \ctyp{\cfalsity}{\tau}
}
\end{equation}
\begin{equation}\label{rule:CCTNum}
\inferrule[CTNum]{ }{
  \ctyp{\cnum{n}}{\tnum}
}
\end{equation}
\begin{equation}\label{rule:CCTNotNum}
\inferrule[CTNotNum]{ }{
  \ctyp{\cnotnum{n}}{\tnum}
}
\end{equation}
\begin{equation}\label{rule:CCTAnd}
\inferrule[CTAnd]{
  \ctyp{\xi_1}{\tau} \\ \ctyp{\xi_2}{\tau}
}{
  \ctyp{\cand{\xi_1}{\xi_2}}{\tau}
}
\end{equation}
\begin{equation}\label{rule:CCTOr}
\inferrule[CTOr]{
  \ctyp{\xi_1}{\tau} \\ \ctyp{\xi_2}{\tau}
}{
  \ctyp{\cor{\xi_1}{\xi_2}}{\tau}
}
\end{equation}
\begin{equation}\label{rule:CCTInl}
\inferrule[CTInl]{
  \ctyp{\xi_1}{\tau_1}
}{
  \ctyp{\cinl{\xi_1}}{\tsum{\tau_1}{\tau_2}}
}
\end{equation}
\begin{equation}\label{rule:CCTInr}
\inferrule[CTInr]{
  \ctyp{\xi_2}{\tau_2}
}{
  \ctyp{\cinr{\xi_2}}{\tsum{\tau_1}{\tau_2}}
}
\end{equation}
\begin{equation}\label{rule:CCTPair}
\inferrule[CTPair]{
  \ctyp{\xi_1}{\tau_1} \\ \ctyp{\xi_2}{\tau_2}
}{
  \ctyp{\cpair{\xi_1}{\xi_2}}{\tprod{\tau_1}{\tau_2}}
}
\end{equation}
\end{subequations}

\judgboxa{\cdual{\xi_1} = \xi_2}{dual of $\xi_1$ is $\xi_2$}
\begin{subequations}\label{defn:dual}
\begin{align*}
  \cdual{\ctruth} &= \cfalsity \\
  \cdual{\cfalsity} &= \ctruth \\
  \cdual{\cnum{n}} &= \cnotnum{n} \\
  \cdual{\cnotnum{n}} &= \cnum{n} \\
  \cdual{\cand{\xi_1}{\xi_2}} &= \cor{\cdual{\xi_1}}{\cdual{\xi_2}} \\
  \cdual{\cor{\xi_1}{\xi_2}} &= \cand{\cdual{\xi_1}}{\cdual{\xi_2}} \\
  \cdual{\cinl{\xi_1}} &= \cor{ \cinl{\cdual{\xi_1}} }{ \cinr{\ctruth} } \\
  \cdual{\cinr{\xi_2}} &= \cor{ \cinr{\cdual{\xi_2}} }{ \cinl{\ctruth} } \\
  \cdual{\cpair{\xi_1}{\xi_2}} &=
  \cor{ \cor{ 
    \cpair{\xi_1}{\cdual{\xi_2}}
  }{
    \cpair{\cdual{\xi_1}}{\xi_2}
  }}{
    \cpair{\cdual{\xi_1}}{\cdual{\xi_2}}
  } \\
  \cdual{\cdual{\xi}} &= \xi
\end{align*}
\end{subequations}

\judgboxa{\ccsatisfy{e}{\xi}}{$e$ satisfies $\xi$}
\begin{subequations}\label{rules:cSatisfy}
\begin{equation}\label{rule:CCSTruth}
\inferrule[CSTruth]{ }{
  \ccsatisfy{e}{\ctruth}
}
\end{equation}
\begin{equation}\label{rule:CCSNum}
\inferrule[CSNum]{ }{
  \ccsatisfy{\hnum{n}}{\cnum{n}}
}
\end{equation}
\begin{equation}\label{rule:CCSNotNum}
\inferrule[CSNotNum]{
  n_1 \neq n_2
}{
  \ccsatisfy{\hnum{n_1}}{\cnotnum{n_2}}
}
\end{equation}
\begin{equation}\label{rule:CCSAnd}
\inferrule[CSAnd]{
  \ccsatisfy{e}{\xi_1} \\
  \ccsatisfy{e}{\xi_2}
}{
  \ccsatisfy{e}{\cand{\xi_1}{\xi_2}}
}
\end{equation}
\begin{equation}\label{rule:CCSOr1}
\inferrule[CSOrL]{
  \ccsatisfy{e}{\xi_1}
}{
  \ccsatisfy{e}{\cor{\xi_1}{\xi_2}}
}
\end{equation}
\begin{equation}\label{rule:CCSOr2}
\inferrule[CSOrR]{
  \ccsatisfy{e}{\xi_2}
}{
  \ccsatisfy{e}{\cor{\xi_1}{\xi_2}}
}
\end{equation}
\begin{equation}\label{rule:CCSInl}
\inferrule[CSInl]{
  \ccsatisfy{e_1}{\xi_1}
}{
  \ccsatisfy{
    \hinl{\tau_2}{e_1}
  }{
    \cinl{\xi_1}
  }
}
\end{equation}
\begin{equation}\label{rule:CCSInr}
\inferrule[CSInr]{
  \ccsatisfy{e_2}{\xi_2}
}{
  \ccsatisfy{
    \hinr{\tau_1}{e_2}
  }{
    \cinr{\xi_2}
  }
}
\end{equation}
\begin{equation}\label{rule:CCSPair}
\inferrule[CSPair]{
  \ccsatisfy{e_1}{\xi_1} \\
  \ccsatisfy{e_2}{\xi_2}
}{
\ccsatisfy{\hpair{e_1}{e_2}}{\cpair{\xi_1}{\xi_2}}
}
\end{equation}
\end{subequations}

\begin{lemma}
  \label{lem:notsatisfy-dual}
  Assume $\isVal{e}$. Then $\ccnotsatisfy{e}{\xi}$ iff $\ccsatisfy{e}{\cdual{\xi}}$.
\end{lemma}

\begin{theorem}[Exclusiveness of Satisfaction Judgment]
  \label{thrm:exclusive-complete-constraint-satisfaction}
  If $\ctyp{\xi}{\tau}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isVal{e}$ then exactly one of the following holds
  \begin{enumerate}
    \item $\ccsatisfy{e}{\xi}$
    \item $\ccsatisfy{e}{\cdual{\xi}}$
  \end{enumerate}
\end{theorem}
\begin{proof}
\end{proof}

\begin{definition}[Entailment of Constraints]
  \label{defn:complete-constraint-entailment}
  Suppose that $\ctyp{\xi_1}{\tau}$ and $\ctyp{\xi_2}{\tau}$.
  Then $\ccsatisfy{\xi_1}{\xi_2}$ iff for all $e$ such that $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isVal{e}$ we have $\ccsatisfy{e}{\xi_1}$ implies $\ccsatisfy{e}{\xi_2}$
\end{definition}

\subsection{Relationship with Incomplete Constraint Language}

\begin{lemma}
  \label{lem:val-satisfy-truify}
  Assume that $\isVal{e}$. Then $\csatisfyormay{e}{\hxi}$ iff $\ccsatisfy{e}{\ctruify{\hxi}}$.
\end{lemma}
\begin{proof}\mbox{}\\
  We prove sufficiency and necessity separately.
  \begin{enumerate}
    \item Sufficiency:
      \begin{pfsteps}
      \item \isVal{e} \BY{assumption} \pflabel{val}
      \item \csatisfyormay{e}{\hxi} \BY{assumption} \pflabel{satormay}
      \end{pfsteps}
      By rule induction over Rules (\ref{rules:satormay}) on \pfref{satormay}.
      \begin{byCases}

      \savelocalsteps{1}
      \item[\text{(\ref{rule:CSMSSat})}]
        \begin{pfsteps*}
        \item $\csatisfy{e}{\hxi}$ \BY{assumption} \pflabel{satisfy}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:Satisfy} on \pfref{satisfy}.
        \begin{byCases}
          \savelocalsteps{2}
          \item[\text{(\ref{rule:CSTruth})}]
          \begin{pfsteps}
          \item \hxi = \ctruth \BY{assumption}
          \item \ctruify{\hxi} = \ctruth \BY{\autoref{defn:truify}}
          \item \ccsatisfy{e}{\ctruth} \BY{\ruleref{rule:CCSTruth}}
          \end{pfsteps} 
          \restorelocalsteps{2} 
          \item[\text{(\ref{rule:CSNum})}] 
          \begin{pfsteps}
          \item e = \hnum{n} \BY{assumption}
          \item \hxi = \cnum{n} \BY{assumption}
          \item \ctruify{\cnum{n}} = \cnum{n} \BY{\autoref{defn:truify}}
          \item \ccsatisfy{e}{\cnum{n}} \BY{\ruleref{rule:CCSNum}}
          \end{pfsteps} 
          \restorelocalsteps{2} 
          \item[\text{(\ref{rule:CSInl})}]
          \begin{pfsteps}
          \item e = \hinl{\tau_2}{e_1} \BY{assumption}
          \item \hxi = \cinl{\hxi_1} \BY{assumption}
          \item \csatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[inl]satisfy1}
          \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on \pfref{[inl]satisfy1}} \pflabel{[inl]satormay1}
          \item \ctruify{\cinl{\hxi_1}} = \cinl{\ctruify{\hxi_1}} \BY{\autoref{defn:truify}}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:VInl})}]
            \begin{pfsteps}
            \item \isVal{e_1} \BY{assumption} \pflabel{[inl]val1}
            \item \ccsatisfy{e_1}{\ctruify{\hxi_1}} \BY{IH on \pfref{[inl]val1} and \pfref{[inl]satormay1}} \pflabel{[inl]ccsat1}
            \item \ccsatisfy{\hinl{\tau_2}{e_1}}{\cinl{\ctruify{\hxi_1}}} \BY{\ruleref{rule:CCSInl} on \pfref{[inl]ccsat1}}
            \end{pfsteps}    
          \end{byCases}
          \restorelocalsteps{2} 
          \item[\text{(\ref{rule:CSInr})}]
          \begin{pfsteps}
          \item e = \hinr{\tau_1}{e_2} \BY{assumption}
          \item \hxi = \cinr{\hxi_2} \BY{assumption}
          \item \csatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[inr]satisfy2}
          \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on \pfref{[inr]satisfy2}} \pflabel{[inr]satormay2}
          \item \ctruify{\cinr{\hxi_2}} = \cinr{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:VInr})}]
            \begin{pfsteps}
            \item \isVal{e_2} \BY{assumption} \pflabel{[inr]val2}
            \item \ccsatisfy{e_2}{\ctruify{\hxi_2}} \BY{IH on \pfref{[inr]val2} and \pfref{[inr]satormay2}} \pflabel{[inr]ccsat2}
            \item \ccsatisfy{\hinr{\tau_1}{e_2}}{\cinr{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CCSInr} on \pfref{[inr]ccsat2}}
            \end{pfsteps}    
          \end{byCases}
          \restorelocalsteps{2} 
          \item[\text{(\ref{rule:CSPair})}]
          \begin{pfsteps}
          \item e = \hpair{e_1}{e_2} \BY{assumption}
          \item \hxi = \cpair{\hxi_1}{\hxi_2} \BY{assumption}
          \item \csatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[pair]satisfy1}
          \item \csatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[pair]satisfy2}
          \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on \pfref{[pair]satisfy1}} \pflabel{[pair]satormay1}
          \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on \pfref{[pair]satisfy2}} \pflabel{[pair]satormay2}
          \item \ctruify{\cpair{\hxi_1}{\hxi_2}} = \cpair{\ctruify{\hxi_1}}{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:VPair})}]
            \begin{pfsteps}
            \item \isVal{e_1} \BY{assumption} \pflabel{[pair]val1}
            \item \isVal{e_2} \BY{assumption} \pflabel{[pair]val2}
            \item \ccsatisfy{e_1}{\ctruify{\hxi_1}} \BY{IH on \pfref{[pair]val1} and \pfref{[pair]satormay1}} \pflabel{[pair]ccsat1}
            \item \ccsatisfy{e_2}{\ctruify{\hxi_2}} \BY{IH on \pfref{[pair]val2} and \pfref{[pair]satormay2}} \pflabel{[pair]ccsat2}
            \item \ccsatisfy{\hpair{e_1}{e_2}}{\cpair{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CCSPair} on \pfref{[pair]ccsat1} and \pfref{[pair]ccsat2}}
            \end{pfsteps}    
          \end{byCases}
          \restorelocalsteps{2} 
          \item[\text{(\ref{rule:CSNotIntroPair})}]
          \begin{pfsteps}
          \item \notIntro{e} \BY{assumption}
          \end{pfsteps} 
          Contradicts \pfref{val} by \autoref{lem:val-not-notintro}.
          \restorelocalsteps{2} 
          \item[\text{(\ref{rule:CSOr1})}]
          \begin{pfsteps}
          \item \hxi = \cor{\hxi_1}{\hxi_2} \BY{assumption}
          \item \csatisfy{e}{\hxi_1} \BY{assumption} \pflabel{[or1]sat1}
          \item \csatisfyormay{e}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on \pfref{[or1]sat1}} \pflabel{[or1]satormay1}
          \item \ctruify{\cor{\hxi_1}{\hxi_2}} = \cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \item \ccsatisfy{e}{\ctruify{\hxi_1}} \BY{IH on \pfref{val} and \pfref{[or1]satormay1}} \pflabel{[or1]ccsat1}
          \item \ccsatisfy{e}{\cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CCSOr1} on \pfref{[or1]ccsat1}}
          \end{pfsteps} 
          \restorelocalsteps{2} 
          \item[\text{(\ref{rule:CSOr2})}]
          \begin{pfsteps}
          \item \hxi = \cor{\hxi_1}{\hxi_2} \BY{assumption}
          \item \csatisfy{e}{\hxi_2} \BY{assumption} \pflabel{[or2]sat2}
          \item \csatisfyormay{e}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on \pfref{[or2]sat2}} \pflabel{[or2]satormay2}
          \item \ctruify{\cor{\hxi_1}{\hxi_2}} = \cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \item \ccsatisfy{e}{\ctruify{\hxi_2}} \BY{IH on \pfref{val} and \pfref{[or2]satormay2}} \pflabel{[or2]ccsat2}
          \item \ccsatisfy{e}{\cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CCSOr2} on \pfref{[or2]ccsat2}}
          \end{pfsteps} 
        \end{byCases}
      
      \restorelocalsteps{1}
      \item[\text{(\ref{rule:CSMSMay})}]
        \begin{pfsteps*}
        \item $\cmaysatisfy{e}{\hxi}$ \BY{assumption} \pflabel{maysat}
        \end{pfsteps*}
        By rule induction over Rules (\ref{rules:MaySatisfy}) on \pfref{maysat}.
        \begin{byCases}

        \savelocalsteps{2}
        \item[\text{(\ref{rule:CMSUnknown})}]
          \begin{pfsteps}
          \item \hxi=\cunknown \BY{assumption}
          \item \ctruify{\cunknown} = \ctruth \BY{\autoref{defn:truify}} 
          \item \ccsatisfy{e}{\ctruth} \BY{Rule (\ref{rule:CCSTruth})}
          \end{pfsteps}
        
        \restorelocalsteps{2} 
        \item[\text{(\ref{rule:CMSInl})}] 
          \begin{pfsteps}
          \item e = \hinl{\tau_2}{e_1} \BY{assumption}
          \item \hxi=\cinl{\hxi_1} \BY{assumption}
          \item \cmaysatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[inl1]maysat}
          \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSMay} on \pfref{[inl1]maysat}} \pflabel{[inl1]satormay}
          \item \ctruify{\cinl{\hxi_1}}=\cinl{\ctruify{\xi_1}} \BY{\autoref{defn:truify}}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:VInl})}]
            \begin{pfsteps}
            \item \isVal{e_1} \BY{assumption} \pflabel{[may][inl]val1}
            \item \ccsatisfy{e_1}{\ctruify{\hxi_1}} \BY{IH on \pfref{[may][inl]val1} and \pfref{[inl1]satormay}} \pflabel{[inl1]sat-truify}
            \item \ccsatisfy{\hinl{\tau_2}{e_1}}{\cinl{\ctruify{\hxi_1}}} \BY{\ruleref{rule:CSInl} on \pfref{[inl1]sat-truify}}
            \end{pfsteps}
          \end{byCases}
        
        \restorelocalsteps{2} 
        \item[\text{(\ref{rule:CMSInr})}] 
          \begin{pfsteps}
          \item e = \hinr{\tau_1}{e_2} \BY{assumption}
          \item \hxi=\cinr{\hxi_2} \BY{assumption}
          \item \cmaysatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[inr]maysat}
          \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSMay} on \pfref{[inr]maysat}} \pflabel{[inr]satormay}
          \item \ctruify{\cinr{\hxi_2}}=\cinr{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:VInr})}]
            \begin{pfsteps}
            \item \isVal{e_2} \BY{assumption} \pflabel{[may][inr]val2}
            \item \ccsatisfy{e_2}{\ctruify{\hxi_2}} \BY{IH on \pfref{[may][inr]val2} and \pfref{[inr]satormay}} \pflabel{[inr]sat-truify}
            \item \ccsatisfy{\hinr{\tau_1}{e_2}}{\cinr{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CSInr} on \pfref{[inr]sat-truify}}
            \end{pfsteps}
          \end{byCases}
        
        \restorelocalsteps{2} 
        \item[\text{(\ref{rule:CMSPair1})}] 
          \begin{pfsteps}
          \item e=\hpair{e_1}{e_2} \BY{assumption}
          \item \hxi=\cpair{\hxi_1}{\hxi_2} \BY{assumption}
          \item \cmaysatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[pair1]maysat1}
          \item \csatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[pair1]satisfy2}
          \item \ctruify{\hxi}=\cpair{\ctruify{\hxi_1}}{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSMay} on \pfref{[pair1]maysat1}} \pflabel{[pair1]satormay1}
          \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on \pfref{[pair1]satisfy2}} \pflabel{[pair1]satormay2}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:VPair})}]
            \begin{pfsteps}
            \item \isVal{e_1} \BY{assumption} \pflabel{[pair1]val1}
            \item \isVal{e_2} \BY{assumption} \pflabel{[pair1]val2}
            \item \ccsatisfy{e_1}{\ctruify{\hxi_1}} \BY{IH on \pfref{[pair1]val1} and \pfref{[pair1]satormay1}} \pflabel{[pair1]sat-truify1}
            \item \ccsatisfy{e_2}{\ctruify{\hxi_2}} \BY{IH on \pfref{[pair1]val2} and \pfref{[pair1]satormay2}} \pflabel{[pair1]sat-truify2}
            \item \ccsatisfy{\hpair{e_1}{e_2}}{\cpair{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CSPair} on \pfref{[pair1]sat-truify1} and \pfref{[pair1]sat-truify2}}
            \end{pfsteps}
          \end{byCases}
        
        \restorelocalsteps{2} 
        \item[\text{(\ref{rule:CMSPair2})}] 
          \begin{pfsteps}
          \item e=\hpair{e_1}{e_2} \BY{assumption}
          \item \hxi=\cpair{\hxi_1}{\hxi_2} \BY{assumption}
          \item \csatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[pair2]satisfy1}
          \item \cmaysatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[pair2]maysat2}
          \item \ctruify{\cpair{\hxi_1}{\hxi_2}}=\cpair{\ctruify{\hxi_1}}{\ctruify{\xi_2}} \BY{\autoref{defn:truify}}
          \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on \pfref{[pair2]satisfy1}} \pflabel{[pair2]satormay1}
          \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSMay} on \pfref{[pair2]maysat2}} \pflabel{[pair2]satormay2}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:VPair})}]
            \begin{pfsteps}
            \item \isVal{e_1} \BY{assumption} \pflabel{[pair2]val1}
            \item \isVal{e_2} \BY{assumption} \pflabel{[pair2]val2}
            \item \ccsatisfy{e_1}{\ctruify{\hxi_1}} \BY{IH on \pfref{[pair2]val1} and \pfref{[pair2]satormay1}} \pflabel{[pair2]sat-truify1}
            \item \ccsatisfy{e_2}{\ctruify{\hxi_2}} \BY{IH on \pfref{[pair2]val2} and \pfref{[pair2]satormay2}} \pflabel{[pair2]sat-truify2}
            \item \ccsatisfy{\hpair{e_1}{e_2}}{\cpair{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CSPair} on \pfref{[pair2]sat-truify1} and \pfref{[pair2]sat-truify2}}
            \end{pfsteps}
          \end{byCases}
        
        \restorelocalsteps{2} 
        \item[\text{(\ref{rule:CMSPair3})}] 
          \begin{pfsteps}
          \item e=\hpair{e_1}{e_2} \BY{assumption}
          \item \hxi=\cpair{\hxi_1}{\hxi_2} \BY{assumption}
          \item \cmaysatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[pair3]maysat1}
          \item \cmaysatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[pair3]maysat2}
          \item \ctruify{\cpair{\hxi_1}{\hxi_2}}=\cpair{\ctruify{\hxi_1}}{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSMay} on \pfref{[pair3]maysat1}} \pflabel{[pair3]satormay1}
          \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSMay} on \pfref{[pair3]maysat2}} \pflabel{[pair3]satormay2}
          \item \ccsatisfy{e_1}{\ctruify{\hxi_1}} \BY{IH on \pfref{[pair3]satormay1}} \pflabel{[pair3]sat-truify1}
          \item \ccsatisfy{e_2}{\ctruify{\hxi_2}} \BY{IH on \pfref{[pair3]satormay2}} \pflabel{[pair3]sat-truify2}
          \item \ccsatisfy{\hpair{e_1}{e_2}}{\cpair{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CSPair} on \pfref{[pair3]sat-truify1} and \pfref{[pair3]sat-truify2}}
          \end{pfsteps}
        
        \restorelocalsteps{2} 
        \item[\text{(\ref{rule:CMSOr1})}] 
          \begin{pfsteps}
          \item \hxi=\cor{\hxi_1}{\hxi_2} \BY{assumption}
          \item \cmaysatisfy{e}{\hxi_1} \BY{assumption} \pflabel{[or1]maysat}
          \item \ctruify{\cor{\hxi_1}{\hxi_2}}=\cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \item \csatisfyormay{e}{\hxi_1} \BY{\ruleref{rule:CSMSMay} on \pfref{[or1]maysat}} \pflabel{[or1]satormay}
          \item \ccsatisfy{e}{\ctruify{\hxi_1}} \BY{IH on \pfref{val} and \pfref{[or1]satormay}} \pflabel{[or1]sat-truify}
          \item \ccsatisfy{e}{\cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CCSOr1} on \pfref{[or1]sat-truify}}
          \end{pfsteps}
        
        \restorelocalsteps{2} 
        \item[\text{(\ref{rule:CMSOr2})}] 
          \begin{pfsteps}
          \item \hxi=\cor{\hxi_1}{\hxi_2} \BY{assumption}
          \item \cmaysatisfy{e}{\hxi_2} \BY{assumption} \pflabel{[or2]maysat}
          \item \ctruify{\hxi}=\cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}} \BY{\autoref{defn:truify}}
          \item \csatisfyormay{e}{\hxi_2} \BY{\ruleref{rule:CSMSMay} on \pfref{[or2]maysat}} \pflabel{[or2]satormay}
          \item \ccsatisfy{e}{\ctruify{\hxi_2}} \BY{IH on \pfref{val} and \pfref{[or2]satormay}} \pflabel{[or2]sat-truify}
          \item \ccsatisfy{e}{\cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}} \BY{\ruleref{rule:CSOr2} on \pfref{[or2]sat-truify}}
          \end{pfsteps}
          
        \restorelocalsteps{2} 
        \item[\text{(\ref{rule:CMSNotIntro})}] 
          \begin{pfsteps}
          \item \notIntro{e} \BY{assumption} \pflabel{notintro}
          \end{pfsteps}
          Contradicts \pfref{val} by \autoref{lem:val-not-notintro}.
        
        \end{byCases}
      \end{byCases}

    \resetpfcounter

    \item Necessity:
    \begin{pfsteps}
    \item \isVal{e} \BY{assumption} \pflabel{val}
    \item \ccsatisfy{e}{\ctruify{\hxi}} \BY{assumption} \pflabel{ccsatisfy}
    \end{pfsteps}
    By structural induction on $\hxi$.
    \begin{byCases}

      \savelocalsteps{1}
      \item[\hxi=\ctruth]
      \begin{pfsteps}
      \item \csatisfy{e}{\ctruth} \BY{\ruleref{rule:CSTruth}} \pflabel{[truth]satisfy}
      \item \csatisfyormay{e}{\ctruth} \BY{\ruleref{rule:CSMSSat} on \pfref{[truth]satisfy}}
      \end{pfsteps}
      
      \restorelocalsteps{1}
      \item[\hxi=\cnum{n}]
      \begin{pfsteps}
      \item \ctruify{\cnum{n}} = \cnum{n} \BY{assumption}
      \end{pfsteps}
      By rule induction over \rulesref{rules:cSatisfy} on \pfref{ccsatisfy}, only one rule applies.
      \begin{byCases}
        \item[\text{(\ref{rule:CCSNum})}]
        \begin{pfsteps}
        \item e = \hnum{n} \BY{assumption}
        \item \csatisfy{\hnum{n}}{\cnum{n}} \BY{\ruleref{rule:CSNum}} \pflabel{[num]satisfy}
        \item \csatisfyormay{\hnum{n}}{\cnum{n}} \BY{\ruleref{rule:CSMSSat} on \pfref{[num]satisfy}}
        \end{pfsteps}
      \end{byCases}

      \restorelocalsteps{1}
      \item[\hxi=\cunknown]
        \begin{pfsteps}
        \item \cmaysatisfy{e}{\cunknown} \BY{\ruleref{rule:CMSUnknown}} \pflabel{[unknown]maysat}
        \item \csatisfyormay{e}{\cunknown} \BY{\ruleref{rule:CSMSMay} on \pfref{[unknown]maysat}}
        \end{pfsteps}

      \restorelocalsteps{1}
      \item[\hxi = \cor{\hxi_1}{\hxi_2}]
      \begin{pfsteps*}
      \item $\ctruify{\cor{\hxi_1}{\hxi_2}}=\cor{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}$ \BY{\autoref{defn:truify}}
      \end{pfsteps*}
      By rule induction over \rulesref{rules:cSatisfy} on \pfref{ccsatisfy}, only two rules apply.
      \begin{byCases}

        \savelocalsteps{2}
        \item[\text{(\ref{rule:CCSOr1})}]
        \begin{pfsteps*}
        \item $\ccsatisfy{e}{\ctruify{\hxi_1}}$ \BY{assumption} \pflabel{[or]satisfy-falsify1}
        \item $\csatisfyormay{e}{\hxi_1}$ \BY{IH on \pfref{val} and \pfref{[or]satisfy-falsify1}} \pflabel{[or]satisfy1}
        \item $\csatisfyormay{e}{\cor{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-or} on \pfref{[or]satisfy1}}
        \end{pfsteps*}

        \restorelocalsteps{2}
        \item[\text{(\ref{rule:CCSOr2})}]
        \begin{pfsteps*}
        \item $\ccsatisfy{e}{\ctruify{\hxi_2}}$ \BY{assumption} \pflabel{[or]satisfy-falsify2}
        \item $\csatisfyormay{e}{\hxi_2}$ \BY{IH on \pfref{val} and \pfref{[or]satisfy-falsify2}} \pflabel{[or]satisfy2}
        \item $\csatisfyormay{e}{\cor{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-or} on \pfref{[or]satisfy2}}
        \end{pfsteps*}
      \end{byCases}
    
      \restorelocalsteps{1}
      \item[\hxi=\cinl{\hxi_1}]
        \begin{pfsteps*}
        \item $\ctruify{\cinl{\hxi_1}}=\cinl{\ctruify{\hxi_1}}$ \BY{\autoref{defn:truify}}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:cSatisfy} on \pfref{ccsatisfy}, only one rule applies.
        \begin{byCases}
          \item[\text{(\ref{rule:CCSInl})}]
            \begin{pfsteps*}
            \item $e = \hinl{\tau_2}{e_1}$ \BY{assumption}
            \item $\ccsatisfy{e_1}{\ctruify{\hxi_1}}$ \BY{assumption} \pflabel{[inl]satisfy-falsify1}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
            \begin{byCases}
              \item[\text{(\ref{rule:VInl})}]
              \begin{pfsteps*}
              \item $\isVal{e_1}$ \BY{assumption} \pflabel{[inl]val1}
              \item $\csatisfyormay{e_1}{\hxi_1}$ \BY{IH on \pfref{[inl]val1} and \pfref{[inl]satisfy-falsify1}} \pflabel{[inl]satisfy1}
              \item $\csatisfyormay{\hinl{\tau_2}{e_1}}{\cinl{\hxi_1}}$ \BY{\autoref{lem:satormay-inl} on \pfref{[inl]satisfy1}}
              \end{pfsteps*} 
            \end{byCases}
        \end{byCases}

      \restorelocalsteps{1}
      \item[\hxi=\cinr{\hxi_2}]
        \begin{pfsteps*}
        \item $\ctruify{\cinr{\hxi_2}}=\cinr{\ctruify{\hxi_2}}$ \BY{\autoref{defn:truify}}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:cSatisfy} on \pfref{ccsatisfy}, only one rule applies.
        \begin{byCases}
          \item[\text{(\ref{rule:CSInr})}]
            \begin{pfsteps*}
            \item $e = \hinr{\tau_1}{e_2}$ \BY{assumption}
            \item $\ccsatisfy{e_2}{\ctruify{\hxi_2}}$ \BY{assumption} \pflabel{[inr]satisfy-falsify2}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
            \begin{byCases}
              \item[\text{(\ref{rule:VInr})}]
              \begin{pfsteps*}
              \item $\isVal{e_2}$ \BY{assumption} \pflabel{[inr]val2}
              \item $\csatisfyormay{e_2}{\hxi_2}$ \BY{IH on \pfref{[inr]val2} and \pfref{[inr]satisfy-falsify2}} \pflabel{[inr]satisfy2}
              \item $\csatisfyormay{\hinr{\tau_1}{e_2}}{\cinr{\hxi_2}}$ \BY{\autoref{lem:satormay-inr} on \pfref{[inr]satisfy2}}
              \end{pfsteps*} 
            \end{byCases}
        \end{byCases}
      
      \restorelocalsteps{1}
      \item[\hxi=\cpair{\hxi_1}{\hxi_2}]
        \begin{pfsteps*}
        \item $\ctruify{\cpair{\hxi_1}{\hxi_2}}=\cpair{\ctruify{\hxi_1}}{\ctruify{\hxi_2}}$ \BY{\autoref{defn:truify}}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:cSatisfy} on \pfref{ccsatisfy}, only one rule applies.
        \begin{byCases}
          \item[\text{(\ref{rule:CSPair})}]
            \begin{pfsteps*}
            \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
            \item $\ccsatisfy{e_1}{\cfalsify{\hxi_1}}$ \BY{assumption} \pflabel{[pair]satisfy-falsify1}
            \item $\ccsatisfy{e_2}{\cfalsify{\hxi_2}}$ \BY{assumption} \pflabel{[pair]satisfy-falsify2}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:Value} on \pfref{val}, only one rule applies.
            \begin{byCases}
              \item[\text{(\ref{rule:VPair})}]
              \begin{pfsteps*}
              \item $\isVal{e_1}$ \BY{assumption} \pflabel{[pair]val1}
              \item $\isVal{e_2}$ \BY{assumption} \pflabel{[pair]val2}
              \item $\csatisfyormay{e_1}{\hxi_1}$ \BY{IH on \pfref{[pair]val1} and \pfref{[pair]satisfy-falsify1}} \pflabel{[pair]satisfy1}
              \item $\csatisfyormay{e_2}{\hxi_2}$ \BY{IH on \pfref{[pair]val2} and \pfref{[pair]satisfy-falsify2}} \pflabel{[pair]satisfy2}
              \item $\csatisfyormay{\hpair{e_1}{e_2}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair]satisfy1} and \pfref{[pair]satisfy2}}
              \end{pfsteps*}
            \end{byCases}
        \end{byCases}
    \end{byCases}
  \end{enumerate}
  \resetpfcounter
\end{proof}

\begin{lemma}
  \label{lem:satisfy-falsify}
  $\csatisfy{e}{\hxi}$ iff $\ccsatisfy{e}{\cfalsify{\hxi}}$
\end{lemma}
\begin{proof}
  We prove sufficiency and necessity separately.
  \begin{enumerate}
    \item Sufficiency:
    \begin{pfsteps*}
    \item $\csatisfy{e}{\hxi}$ \BY{assumption} \pflabel{satisfy}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:Satisfy}) on \pfref{satisfy}.
    \begin{byCases}
      
      \savelocalsteps{1}
      \item[\text{(\ref{rule:CSTruth})}]
        \begin{pfsteps*}
        \item $\hxi = \ctruth$ \BY{assumption}
        \item $\cfalsify{\ctruth}=\ctruth$ \BY{Definition \ref{defn:falsify}}
        \item $\ccsatisfy{e}{\ctruth}$ \BY{\ruleref{rule:CCSTruth}}
        \end{pfsteps*}

      \restorelocalsteps{1}
      \item[\text{(\ref{rule:CSNum})}]
        \begin{pfsteps*}
        \item $\hxi = \cnum{n}$ \BY{assumption}
        \item $e = \hnum{n}$ \BY{assumption}
        \item $\cfalsify{\hnum{n}}=\cnum{n}$ \BY{Definition \ref{defn:falsify}}
        \item $\ccsatisfy{\hnum{n}}{\cnum{n}}$ \BY{\ruleref{rule:CCSNum}}
        \end{pfsteps*}

      \restorelocalsteps{1}
      \item[\text{(\ref{rule:CSOr1})}]
        \begin{pfsteps*}
        \item $\hxi = \cor{\hxi_1}{\hxi_2}$ \BY{assumption}
        \item $\csatisfy{e}{\hxi_1}$ \BY{assumption} \pflabel{[or]satisfy1}
        \item $\cfalsify{\cor{\hxi_1}{\hxi_2}}=\cor{\cfalsify{\hxi_1}}{\cfalsify{\hxi_2}}$ \BY{Definition \ref{defn:falsify}}
        \item $\ccsatisfy{e}{\cfalsify{\hxi_1}}$ \BY{IH on \pfref{[or]satisfy1}} \pflabel{[or]satisfy-falsify1}
        \item $\ccsatisfy{e}{\cor{\cfalsify{\hxi_1}}{\cfalsify{\hxi_2}}}$ \BY{Rule (\ref{rule:CCSOr1}) on \pfref{[or]satisfy-falsify1}}
        \end{pfsteps*}
      
      \restorelocalsteps{1}
      \item[\text{(\ref{rule:CSOr2})}]
        \begin{pfsteps*}
        \item $\hxi = \cor{\hxi_1}{\hxi_2}$ \BY{assumption}
        \item $\csatisfy{e}{\hxi_2}$ \BY{assumption} \pflabel{[or]satisfy2}
        \item $\cfalsify{\cor{\hxi_1}{\hxi_2}}=\cor{\cfalsify{\hxi_1}}{\cfalsify{\hxi_2}}$ \BY{Definition \ref{defn:falsify}}
        \item $\ccsatisfy{e}{\cfalsify{\hxi_2}}$ \BY{IH on \pfref{[or]satisfy2}} \pflabel{[or]satisfy-falsify2}
        \item $\ccsatisfy{e}{\cor{\cfalsify{\hxi_1}}{\cfalsify{\hxi_2}}}$ \BY{Rule (\ref{rule:CCSOr2}) on \pfref{[or]satisfy-falsify2}}
        \end{pfsteps*}

      \restorelocalsteps{1}
      \item[\text{(\ref{rule:CSInl})}]
        \begin{pfsteps*}
        \item $e = \hinl{\tau_2}{e_1}$ \BY{assumption}
        \item $\hxi = \cinl{\hxi_1}$ \BY{assumption}
        \item $\csatisfy{e_1}{\hxi_1}$ \BY{assumption} \pflabel{[inl]satisfy1}
        \item $\cfalsify{\cinl{\hxi_1}} = \cinl{\cfalsify{\hxi_1}}$ \BY{\autoref{defn:falsify}}
        \item $\ccsatisfy{e_1}{\cfalsify{\hxi_1}}$ \BY{IH on \pfref{[inl]satisfy1}} \pflabel{[inl]satisfy-falsify1}
        \item $\ccsatisfy{\hinl{\tau_2}{e_1}}{\cinl{\cfalsify{\hxi_1}}}$ \BY{Rule (\ref{rule:CCSInl}) on \pfref{[inl]satisfy-falsify1}}
        \end{pfsteps*}

      \restorelocalsteps{1}
      \item[\text{(\ref{rule:CSInr})}]
        \begin{pfsteps*}
        \item $e = \hinr{\tau_1}{e_2}$ \BY{assumption}
        \item $\hxi = \cinr{\hxi_2}$ \BY{assumption}
        \item $\csatisfy{e_2}{\hxi_2}$ \BY{assumption} \pflabel{[inr]satisfy2}
        \item $\cfalsify{\cinr{\hxi_2}} = \cinr{\cfalsify{\hxi_2}}$ \BY{\autoref{defn:falsify}}
        \item $\ccsatisfy{e_2}{\cfalsify{\hxi_2}}$ \BY{IH on \pfref{[inr]satisfy2}} \pflabel{[inr]satisfy-falsify2}
        \item $\ccsatisfy{\hinr{\tau_1}{e_2}}{\cinr{\cfalsify{\hxi_2}}}$ \BY{Rule (\ref{rule:CCSInr}) on \pfref{[inr]satisfy-falsify2}}
        \end{pfsteps*}
      
      \restorelocalsteps{1}
      \item[\text{(\ref{rule:CSPair})}]
        \begin{pfsteps*}
        \item $e = \hpair{e_1}{e_2}$ \BY{assumption}
        \item $\hxi = \cpair{\hxi_1}{\hxi_2}$ \BY{assumption}
        \item $\csatisfy{e_1}{\hxi_1}$ \BY{assumption} \pflabel{[pair]satisfy1}
        \item $\csatisfy{e_2}{\hxi_2}$ \BY{assumption} \pflabel{[pair]satisfy2}
        \item $\cfalsify{\cpair{\hxi_1}{\hxi_2}}=\cpair{\cfalsify{\hxi_1}}{\cfalsify{\hxi_2}}$ \BY{Definition \ref{defn:falsify}}
        \item $\ccsatisfy{e_1}{\cfalsify{\hxi_1}}$ \BY{IH on \pfref{[pair]satisfy1}} \pflabel{[pair]satisfy-falsify1}
        \item $\ccsatisfy{e_2}{\cfalsify{\hxi_2}}$ \BY{IH on \pfref{[pair]satisfy2}} \pflabel{[pair]satisfy-falsify2}
        \item $\ccsatisfy{\hpair{e_1}{e_2}}{\cpair{\cfalsify{\hxi_1}}{\cfalsify{\hxi_2}}}$ \BY{Rule (\ref{rule:CCSPair}) on \pfref{[pair]satisfy-falsify1} and \pfref{[pair]satisfy-falsify2}}
        \end{pfsteps*}
    \end{byCases}

    \resetpfcounter

    \item Necessity:
    \begin{pfsteps*}
    \item $\ccsatisfy{e}{\cfalsify{\hxi}}$ \BY{assumption} \pflabel{satisfy-falsify}
    \end{pfsteps*}
    By structural induction on $\hxi$.
    \begin{byCases}

      \savelocalsteps{1}
      \item[\hxi=\ctruth]
      \begin{pfsteps*}
      \item $\cfalsify{\ctruth} = \ctruth$ \BY{\autoref{defn:falsify}}
      \item $\csatisfy{e}{\ctruth}$ \BY{\ruleref{rule:CSTruth}}
      \end{pfsteps*}

      \restorelocalsteps{1}
      \item[\hxi=\cunknown]
      \begin{pfsteps*}
      \item $\cfalsify{\cunknown} = \cfalsity$ \BY{\autoref{defn:falsify}}
      \end{pfsteps*}
      By rule induction over \rulesref{rules:cSatisfy} on \pfref{satisfy-falsify}, no rule applies due to syntactic contradiction.
        
      \restorelocalsteps{1}
      \item[\hxi=\cnum{n}]
      \begin{pfsteps*}
      \item $\cfalsify{\cnum{n}} = \cnum{n}$ \BY{\autoref{defn:falsify}}
      \end{pfsteps*}
      By rule induction over \rulesref{rules:cSatisfy} on \pfref{satisfy-falsify}, only one rule applies.
      \begin{byCases}
        \item[\text{(\ref{rule:CCSNum})}]
        \begin{pfsteps}
        \item e = \hnum{n} \BY{assumption}
        \item \csatisfy{\hnum{n}}{\cnum{n}} \BY{\ruleref{rule:CSNum}}
        \end{pfsteps}
      \end{byCases}

      \restorelocalsteps{1}
      \item[\hxi = \cor{\hxi_1}{\hxi_2}]
      \begin{pfsteps*}
      \item $\cfalsify{\cor{\hxi_1}{\hxi_2}} = \cor{\cfalsify{\hxi_1}}{\cfalsify{\hxi_2}}$ \BY{\autoref{defn:falsify}}
      \end{pfsteps*}
      By rule induction over \rulesref{rules:cSatisfy} on \pfref{satisfy-falsify}, only two rules apply.
      \begin{byCases}

        \savelocalsteps{2}
        \item[\text{(\ref{rule:CCSOr1})}]
        \begin{pfsteps*}
        \item $\ccsatisfy{e}{\cfalsify{\hxi_1}}$ \BY{assumption} \pflabel{[or]satisfy-falsify1}
        \item $\csatisfy{e}{\hxi_1}$ \BY{IH on \pfref{[or]satisfy-falsify1}} \pflabel{[or]satisfy1}
        \item $\csatisfy{e}{\cor{\hxi_1}{\hxi_2}}$ \BY{Rule (\ref{rule:CSOr1}) on \pfref{[or]satisfy1}}
        \end{pfsteps*}

        \restorelocalsteps{2}
        \item[\text{(\ref{rule:CCSOr2})}]
        \begin{pfsteps*}
        \item $\ccsatisfy{e}{\cfalsify{\hxi_2}}$ \BY{assumption} \pflabel{[or]satisfy-falsify2}
        \item $\csatisfy{e}{\hxi_2}$ \BY{IH on \pfref{[or]satisfy-falsify2}} \pflabel{[or]satisfy2}
        \item $\csatisfy{e}{\cor{\hxi_1}{\hxi_2}}$ \BY{Rule (\ref{rule:CSOr2}) on \pfref{[or]satisfy2}}
        \end{pfsteps*}
      \end{byCases}
    
    \restorelocalsteps{1}
    \item[\hxi=\cinl{\hxi_1}]
    \begin{pfsteps*}
    \item $\cfalsify{\cinl{\hxi_1}} = \cinl{\cfalsify{\hxi_1}}$ \BY{\autoref{defn:falsify}}
    \end{pfsteps*}
    By rule induction over \rulesref{rules:cSatisfy} on \pfref{satisfy-falsify}, only one rule applies.
    \begin{byCases}
      \item[\text{(\ref{rule:CCSInl})}]
      \begin{pfsteps*}
      \item $e = \hinl{\tau_2}{e_1}$ \BY{assumption}
      \item $\ccsatisfy{e_1}{\cfalsify{\hxi_1}}$ \BY{assumption} \pflabel{[inl]satisfy-falsify1}
      \item $\csatisfy{e_1}{\hxi_1}$ \BY{IH on \pfref{[inl]satisfy-falsify1}} \pflabel{[inl]satisfy1}
      \item $\csatisfy{e}{\cinl{\hxi_1}}$ \BY{Rule (\ref{rule:CSInl}) on \pfref{[inl]satisfy1}}
      \end{pfsteps*} 
    \end{byCases}

    \restorelocalsteps{1}
    \item[\hxi=\cinr{\hxi_2}]
    \begin{pfsteps*}
    \item $\cfalsify{\cinr{\hxi_2}} = \cinr{\cfalsify{\hxi_2}}$ \BY{\autoref{defn:falsify}}
    \end{pfsteps*}
    By rule induction over \rulesref{rules:cSatisfy} on \pfref{satisfy-falsify}, only one rule applies.
    \begin{byCases}
      \item[\text{(\ref{rule:CCSInr})}]
      \begin{pfsteps*}
      \item $e = \hinr{\tau_1}{e_2}$ \BY{assumption}
      \item $\ccsatisfy{e_2}{\cfalsify{\hxi_2}}$ \BY{assumption} \pflabel{[inr]satisfy-falsify2}
      \item $\csatisfy{e_2}{\hxi_2}$ \BY{IH on \pfref{[inr]satisfy-falsify2}} \pflabel{[inr]satisfy2}
      \item $\csatisfy{e}{\cinr{\hxi_2}}$ \BY{Rule (\ref{rule:CSInr}) on \pfref{[inr]satisfy2}}
      \end{pfsteps*} 
    \end{byCases}
    
    \restorelocalsteps{1}
    \item[\hxi=\cpair{\hxi_1}{\hxi_2}]
    \begin{pfsteps*}
    \item $\cfalsify{\cpair{\hxi_1}{\hxi_2}} = \cpair{\cfalsify{\hxi_1}}{\cfalsify{\hxi_2}}$ \BY{\autoref{defn:falsify}}
    \end{pfsteps*}
    By rule induction over \rulesref{rules:cSatisfy} on \pfref{satisfy-falsify}, only one rule applies.
    \begin{byCases}
      \item[\text{(\ref{rule:CSPair})}]
      \begin{pfsteps*}
      \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
      \item $\ccsatisfy{e_1}{\cfalsify{\hxi_1}}$ \BY{assumption} \pflabel{[pair]satisfy-falsify1}
      \item $\ccsatisfy{e_2}{\cfalsify{\hxi_2}}$ \BY{assumption} \pflabel{[pair]satisfy-falsify2}
      \item $\csatisfy{e_1}{\hxi_1}$ \BY{IH on \pfref{[pair]satisfy-falsify1}} \pflabel{[pair]satisfy1}
      \item $\csatisfy{e_2}{\hxi_2}$ \BY{IH on \pfref{[pair]satisfy-falsify2}} \pflabel{[pair]satisfy2}
      \item $\csatisfy{e}{\cpair{\hxi_1}{\hxi_2}}$ \BY{Rule (\ref{rule:CSPair}) on \pfref{[pair]satisfy1} and \pfref{[pair]satisfy2}}
      \end{pfsteps*}
    \end{byCases} 
  \end{byCases}
  \resetpfcounter
  \end{enumerate}
\end{proof}

\begin{lemma}
  \label{lem:val-final-satormay}
  Suppose $\ctyp{\hxi}{\tau}$. Then $\csatisfyormay{e}{\hxi}$ for all $e$ such that $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isFinal{e}$ \textbf{iff} $\csatisfyormay{e}{\hxi}$ for all $e$ such that $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isVal{e}$.
\end{lemma}
\begin{proof}
  The sufficiency can be easily proved by observing that $\isVal{e}$ implies $\isFinal{e}$, due to \ruleref{rule:FVal}.
  
  Now, we want to prove the necessity. By rule induction over \rulesref{rules:Final}, we notice that $\isFinal{e}$ iff $\isVal{e}$ or $\isIndet{e}$. Therefore, we only need to prove that if $\csatisfyormay{e}{\hxi}$ for all $e$ such that $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isVal{e}$, then $\csatisfyormay{e}{\hxi}$ for all $e$ such that $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isIndet{e}$.

  By \autoref{lem:sound-complete-satormay}, we know that $\csatisfyormay{e}{\hxi}$ is decidable. Therefore, we just need to prove the contraposition of the above statement \textemdash if there exists $e$ such that $\isIndet{e}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\cnotsatisfyormay{e}{\hxi}$, then there exists $e$ such that $\isVal{e}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\cnotsatisfyormay{e}{\hxi}$.
  
  Now, we just need to show the implication.
  \begin{pfsteps}
  \item \ctyp{\hxi}{\tau} \BY{assumption} \pflabel{1}
  \item \isIndet{e} \BY{assumption} \pflabel{2}
  \item \hexptyp{\cdot}{\Delta}{e}{\tau} \BY{assumption} \pflabel{3}
  \item \cnotsatisfyormay{e}{\hxi} \BY{assumption} \pflabel{4}
  \item \inValues{e'}{e} \text{ implies } \cnotsatisfyormay{e'}{\hxi} \BY{\autoref{lem:complete-not-satormay} on \pfref{1} and \pfref{2} and \pfref{3} and \pfref{4}} \pflabel{notsat}
  \item \inValues{e'}{e} \BY{\autoref{lem:invalues-derivable} on \pfref{2}} \pflabel{invalues}
  \item \hexptyp{\cdot}{\Delta}{e'}{\tau} \BY{\autoref{lem:invalues-typ} on \pfref{invalues} and \pfref{3}}
  \item \isVal{e'} \BY{\autoref{lem:invalues-val} on \pfref{invalues}}
  \item \cnotsatisfyormay{e'}{\hxi} \BY{\pfref{notsat} on \pfref{invalues}}
  \end{pfsteps}
  \resetpfcounter
\end{proof}

\begin{theorem}
\label{thrm:demystify-exhaustiveness}
$\csatisfyormay{\ctruth}{\hxi}$ iff $\ccsatisfy{\ctruth}{\ctruify{\hxi}}$.
\end{theorem}
\begin{proof}\mbox{}\\

  By \ruleref{rule:CSTruth} and \ruleref{rule:CSMSSat}, we have $\csatisfyormay{e}{\ctruth}$ for any $e$.
  By \ruleref{rule:CCSTruth}, we have $\ccsatisfy{e}{\ctruth}$ for any $e$.

  Therefore, by \autoref{defn:nn-entailment}, $\csatisfyormay{\ctruth}{\hxi}$ iff $\csatisfyormay{e}{\hxi}$ for all $e$ such that $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isFinal{e}$.

  And by \autoref{defn:complete-constraint-entailment}, $\ccsatisfy{\ctruth}{\ctruify{\hxi}}$ 
  iff $\ccsatisfy{e}{\ctruify{\hxi}}$ for all $e$ such that $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isVal{e}$, 
  by \autoref{lem:val-satisfy-truify}, iff $\csatisfyormay{e}{\hxi}$ for all $e$ such that $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and $\isVal{e}$.
  
  And the equivalence between the two is proved by \autoref{lem:val-final-satormay}.
\end{proof}

\begin{theorem}
\label{thrm:demystify-redundancy}
$\csatisfy{\hxi_1}{\hxi_2}$ iff $\ccsatisfy{\ctruify{\hxi_1}}{\cfalsify{\hxi_2}}$.
\end{theorem}
\begin{proof}\mbox{}\\
  
  By \autoref{defn:const-entailment}, $\csatisfy{\hxi_1}{\hxi_2}$ iff for all $e$ such that $\isVal{e}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$, $\csatisfyormay{e}{\hxi_1}$ implies $\csatisfy{e}{\hxi_2}$.
  
  By \autoref{defn:complete-constraint-entailment}, $\ccsatisfy{\ctruify{\hxi_1}}{\cfalsify{\hxi_2}}$ iff for all $e$ such that $\isVal{e}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$, $\ccsatisfy{e}{\ctruify{\hxi_1}}$ implies $\ccsatisfy{e}{\cfalsify{\hxi_2}}$.
  
  And the equivalence between the two is proved by \autoref{lem:val-satisfy-truify} and \autoref{lem:satisfy-falsify}.
\end{proof}