\section{Dynamic Semantics}
\judgboxa{\isVal{e}}{$e$ is a value}
\begin{subequations}\label{rules:Value}
\begin{equation}\label{rule:VNum}
\inferrule[VNum]{ }{
  \isVal{\hnum{n}}
}
\end{equation}
\begin{equation}\label{rule:VLam}
\inferrule[VLam]{ }{
  \isVal{\hlam{x}{\tau}{e}}
}
\end{equation}
\begin{equation}\label{rule:VPair}
\inferrule[VPair]{
  \isVal{e_1} \\
  \isVal{e_2}
}{\isVal{\hpair{e_1}{e_2}}}
\end{equation}
\begin{equation}\label{rule:VInl}
\inferrule[VInl]{
  \isVal{e}
}{
  \isVal{\hinl{\tau}{e}}
}
\end{equation}
\begin{equation}\label{rule:VInr}
\inferrule[VInr]{
  \isVal{e}
}{
  \isVal{\hinr{\tau}{e}}
}
\end{equation}
\end{subequations}

\judgboxa{\isIndet{e}}{$e$ is indeterminate}
\begin{subequations}\label{rules:Indet}
\begin{equation}\label{rule:IEHole}
\inferrule[IEHole]{ }{
  \isIndet{\hehole{u}}
}
\end{equation}
\begin{equation}\label{rule:IHole}
\inferrule[IHole]{
  \isFinal{e}
}{
  \isIndet{\hhole{e}{u}}
}
\end{equation}
\begin{equation}\label{rule:IAp}
\inferrule[IAp]{
  \isIndet{e_1} \\ \isFinal{e_2}
}{
  \isIndet{\hap{e_1}{e_2}}
}
\end{equation}
\begin{equation}\label{rule:IPairL}
\inferrule[IPairL]{
  \isIndet{e_1} \\ \isVal{e_2}
}{
  \isIndet{\hpair{e_1}{e_2}}
}
\end{equation}
\begin{equation}\label{rule:IPairR}
\inferrule[IPairR]{
  \isVal{e_1} \\
  \isIndet{e_2}
}{
  \isIndet{\hpair{e_1}{e_2}}
}
\end{equation}
\begin{equation}\label{rule:IPair}
\inferrule[IPair]{
  \isIndet{e_1} \\ \isIndet{e_2}
}{
  \isIndet{\hpair{e_1}{e_2}}
}
\end{equation}
\begin{equation}\label{rule:IFst}
\inferrule[IFst]{
  \isFinal{e}
}{
  \isIndet{\hfst{e}}
}
\end{equation}
\begin{equation}\label{rule:ISnd}
\inferrule[ISnd]{
  \isFinal{e}
}{
  \isIndet{\hsnd{e}}
}
\end{equation}
\begin{equation}\label{rule:IInl}
\inferrule[IInL]{
  \isIndet{e}
}{
  \isIndet{\hinl{\tau}{e}}
}
\end{equation}
\begin{equation}\label{rule:IInr}
\inferrule[IInR]{
  \isIndet{e}
}{
  \isIndet{\hinr{\tau}{e}}
}
\end{equation}
\begin{equation}\label{rule:IMatch}
\inferrule[IMatch]{
  \isFinal{e} \\
  \hmaymatch{e}{p_r}
}{
  \isIndet{
    \hmatch{e}{\zruls{rs_{pre}}{\hrulP{p_r}{e_r}}{rs_{post}}}
  }
}
\end{equation}
\end{subequations}

\judgboxa{\isFinal{e}}{$e$ is final}
\begin{subequations}\label{rules:Final}
  \begin{equation}\label{rule:FVal}
\inferrule[FVal]{
  \isVal{e}
}{
  \isFinal{e}
}
\end{equation}
\begin{equation}\label{rule:FIndet}
\inferrule[FIndet]{
  \isIndet{e}
}{
  \isFinal{e}
}
\end{equation}
\end{subequations}

\begin{lemma}
  \label{lem:inv-final-inl}
  If $\isFinal{\hinl{\tau}{e}}$ then $\isFinal{e}$.
\end{lemma}
\begin{lemma}
  \label{lem:inv-final-inr}
  If $\isFinal{\hinr{\tau}{e}}$ then $\isFinal{e}$.
\end{lemma}
\begin{lemma}
  \label{lem:inv-final-pair}
  If $\isFinal{\hpair{e_1}{e_2}}$ then $\isFinal{e_1}$ and $\isFinal{e_2}$.
\end{lemma}

\judgboxa{
  \notIntro{e}
}{
  $e$ cannot be a value syntactically
}
\begin{subequations}\label{rules:notintro}
\begin{equation}\label{rule:NVEHole}
\inferrule[NVEHole]{ }{
  \notIntro{\hehole{u}}
}
\end{equation}
\begin{equation}\label{rule:NVHole}
\inferrule[NVHole]{ }{
  \notIntro{\hhole{e}{u}}
}
\end{equation}
\begin{equation}\label{rule:NVAp}
\inferrule[NVAp]{ }{
  \notIntro{\hap{e_1}{e_2}}
}
\end{equation}
\begin{equation}\label{rule:NVMatch}
\inferrule[NVMatch]{ }{
  \notIntro{\hmatch{e}{\zrules}}
}
\end{equation}
\begin{equation}\label{rule:NVFst}
\inferrule[NVFst]{ }{
  \notIntro{\hfst{e}}
}
\end{equation}
\begin{equation}\label{rule:NVSnd}
\inferrule[NVSnd]{ }{
  \notIntro{\hsnd{e}}
}
\end{equation}
\end{subequations}

\judgboxa{\fnotIntro{e}}{}
\begin{subequations}\label{defn:notintro}
  \begin{align}
    \fnotIntro{\hehole{u}} ={}& \true \label{defn:ehole-notintro}\\
    \fnotIntro{\hhole{e}{u}} ={}& \true \label{defn:hole-notintro}\\
    \fnotIntro{\hap{e_1}{e_2}} ={}& \true \label{defn:ap-notintro}\\
    \fnotIntro{\hmatch{e}{\zrules}} ={}& \true \label{defn:match-notintro}\\
    \fnotIntro{\hfst{e}} ={}& \true \label{defn:fst-notintro}\\
    \fnotIntro{\hsnd{e}} ={}& \true \label{defn:snd-notintro}\\
    \text{Otherwise}\quad \fnotIntro{e} ={}& \false \label{defn:not-notintro}
  \end{align}
\end{subequations}

\begin{lemma}[Soundness and Completeness of NotIntro Judgment]
  \label{lem:sound-complete-notintro}
  $\notIntro{e}$ iff $\fnotIntro{e}$.
\end{lemma}
\begin{proof}
  TODO
\end{proof}

\judgboxa{
  \inValues{e'}{\Delta}{e}
}{
  $e'$ is one of the possible values of $e$
}
\begin{subequations}\label{rules:inValues}
  \begin{equation}\label{rule:IVVal}
    \inferrule[IVVal]{
      \isVal{e} \\
      \hexptyp{\cdot}{\Delta}{e}{\tau}
    }{
      \inValues{e}{\Delta}{e}
    }
  \end{equation}
  \begin{equation}\label{rule:IVIndet}
    \inferrule[IVIndet]{
      \notIntro{e} \\
      \hexptyp{\cdot}{\Delta}{e}{\tau} \\
      \isVal{e'} \\
      \hexptyp{\cdot}{\Delta}{e'}{\tau}
    }{
      \inValues{e'}{\Delta}{e}
    }
  \end{equation}
  \begin{equation}\label{rule:IVLam}
    \inferrule[IVInl]{
      \inValues{e'}{\Delta}{e} \\
    }{ 
      \inValues{\hlam{x}{\tau}{e'}}{\Delta}{\hlam{x}{\tau}{e}}
    }
  \end{equation}
  \begin{equation}\label{rule:IVInl}
    \inferrule[IVInl]{
      \inValues{e_1'}{\Delta}{e_1} \\
    }{ 
      \inValues{\hinl{\tau_2}{e_1'}}{\Delta}{\hinl{\tau_2}{e_1}}
    }
  \end{equation}
  \begin{equation}\label{rule:IVInr}
    \inferrule[IVInr]{
      \inValues{e_2'}{\Delta}{e_2} \\
    }{ 
      \inValues{\hinr{\tau_1}{e_2'}}{\Delta}{\hinr{\tau_1}{e_2}}
    }
  \end{equation}
  \begin{equation}\label{rule:IVPair}
    \inferrule[IVPair]{
      \inValues{e_1'}{\Delta}{e_1} \\
      \inValues{e_2'}{\Delta}{e_2}
    }{
      \inValues{\hpair{e_1'}{e_2'}}{\Delta}{\hpair{e_1}{e_2}}
    }
  \end{equation}
\end{subequations}

\begin{lemma}
  \label{lem:invalues-typ}
  If $\inValues{e'}{\Delta}{e}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$ then $\hexptyp{\cdot}{\Delta}{e'}{\tau}$.
\end{lemma}

\begin{lemma}
  \label{lem:invalues-val}
  If $\inValues{e'}{\Delta}{e}$ then $\isVal{e'}$.
\end{lemma}

\begin{lemma}
  \label{lem:invalues-derivable}
  If $\isIndet{e}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$ then there exists $e'$ such that $\inValues{e'}{\Delta}{e}$.
\end{lemma}

\begin{lemma}
  \label{lem:complete-not-satormay}
  Assume $\isFinal{e}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and
  $\ctyp{\hxi}{\tau}$. Then $\cnotsatisfyormay{e}{\hxi}$ iff $\forall
  e'.\inValues{e'}{\Delta}{e} \implies \cnotsatisfyormay{e'}{\hxi}$.
  
\end{lemma}
\begin{proof}
  \begin{pfsteps}
  \item \isFinal{e} \BY{assumption} \pflabel{efinal}
  \item \hexptyp{\cdot}{\Delta}{e}{\tau} \BY{assumption} \pflabel{etyp}
  \item \ctyp{\hxi}{\tau} \BY{assumption} \pflabel{ctyp}
  \end{pfsteps}
  Then we prove sufficiency and necessity separately.

  \savelocalsteps{iff}
  \textbf{Sufficiency}
  \begin{pfsteps}
  \item \cnotsatisfyormay{e}{\hxi} \BY{assumption} \pflabel{not-satormay}
  \end{pfsteps}

  By rule induction over \rulesref{rules:CTyp} on \pfref{ctyp}.
  \begin{byCases}
    \savelocalsteps{0}
    \item[\text{(\ref{rule:CTTruth})}]
    \begin{pfsteps*}
    \item $\hxi = \ctruth$ \BY{assumption}
    \item $\csatisfy{e}{\ctruth}$ \BY{\ruleref{rule:CSTruth}} \pflabel{[truth]sat}
    \item $\csatisfyormay{e}{\ctruth}$ \BY{\ruleref{rule:CSMSSat} on \pfref{[truth]sat}}
    \end{pfsteps*}
    Contradicts \pfref{not-satormay}.
    \restorelocalsteps{0}
    \item[\text{(\ref{rule:CTUnknown})}]
    \begin{pfsteps*}
    \item $\hxi = \cunknown$ \BY{assumption}
    \item $\cmaysatisfy{e}{\cunknown}$ \BY{\ruleref{rule:CMSUnknown}} \pflabel{[unknown]maysat}
    \item $\csatisfyormay{e}{\cunknown}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[unknown]maysat}}
    \end{pfsteps*}
    Contradicts \pfref{not-satormay}.
    \restorelocalsteps{0}
    \item[\text{(\ref{rule:CTNum})}]
    \begin{pfsteps*}
    \item $\hxi = \cnum{n}$ \BY{assumption}
    \item $\tau = \tnum$ \BY{assumption}
    \item $\refutable{\cnum{n}}$ \BY{\ruleref{rule:RXNum}} \pflabel{[num]refutable}
    \end{pfsteps*}
    By rule induction over \rulesref{rules:Final} on \pfref{efinal}.
    \begin{byCases}
    \savelocalsteps{1'}
    \item[\text{(\ref{rule:FVal})}]
      \begin{pfsteps}
        \item \isVal{e} \BY{assumption} \pflabel{eval}
      \end{pfsteps}
      By rule induction over \rulesref{rules:Value} on \pfref{eval} and
      \rulesref{rules:TExp} on \pfref{etyp}, only one case in each set
      of rules does not conflict with each other.
      
      \begin{byCases}
      \item[\text{(\ref{rule:VNum}) and (\ref{rule:TNum})}]
        \begin{pfsteps}
        \item e=\hnum{n'} \BY{assumption}
        \end{pfsteps}
        To show the implication, we assume $\inValues{e'}{\Delta}{\hnum{n'}}$ and show
        $\cnotsatisfyormay{e'}{\hxi}$.
        \begin{pfsteps}
        \item \inValues{e'}{\Delta}{\hnum{n'}} \BY{assumption} \pflabel{e'-values-n'}
        \end{pfsteps}
        By rule induction over \rulesref{rules:inValues} on
        \pfref{e'-values-n'}, only two cases apply.
        \begin{byCases}
          \savelocalsteps{2}
        \item[\text{(\ref{rule:IVVal})}]
          \begin{pfsteps}
          \item e' = e = \hnum{n'} \BY{assumption}
          \item \cnotsatisfyormay{e'}{\hxi} \BY{\pfref{not-satormay}}
          \end{pfsteps}
          \restorelocalsteps{2}
        \item[\text{(\ref{rule:IVIndet})}]
          \begin{pfsteps}
          \item \notIntro{\hnum{n'}} \BY{assumption} \pflabel{notintro-n'}
          \end{pfsteps}
          By rule induction over \rulesref{rules:notintro} on
          \pfref{notintro-n'}, no case applies due to syntactic contradiction.
        \end{byCases}
      \end{byCases}
      \restorelocalsteps{1'}
    \item[\text{(\ref{rule:FIndet})}]
      \begin{pfsteps}
        \item \isIndet{e} \BY{assumption} \pflabel{eindet}
      \end{pfsteps}
    By rule induction over \rulesref{rules:Indet} on \pfref{eindet}.
      \begin{byCases}
        \savelocalsteps{1}
        \item[\text{(\ref{rule:IEHole})}]
        \begin{pfsteps*}
        \item $e=\hehole{u}$ \BY{assumption}
        \item $\notIntro{\hehole{u}}$ \BY{\ruleref{rule:NVEHole}} \pflabel{[ehole]notintro}
        \item $\cmaysatisfy{\hehole{u}}{\cnum{n}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[ehole]notintro} and \pfref{[num]refutable}} \pflabel{[ehole][num]maysat}
        \item $\csatisfyormay{\hehole{u}}{\cnum{n}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[ehole][num]maysat}}
        \end{pfsteps*}
        Contradicts \pfref{not-satormay}.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IHole})}]
        \begin{pfsteps*}
        \item $e=\hhole{e_1}{u}$ \BY{assumption}
        \item $\notIntro{\hhole{e_1}{u}}$ \BY{\ruleref{rule:NVHole}} \pflabel{[hole]notintro}
        \item $\cmaysatisfy{\hhole{e_1}{u}}{\cnum{n}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[hole]notintro} and \pfref{[num]refutable}} \pflabel{[hole][num]maysat}
        \item $\csatisfyormay{\hhole{e_1}{u}}{\cnum{n}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[hole][num]maysat}}
        \end{pfsteps*} 
        Contradicts \pfref{not-satormay}.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IAp})}]
        \begin{pfsteps*}
        \item $e=\hap{e_1}{e_2}$ \BY{assumption}
        \item $\notIntro{\hap{e_1}{e_2}}$ \BY{\ruleref{rule:NVAp}} \pflabel{[ap]notintro}
        \item $\cmaysatisfy{\hap{e_1}{e_2}}{\cnum{n}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[ap]notintro} and \pfref{[num]refutable}} \pflabel{[ap][num]maysat}
        \item $\csatisfyormay{\hap{e_1}{e_2}}{\cnum{n}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[ap][num]maysat}}
        \end{pfsteps*} 
        Contradicts \pfref{not-satormay}.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IFst})}]
        \begin{pfsteps*}
        \item $e=\hfst{e_1}$ \BY{assumption}
        \item $\notIntro{\hfst{e_1}}$ \BY{\ruleref{rule:NVFst}} \pflabel{[fst]notintro}
        \item $\cmaysatisfy{\hfst{e_1}}{\cnum{n}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[fst]notintro} and \pfref{[num]refutable}} \pflabel{[fst][num]maysat}
        \item $\csatisfyormay{\hfst{e_1}}{\cnum{n}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[fst][num]maysat}}
        \end{pfsteps*} 
        Contradicts \pfref{not-satormay}.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:ISnd})}]
        \begin{pfsteps*}
        \item $e=\hsnd{e_1}$ \BY{assumption}
        \item $\notIntro{\hsnd{e_1}}$ \BY{\ruleref{rule:NVSnd}} \pflabel{[snd]notintro}
        \item $\cmaysatisfy{\hsnd{e_1}}{\cnum{n}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[snd]notintro} and \pfref{[num]refutable}} \pflabel{[snd][num]maysat}
        \item $\csatisfyormay{\hsnd{e_1}}{\cnum{n}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[snd][num]maysat}}
        \end{pfsteps*} 
        Contradicts \pfref{not-satormay}.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IMatch})}]
        \begin{pfsteps*}
        \item $e=\hmatch{e_1}{\zrules}$ \BY{assumption}
        \item $\notIntro{\hmatch{e_1}{\zrules}}$ \BY{\ruleref{rule:NVMatch}} \pflabel{[match]notintro}
        \item $\cmaysatisfy{\hmatch{e_1}{\zrules}}{\cnum{n}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[match]notintro} and \pfref{[num]refutable}} \pflabel{[match][num]maysat}
        \item $\csatisfyormay{\hmatch{e_1}{\zrules}}{\cnum{n}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[match][num]maysat}}
        \end{pfsteps*} 
        Contradicts \pfref{not-satormay}.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IPairL}), (\ref{rule:IPairR}), (\ref{rule:IPair})}] 
        \begin{pfsteps*}
        \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
        \end{pfsteps*} 
        By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, no rule applies due to syntactic contradiction.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IInl})}] 
        \begin{pfsteps*}
        \item $e=\hinl{\tau_2}{e_1}$ \BY{assumption}
        \end{pfsteps*} 
        By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, no rule applies due to syntactic contradiction.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IInr})}] 
        \begin{pfsteps*}
        \item $e=\hinr{\tau_1}{e_2}$ \BY{assumption}
        \end{pfsteps*} 
        By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, no rule applies due to syntactic contradiction.
      \end{byCases}
    \end{byCases}
    \restorelocalsteps{0}
    \item[\text{(\ref{rule:CTInl})}]
    \begin{pfsteps*}
      \item $\hxi = \cinl{\hxi_1}$ \BY{assumption}
      \item $\tau = \tsum{\tau_1}{\tau_2}$ \BY{assumption}
      \item $\ctyp{\hxi_1}{\tau_1}$ \BY{assumption} \pflabel{[inl]c1typ}
      \item $\refutable{\cinl{\hxi_1}}$ \BY{\ruleref{rule:RXInl}} \pflabel{[inl]refutable}
      \end{pfsteps*}

      By rule induction over \rulesref{rules:Final} on \pfref{efinal}.
      \begin{byCases}
        \savelocalsteps{1'}
        \item[\text{(\ref{rule:FVal})}]
          \begin{pfsteps}
          \item \isVal{e} \BY{assumption} \pflabel{[inl]eval}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{[inl]eval}.
          \rulesref{rules:TExp} on \pfref{etyp}, only two pairs of rules in each set
          of rules does not conflict with each other.
          \begin{byCases}
            \savelocalsteps{1}
            \item[\text{(\ref{rule:VInl}, \ref{rule:TInl})}]
              \begin{pfsteps}
              \item e=\hinl{\tau_2}{e_1} \BY{assumption}
              \item \isVal{e_1} \BY{assumption} \pflabel{[inl]e1val}
              \item \hexptyp{\cdot}{\Delta}{e_1}{\tau_1} \BY{assumption} \pflabel{[inl]e1typ}
              \item \isFinal{e_1} \BY{\ruleref{rule:FVal} on \pfref{[inl]e1val}} \pflabel{[inl]e1final}
              \end{pfsteps}
              To show the implication, we assume $\inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}}$ and show $\cnotsatisfyormay{e'}{\cinl{\hxi_1}}$.
              \begin{pfsteps}
              \item \inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}} \BY{assumption} \pflabel{[inl-inl]invalues}
              \end{pfsteps}
              By rule induction over \rulesref{rules:inValues} on \pfref{[inl-inl]invalues}.
              \begin{byCases}
                \savelocalsteps{2}
                \item[\text{(\ref{rule:IVVal})}]
                \begin{pfsteps}
                \item e' = e = \hinl{\tau_2}{e_1} \BY{assumption}
                \item \cnotsatisfyormay{e'}{\cinl{\hxi_1}} \BY{\pfref{not-satormay}}
                \end{pfsteps}

                \restorelocalsteps{2}
                \item[\text{(\ref{rule:IVIndet})}]
                  \begin{pfsteps}
                  \item \notIntro{\hinl{\tau_2}{e_1}} \BY{assumption} \pflabel{[inl]notintro-inl}
                  \end{pfsteps}
                  By rule induction over \rulesref{rules:notintro} on
                  \pfref{[inl]notintro-inl}, no cases applies due to syntactic contradiction.

                \restorelocalsteps{2}
                \item[\text{(\ref{rule:IVInl})}]
                  \begin{pfsteps}
                  \item e' = \hinl{\tau_2}{e_1'} \BY{assumption}
                  \item \inValues{e_1'}{\Delta}{e_1} \BY{assumption} \pflabel{[inl-inl]invalues1}
                  \item \cnotsatisfyormay{e_1}{\hxi_1}
                    \BY{\autoref{lem:satormay-inl} on \pfref{not-satormay}} \pflabel{[inl-inl]not-satormay1}
                  \item \cnotsatisfyormay{e_1'}{\hxi_1} \BY{IH on
                      \pfref{[inl]e1final}, \pfref{[inl]e1typ},
                      \pfref{[inl]c1typ}, \pfref{[inl-inl]not-satormay1}, and
                      \pfref{[inl-inl]invalues1}} \pflabel{[inl-inl]not-satormay1'}
                  \item \cnotsatisfyormay{\hinl{\tau_2}{e_1'}}{\cinl{\hxi_1}} \BY{\autoref{lem:satormay-inl} on \pfref{[inl-inl]not-satormay1'}}
                  \end{pfsteps}

              \end{byCases}

            \restorelocalsteps{1}
            \item[\text{(\ref{rule:VInr}, \ref{rule:TInr})}]
              \begin{pfsteps}
              \item e=\hinr{\tau_1}{e_2} \BY{assumption}
              \end{pfsteps}
              To show the implication, we assume $\inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}}$ and show $\cnotsatisfyormay{e'}{\cinl{\hxi_1}}$.
              \begin{pfsteps}
              \item \inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}} \BY{assumption} \pflabel{[inl-inr]invalues}
              \end{pfsteps}
              By rule induction over \rulesref{rules:inValues} on \pfref{[inl-inr]invalues}.
              \begin{byCases}
                \savelocalsteps{2}
                \item[\text{(\ref{rule:IVVal})}]
                \begin{pfsteps}
                \item e' = e = \hinr{\tau_1}{e_2} \BY{assumption}
                \item \cnotsatisfyormay{e'}{\cinl{\hxi_1}} \BY{\pfref{not-satormay}}
                \end{pfsteps}

                \restorelocalsteps{2}
                \item[\text{(\ref{rule:IVIndet})}]
                  \begin{pfsteps}
                  \item \notIntro{\hinr{\tau_1}{e_2}} \BY{assumption} \pflabel{[inl]notintro-inr}
                  \end{pfsteps}
                  By rule induction over \rulesref{rules:notintro} on
                  \pfref{[inl]notintro-inr}, no cases applies due to syntactic contradiction.

                \restorelocalsteps{2}
                \item[\text{(\ref{rule:IVInr})}]
                  \begin{pfsteps}
                  \item e' = \hinr{\tau_1}{e_2'} \BY{assumption}
                  \item \cnotsatisfyormay{e'}{\cinl{\hxi_1}} \BY{\autoref{lem:inr-notsatormay-inl}}
                  \end{pfsteps}

              \end{byCases}
          \end{byCases}
        \restorelocalsteps{1'}
        \item[\text{(\ref{rule:FIndet})}]
          \begin{pfsteps}
          \item \isIndet{e} \BY{assumption} \pflabel{[inl]eindet}
          \end{pfsteps}
        By rule induction over \rulesref{rules:Indet} on \pfref{[inl]eindet}.
        \begin{byCases}
          \savelocalsteps{1}
          \item[\text{(\ref{rule:IEHole})}]
          \begin{pfsteps*}
          \item $e=\hehole{u}$ \BY{assumption}
          \item $\notIntro{\hehole{u}}$ \BY{\ruleref{rule:NVEHole}} \pflabel{[ehole][inl]notintro}
          \item $\cmaysatisfy{\hehole{u}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[ehole][inl]notintro} and \pfref{[inl]refutable}} \pflabel{[ehole][inl]maysat}
          \item $\csatisfyormay{\hehole{u}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[ehole][inl]maysat}}
          \end{pfsteps*}
          Contradicts \pfref{not-satormay}.
          \restorelocalsteps{1}
          \item[\text{(\ref{rule:IHole})}]
          \begin{pfsteps*}
          \item $e=\hhole{e_1}{u}$ \BY{assumption}
          \item $\notIntro{\hhole{e_1}{u}}$ \BY{\ruleref{rule:NVHole}} \pflabel{[hole][inl]notintro}
          \item $\cmaysatisfy{\hhole{e_1}{u}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[hole][inl]notintro} and \pfref{[inl]refutable}} \pflabel{[hole][inl]maysat}
          \item $\csatisfyormay{\hhole{e_1}{u}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[hole][inl]maysat}}
          \end{pfsteps*} 
          Contradicts \pfref{not-satormay}.
          \restorelocalsteps{1}
          \item[\text{(\ref{rule:IAp})}]
          \begin{pfsteps*}
          \item $e=\hap{e_1}{e_2}$ \BY{assumption}
          \item $\notIntro{\hap{e_1}{e_2}}$ \BY{\ruleref{rule:NVAp}} \pflabel{[ap][inl]notintro}
          \item $\cmaysatisfy{\hap{e_1}{e_2}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[ap][inl]notintro} and \pfref{[inl]refutable}} \pflabel{[ap][inl]maysat}
          \item $\csatisfyormay{\hap{e_1}{e_2}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[ap][inl]maysat}}
          \end{pfsteps*} 
          Contradicts \pfref{not-satormay}.
          \restorelocalsteps{1}
          \item[\text{(\ref{rule:IFst})}]
          \begin{pfsteps*}
          \item $e=\hfst{e_1}$ \BY{assumption}
          \item $\notIntro{\hfst{e_1}}$ \BY{\ruleref{rule:NVFst}} \pflabel{[fst][inl]notintro}
          \item $\cmaysatisfy{\hfst{e_1}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[fst][inl]notintro} and \pfref{[inl]refutable}} \pflabel{[fst][inl]maysat}
          \item $\csatisfyormay{\hfst{e_1}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[fst][inl]maysat}}
          \end{pfsteps*} 
          Contradicts \pfref{not-satormay}.
          \restorelocalsteps{1}
          \item[\text{(\ref{rule:ISnd})}]
          \begin{pfsteps*}
          \item $e=\hsnd{e_1}$ \BY{assumption}
          \item $\notIntro{\hsnd{e_1}}$ \BY{\ruleref{rule:NVSnd}} \pflabel{[snd][inl]notintro}
          \item $\cmaysatisfy{\hsnd{e_1}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[snd][inl]notintro} and \pfref{[inl]refutable}} \pflabel{[snd][inl]maysat}
          \item $\csatisfyormay{\hsnd{e_1}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[snd][inl]maysat}}
          \end{pfsteps*} 
          Contradicts \pfref{not-satormay}.
          \restorelocalsteps{1}
          \item[\text{(\ref{rule:IMatch})}]
          \begin{pfsteps*}
          \item $e=\hmatch{e_1}{\zrules}$ \BY{assumption}
          \item $\notIntro{\hmatch{e_1}{\zrules}}$ \BY{\ruleref{rule:NVMatch}} \pflabel{[match][inl]notintro}
          \item $\cmaysatisfy{\hmatch{e_1}{\zrules}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[match][inl]notintro} and \pfref{[inl]refutable}} \pflabel{[match][inl]maysat}
          \item $\csatisfyormay{\hmatch{e_1}{\zrules}}{\cinl{\hxi_1}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[match][inl]maysat}}
          \end{pfsteps*} 
          Contradicts \pfref{not-satormay}.
          \restorelocalsteps{1}
          \item[\text{(\ref{rule:IPairL}), (\ref{rule:IPairR}), (\ref{rule:IPair})}] 
          \begin{pfsteps*}
          \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
          \end{pfsteps*} 
          By rule induction over \rulesref{rules:Indet} on \pfref{eindet}, no rule applies due to syntactic contradiction.
          \restorelocalsteps{1}
          \item[\text{(\ref{rule:IInl})}] 
          \begin{pfsteps*}
          \item $e=\hinl{\tau_2'}{e_1}$ \BY{assumption}
          \item $\isIndet{e_1}$ \BY{assumption} \pflabel{[inl]e1indet}
          \end{pfsteps*} 
          By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:TInl})}]
            \begin{pfsteps*}
            \item $\tau_2'=\tau_2$ \BY{assumption}
            \item $\hexptyp{\cdot}{\Delta}{e_1}{\tau_1}$ \BY{assumption} \pflabel{[inl]e1typ}
            \item $\cnotsatisfyormay{e_1}{\hxi_1}$ \BY{\autoref{lem:satormay-inl} on \pfref{not-satormay}} \pflabel{[inl]not-satormay1}
            \item if $\inValues{e_1'}{\Delta}{e_1}$ then $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{IH on \pfref{[inl]e1indet} and \pfref{[inl]e1typ} and \pfref{[inl]c1typ} and \pfref{[inl]not-satormay1}} \pflabel{[inl]forall1}
            \end{pfsteps*} 
            To show if $\inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}}$ then $\cnotsatisfyormay{e'}{\cinl{\hxi_1}}$, we assume $\inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}}$.
            \begin{pfsteps*}
            \item $\inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}}$ \BY{assumption} \pflabel{[inl]invalues}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on \pfref{[inl]invalues}.
            \begin{byCases}
              \savelocalsteps{2}
              \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $\isVal{\hinl{\tau_2}{e_1}}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
              \restorelocalsteps{2} 
              \item[\text{(\ref{rule:IVIndet})}] 
              \begin{pfsteps*}
              \item $\notIntro{\hinl{\tau_2}{e_1}}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \autoref{lem:no-inl-notintro}
              \restorelocalsteps{2}
              \item[\text{(\ref{rule:IVInl})}] 
              \begin{pfsteps*}
              \item $e'=\hinl{\tau_2}{e_1'}$ \BY{assumption}
              \item $\inValues{e_1'}{\Delta}{e_1}$ \BY{assumption} \pflabel{[inl]invalues1}
              \item $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{\pfref{[inl]forall1} on \pfref{[inl]invalues1}} \pflabel{[inl]not-satormay1'}
              \item $\cnotsatisfyormay{\hinl{\tau_2}{e_1'}}{\cinl{\hxi_1}}$ \BY{\autoref{lem:satormay-inl} on \pfref{[inl]not-satormay1'}}
              \end{pfsteps*} 
            \end{byCases}
          \end{byCases}
          \restorelocalsteps{1}
          \item[\text{(\ref{rule:IInr})}] 
          \begin{pfsteps*}
          \item $e=\hinr{\tau_1}{e_2}$ \BY{assumption}
          \end{pfsteps*}
          To show if $\inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}}$ then $\cnotsatisfyormay{e'}{\cinl{\hxi_1}}$, we assume $\inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}}$.
          \begin{pfsteps*}
          \item $\inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}}$ \BY{assumption} \pflabel{[inr]invalues}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:inValues} on \pfref{[inr]invalues}.
          \begin{byCases}
            \savelocalsteps{2}
            \item[\text{(\ref{rule:IVVal})}]
            \begin{pfsteps*}
            \item $\isVal{\hinr{\tau_1}{e_2}}$ \BY{assumption}
            \end{pfsteps*} 
            Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
            \restorelocalsteps{2} 
            \item[\text{(\ref{rule:IVIndet})}] 
            \begin{pfsteps*}
            \item $\notIntro{\hinr{\tau_1}{e_2}}$ \BY{assumption}
            \end{pfsteps*} 
            Contradicts \autoref{lem:no-inr-notintro}
            \restorelocalsteps{2}
            \item[\text{(\ref{rule:IVInr})}] 
            \begin{pfsteps*}
            \item $e'=\hinr{\tau_1}{e_2'}$ \BY{assumption}
            \item $\cnotsatisfyormay{\hinr{\tau_1}{e_2'}}{\cinl{\hxi_1}}$ \BY{\autoref{lem:inr-notsatormay-inl}}
            \end{pfsteps*} 
          \end{byCases}
        \end{byCases} 
      \end{byCases}
    \restorelocalsteps{0}
    \item[\text{(\ref{rule:CTInr})}]
    \begin{pfsteps*}
      \item $\hxi = \cinr{\hxi_2}$ \BY{assumption}
      \item $\tau = \tsum{\tau_1}{\tau_2}$ \BY{assumption}
      \item $\ctyp{\hxi_2}{\tau_2}$ \BY{assumption} \pflabel{[inr]c2typ}
      \item $\refutable{\cinr{\hxi_2}}$ \BY{\ruleref{rule:RXInr}} \pflabel{[inr]refutable}
      \end{pfsteps*}

      By rule induction over \rulesref{rules:Final} on \pfref{efinal}.
      \begin{byCases}
        \savelocalsteps{1'}
        \item[\text{(\ref{rule:FVal})}]
          \begin{pfsteps}
          \item \isVal{e} \BY{assumption} \pflabel{[inr]eval}
          \end{pfsteps}
          By rule induction over \rulesref{rules:Value} on \pfref{[inr]eval}.
          \rulesref{rules:TExp} on \pfref{etyp}, only two pairs of rules in each set
          of rules does not conflict with each other.
          \begin{byCases}
            \savelocalsteps{1}
            \item[\text{(\ref{rule:VInl}, \ref{rule:TInl})}]
              \begin{pfsteps}
              \item e=\hinl{\tau_2}{e_1} \BY{assumption}
              \end{pfsteps}
              To show the implication, we assume $\inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}}$ and show $\cnotsatisfyormay{e'}{\cinr{\hxi_2}}$.
              \begin{pfsteps}
              \item \inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}} \BY{assumption} \pflabel{[inr-inl]invalues}
              \end{pfsteps}
              By rule induction over \rulesref{rules:inValues} on \pfref{[inr-inl]invalues}.
              \begin{byCases}
                \savelocalsteps{2}
                \item[\text{(\ref{rule:IVVal})}]
                \begin{pfsteps}
                \item e' = e = \hinl{\tau_2}{e_1} \BY{assumption}
                \item \cnotsatisfyormay{e'}{\cinr{\hxi_2}} \BY{\pfref{not-satormay}}
                \end{pfsteps}

                \restorelocalsteps{2}
                \item[\text{(\ref{rule:IVIndet})}]
                  \begin{pfsteps}
                  \item \notIntro{\hinl{\tau_2}{e_1}} \BY{assumption} \pflabel{[inr]notintro-inl}
                  \end{pfsteps}
                  By rule induction over \rulesref{rules:notintro} on
                  \pfref{[inr]notintro-inl}, no cases applies due to syntactic contradiction.

                \restorelocalsteps{2}
                \item[\text{(\ref{rule:IVInl})}]
                  \begin{pfsteps}
                  \item e' = \hinl{\tau_2}{e_1'} \BY{assumption}
                  \item \cnotsatisfyormay{e'}{\cinr{\hxi_2}} \BY{\autoref{lem:inl-notsatormay-inr}}
                  \end{pfsteps}

              \end{byCases}

            \restorelocalsteps{1}
            \item[\text{(\ref{rule:VInr}, \ref{rule:TInr})}]
              \begin{pfsteps}
              \item e=\hinr{\tau_1}{e_2} \BY{assumption}
              \item \isVal{e_2} \BY{assumption} \pflabel{[inr]e2val}
              \item \hexptyp{\cdot}{\Delta}{e_2}{\tau_2} \BY{assumption} \pflabel{[inr]e2typ}
              \item \isFinal{e_2} \BY{\ruleref{rule:FVal} on
                    \pfref{[inr]e2val}} \pflabel{[inr]e2final}
              \end{pfsteps}
              To show the implication, we assume $\inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}}$ and show $\cnotsatisfyormay{e'}{\cinr{\hxi_2}}$.
              \begin{pfsteps}
              \item \inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}} \BY{assumption} \pflabel{[inr-inr]invalues}
              \end{pfsteps}
              By rule induction over \rulesref{rules:inValues} on \pfref{[inr-inr]invalues}.
              \begin{byCases}
                \savelocalsteps{2}
                \item[\text{(\ref{rule:IVVal})}]
                \begin{pfsteps}
                \item e' = e = \hinr{\tau_1}{e_2} \BY{assumption}
                \item \cnotsatisfyormay{e'}{\cinr{\hxi_2}} \BY{\pfref{not-satormay}}
                \end{pfsteps}

                \restorelocalsteps{2}
                \item[\text{(\ref{rule:IVIndet})}]
                  \begin{pfsteps}
                  \item \notIntro{\hinr{\tau_1}{e_2}} \BY{assumption} \pflabel{[inr]notintro-inr}
                  \end{pfsteps}
                  By rule induction over \rulesref{rules:notintro} on
                  \pfref{[inr]notintro-inr}, no cases applies due to syntactic contradiction.

                \restorelocalsteps{2}
                \item[\text{(\ref{rule:IVInr})}]
                  \begin{pfsteps}
                  \item e' = \hinr{\tau_1}{e_2'} \BY{assumption}
                  \item \inValues{e_2'}{\Delta}{e_2} \BY{assumption} \pflabel{[inr-inr]invalues2}
                  \item \cnotsatisfyormay{e_2}{\hxi_2}
                    \BY{\autoref{lem:satormay-inr} on \pfref{not-satormay}} \pflabel{[inr-inr]not-satormay2}
                  \item \cnotsatisfyormay{e_2'}{\hxi_2} \BY{IH on
                      \pfref{[inr]e2final}, \pfref{[inr]e2typ},
                      \pfref{[inr]c2typ}, \pfref{[inr-inr]not-satormay2}, and
                      \pfref{[inr-inr]invalues2}} \pflabel{[inr-inr]not-satormay2'}
                  \item \cnotsatisfyormay{\hinr{\tau_1}{e_2'}}{\cinr{\hxi_2}} \BY{\autoref{lem:satormay-inr} on \pfref{[inr-inr]not-satormay2'}}
                  \end{pfsteps}

              \end{byCases}
          \end{byCases}
        \restorelocalsteps{1'}
        \item[\text{(\ref{rule:FIndet})}]
          \begin{pfsteps}
          \item \isIndet{e} \BY{assumption} \pflabel{[inl]eindet}
          \end{pfsteps}
        By rule induction over \rulesref{rules:Indet} on \pfref{eindet}.
        \begin{byCases}
          \savelocalsteps{1}
        \item[\text{(\ref{rule:IEHole})}]
          \begin{pfsteps*}
          \item $e=\hehole{u}$ \BY{assumption}
          \item $\notIntro{\hehole{u}}$ \BY{\ruleref{rule:NVEHole}}
            \pflabel{[ehole][inr]notintro}
          \item $\cmaysatisfy{\hehole{u}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CMSNotIntro} on \pfref{[ehole][inr]notintro} and
              \pfref{[inr]refutable}} \pflabel{[ehole][inr]maysat}
          \item $\csatisfyormay{\hehole{u}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CSMSMay} on \pfref{[ehole][inr]maysat}}
          \end{pfsteps*}
          Contradicts \pfref{not-satormay}. \restorelocalsteps{1}
        \item[\text{(\ref{rule:IHole})}]
          \begin{pfsteps*}
          \item $e=\hhole{e_1}{u}$ \BY{assumption}
          \item $\notIntro{\hhole{e_1}{u}}$ \BY{\ruleref{rule:NVHole}}
            \pflabel{[hole][inr]notintro}
          \item $\cmaysatisfy{\hhole{e_1}{u}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CMSNotIntro} on \pfref{[hole][inr]notintro} and
              \pfref{[inr]refutable}} \pflabel{[hole][inr]maysat}
          \item $\csatisfyormay{\hhole{e_1}{u}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CSMSMay} on \pfref{[hole][inr]maysat}}
          \end{pfsteps*}
          Contradicts \pfref{not-satormay}. \restorelocalsteps{1}
        \item[\text{(\ref{rule:IAp})}]
          \begin{pfsteps*}
          \item $e=\hap{e_1}{e_2}$ \BY{assumption}
          \item $\notIntro{\hap{e_1}{e_2}}$ \BY{\ruleref{rule:NVAp}}
            \pflabel{[ap][inr]notintro}
          \item $\cmaysatisfy{\hap{e_1}{e_2}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CMSNotIntro} on \pfref{[ap][inr]notintro} and
              \pfref{[inr]refutable}} \pflabel{[ap][inr]maysat}
          \item $\csatisfyormay{\hap{e_1}{e_2}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CSMSMay} on \pfref{[ap][inr]maysat}}
          \end{pfsteps*}
          Contradicts \pfref{not-satormay}. \restorelocalsteps{1}
        \item[\text{(\ref{rule:IFst})}]
          \begin{pfsteps*}
          \item $e=\hfst{e_1}$ \BY{assumption}
          \item $\notIntro{\hfst{e_1}}$ \BY{\ruleref{rule:NVFst}}
            \pflabel{[fst][inr]notintro}
          \item $\cmaysatisfy{\hfst{e_1}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CMSNotIntro} on \pfref{[fst][inr]notintro} and
              \pfref{[inr]refutable}} \pflabel{[fst][inr]maysat}
          \item $\csatisfyormay{\hfst{e_1}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CSMSMay} on \pfref{[fst][inr]maysat}}
          \end{pfsteps*}
          Contradicts \pfref{not-satormay}. \restorelocalsteps{1}
        \item[\text{(\ref{rule:ISnd})}]
          \begin{pfsteps*}
          \item $e=\hsnd{e_1}$ \BY{assumption}
          \item $\notIntro{\hsnd{e_1}}$ \BY{\ruleref{rule:NVSnd}}
            \pflabel{[snd][inr]notintro}
          \item $\cmaysatisfy{\hsnd{e_1}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CMSNotIntro} on \pfref{[snd][inr]notintro} and
              \pfref{[inr]refutable}} \pflabel{[snd][inr]maysat}
          \item $\csatisfyormay{\hsnd{e_1}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CSMSMay} on \pfref{[snd][inr]maysat}}
          \end{pfsteps*}
          Contradicts \pfref{not-satormay}. \restorelocalsteps{1}
        \item[\text{(\ref{rule:IMatch})}]
          \begin{pfsteps*}
          \item $e=\hmatch{e_1}{\zrules}$ \BY{assumption}
          \item $\notIntro{\hmatch{e_1}{\zrules}}$ \BY{\ruleref{rule:NVMatch}}
            \pflabel{[match][inr]notintro}
          \item $\cmaysatisfy{\hmatch{e_1}{\zrules}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CMSNotIntro} on \pfref{[match][inr]notintro} and
              \pfref{[inr]refutable}} \pflabel{[match][inr]maysat}
          \item $\csatisfyormay{\hmatch{e_1}{\zrules}}{\cinr{\hxi_2}}$
            \BY{\ruleref{rule:CSMSMay} on \pfref{[match][inr]maysat}}
          \end{pfsteps*}
          Contradicts \pfref{not-satormay}. \restorelocalsteps{1}
        \item[\text{(\ref{rule:IPairL}), (\ref{rule:IPairR}),
            (\ref{rule:IPair})}]
          \begin{pfsteps*}
          \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:Indet} on \pfref{eindet}, no
          rule applies due to syntactic contradiction. \restorelocalsteps{1}
        \item[\text{(\ref{rule:IInl})}]
          \begin{pfsteps*}
          \item $e=\hinl{\tau_2}{e_1}$ \BY{assumption}
          \end{pfsteps*}
          To show if $\inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}}$ then
          $\cnotsatisfyormay{e'}{\cinr{\hxi_2}}$, we assume
          $\inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}}$.
          \begin{pfsteps*}
          \item $\inValues{e'}{\Delta}{\hinl{\tau_2}{e_1}}$ \BY{assumption}
            \pflabel{[inl][inr]invalues}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:inValues} on
          \pfref{[inl][inr]invalues}.
          \begin{byCases}
            \savelocalsteps{2}
          \item[\text{(\ref{rule:IVVal})}]
            \begin{pfsteps*}
            \item $\isVal{\hinl{\tau_2}{e_1}}$ \BY{assumption}
            \end{pfsteps*}
            Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
            \restorelocalsteps{2}
          \item[\text{(\ref{rule:IVIndet})}]
            \begin{pfsteps*}
            \item $\notIntro{\hinl{\tau_2}{e_1}}$ \BY{assumption}
            \end{pfsteps*}
            Contradicts \autoref{lem:no-inl-notintro} \restorelocalsteps{2}
          \item[\text{(\ref{rule:IVInl})}]
            \begin{pfsteps*}
            \item $e'=\hinl{\tau_2}{e_1'}$ \BY{assumption}
            \item $\cnotsatisfyormay{\hinl{\tau_2}{e_1'}}{\cinr{\hxi_2}}$
              \BY{\autoref{lem:inl-notsatormay-inr}}
            \end{pfsteps*}
          \end{byCases}
          \restorelocalsteps{1}
        \item[\text{(\ref{rule:IInr})}]
          \begin{pfsteps*}
          \item $e=\hinr{\tau_1'}{e_2}$ \BY{assumption}
          \item $\isIndet{e_2}$ \BY{assumption} \pflabel{[inr]e2indet}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, only one
          rule applies.
          \begin{byCases}
          \item[\text{(\ref{rule:TInr})}]
            \begin{pfsteps*}
            \item $\tau_1'=\tau_1$ \BY{assumption}
            \item $\hexptyp{\cdot}{\Delta}{e_2}{\tau_2}$ \BY{assumption}
              \pflabel{[inr]e2typ}
            \item $\cnotsatisfyormay{e_2}{\hxi_2}$
              \BY{\autoref{lem:satormay-inl} on \pfref{not-satormay}}
              \pflabel{[inr]not-satormay2}
            \item if $\inValues{e_2'}{\Delta}{e_2}$ then
              $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{IH on \pfref{[inr]e2indet}
                and \pfref{[inr]e2typ} and \pfref{[inr]c2typ} and
                \pfref{[inr]not-satormay2}} \pflabel{[inr]forall2}
            \end{pfsteps*}
            To show if $\inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}}$ then
            $\cnotsatisfyormay{e'}{\cinr{\hxi_2}}$, we assume
            $\inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}}$.
            \begin{pfsteps*}
            \item $\inValues{e'}{\Delta}{\hinr{\tau_1}{e_2}}$ \BY{assumption}
              \pflabel{[inr][inr]invalues}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on
            \pfref{[inr][inr]invalues}.
            \begin{byCases}
              \savelocalsteps{2}
            \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $\isVal{\hinr{\tau_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*}
              Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
              \restorelocalsteps{2}
            \item[\text{(\ref{rule:IVIndet})}]
              \begin{pfsteps*}
              \item $\notIntro{\hinr{\tau_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*}
              Contradicts \autoref{lem:no-inr-notintro} \restorelocalsteps{2}
            \item[\text{(\ref{rule:IVInr})}]
              \begin{pfsteps*}
              \item $e'=\hinr{\tau_1}{e_2'}$ \BY{assumption}
              \item $\inValues{e_2'}{\Delta}{e_2}$ \BY{assumption}
                \pflabel{[inr]invalues2}
              \item $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{\pfref{[inr]forall2}
                  on \pfref{[inr]invalues2}} \pflabel{[inr]not-satormay2'}
              \item $\cnotsatisfyormay{\hinr{\tau_1}{e_2'}}{\cinr{\hxi_2}}$
                \BY{\autoref{lem:satormay-inr} on \pfref{[inr]not-satormay2'}}
              \end{pfsteps*}
            \end{byCases}
          \end{byCases}
        \end{byCases}
      \end{byCases}
      \restorelocalsteps{0}
    \item[\text{(\ref{rule:CTPair})}]
    \begin{pfsteps*}
    \item $\hxi=\cpair{\hxi_1}{\hxi_2}$ \BY{assumption}
    \item $\tau=\tprod{\tau_1}{\tau_2}$ \BY{assumption}
    \item $\ctyp{\hxi_1}{\tau_1}$ \BY{assumption} \pflabel{[pair]c1typ}
    \item $\ctyp{\hxi_2}{\tau_2}$ \BY{assumption} \pflabel{[pair]c2typ}
    \end{pfsteps*} 

    By rule induction over \rulesref{rules:Final} on \pfref{efinal}
    \begin{byCases}
      \savelocalsteps{1'}
    \item[\text{(\ref{rule:FVal})}]
      \begin{pfsteps}
      \item \isVal{e} \BY{assumption} \pflabel{[pair]eval}
      \end{pfsteps}
      By rule induction over \rulesref{rules:Value} on \pfref{[pair]eval} and
      \rulesref{rules:TExp} on \pfref{etyp}, only one case in each set
      of rules does not conflict with each other.
      \begin{byCases}
      \item[\text{(\ref{rule:VPair}) and (\ref{rule:TPair})}]
        \begin{pfsteps}
        \item e = \hpair{e_1}{e_2} \BY{assumption}
        \item \isVal{e_1} \BY{assumption} \pflabel{[pair]e1val}
        \item \isVal{e_2} \BY{assumption} \pflabel{[pair]e2val}
        \item \hexptyp{\cdot}{\Delta}{e_1}{\tau_1} \BY{assumption} \pflabel{[pair]e1typ}
        \item \hexptyp{\cdot}{\Delta}{e_2}{\tau_2} \BY{assumption} \pflabel{[pair]e2typ}
        \item \isFinal{e_1} \BY{\ruleref{rule:FVal} on \pfref{[pair]e1val}} \pflabel{[pair]e1final}
        \item \isFinal{e_2} \BY{\ruleref{rule:FVal} on \pfref{[pair]e2val}} \pflabel{[pair]e2final}
        \end{pfsteps}
        To show the implication, we assume $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ and show $\cnotsatisfyormay{e'}{\cpair{\hxi_1}{\hxi_2}}$.
        \begin{pfsteps}
        \item \inValues{e'}{\Delta}{\hpair{e_1}{e_2}} \BY{assumption} \pflabel{[pair]invalues}
        \end{pfsteps}
        By rule induction over \rulesref{rules:inValues} on \pfref{[pair]invalues}.
        \begin{byCases}

          \savelocalsteps{2}
        \item[\text{(\ref{rule:IVVal})}]
          \begin{pfsteps}
          \item e' = e = \hpair{e_1}{e_2} \BY{assumption}
          \item \cnotsatisfyormay{e'}{\cpair{\hxi_1}{\hxi_2}} \BY{\pfref{not-satormay}}
          \end{pfsteps}

          \restorelocalsteps{2}
        \item[\text{(\ref{rule:IVIndet})}]
          \begin{pfsteps}
          \item \notIntro{\hpair{e_1}{e_2}} \BY{assumption} \pflabel{[pair]notintro-pair}
          \end{pfsteps}
          By rule induction over \rulesref{rules:notintro} on
          \pfref{[pair]notintro-pair}, no cases applies due to syntactic contradiction.

          \restorelocalsteps{2}
        \item[\text{(\ref{rule:IVPair})}]
          \begin{pfsteps}
          \item e' = \hpair{e_1'}{e_2'} \BY{assumption}
          \item \inValues{e_1'}{\Delta}{e_1} \BY{assumption} \pflabel{[pair]invalues1}
          \item \inValues{e_2'}{\Delta}{e_2} \BY{assumption} \pflabel{[pair]invalues2}
          \item \cnotsatisfyormay{e_1}{\hxi_1}
            \BY{\autoref{lem:satormay-pair} on \pfref{not-satormay}} \pflabel{[pair]not-satormay1}
          \item \cnotsatisfyormay{e_2}{\hxi_2}
            \BY{\autoref{lem:satormay-pair} on \pfref{not-satormay}} \pflabel{[pair]not-satormay2}
          \item \cnotsatisfyormay{e_1'}{\hxi_1} \BY{IH on
              \pfref{[pair]e1final}, \pfref{[pair]e1typ},
              \pfref{[pair]c1typ}, \pfref{[pair]not-satormay1}, and
              \pfref{[pair]invalues1}} \pflabel{[pair]not-satormay1'}
          \item \cnotsatisfyormay{e_2'}{\hxi_2} \BY{IH on
              \pfref{[pair]e2final}, \pfref{[pair]e2typ},
              \pfref{[pair]c2typ}, \pfref{[pair]not-satormay2}, and
              \pfref{[pair]invalues2}} \pflabel{[pair]not-satormay2'}
          \item \cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}
            \BY{\autoref{lem:satormay-pair} on \pfref{[pair]not-satormay1'} and \pfref{[pair]not-satormay2'}}
          \end{pfsteps}
        \end{byCases}
      \end{byCases}

      \restorelocalsteps{1'}
    \item[\text{(\ref{rule:FIndet})}]
      \begin{pfsteps}
      \item \isIndet{e} \BY{assumption} \pflabel{[pair]eindet}
      \end{pfsteps}
      By rule induction over \rulesref{rules:Indet} on \pfref{[pair]eindet}.
      \begin{byCases}
        \savelocalsteps{1}
        \item[\text{(\ref{rule:IEHole}), (\ref{rule:IHole}), (\ref{rule:IAp}), (\ref{rule:IFst}), (\ref{rule:ISnd}), (\ref{rule:IMatch})}]
        \begin{pfsteps*}
        \item $e=\hehole{u}, \hhole{e_1}{u}, \hap{e_1}{e_2}, \hfst{e_1}, \hsnd{e_1}, \hmatch{e_1}{\zrules}$ \BY{assumption}
        \item $\notIntro{e}$ \BY{\rulesref{rules:notintro}} \pflabel{[pair]notintro}
        \item $\notIntro{\hfst{e}}$ \BY{\ruleref{rule:NVFst}} \pflabel{[pair]fstnotintro}
        \item $\notIntro{\hsnd{e}}$ \BY{\ruleref{rule:NVSnd}} \pflabel{[pair]sndnotintro}
        \item $\isIndet{\hfst{e}}$ \BY{\ruleref{rule:IFst} on \pfref{eindet}} \pflabel{[pair]fstindet}
        \item $\isIndet{\hsnd{e}}$ \BY{\ruleref{rule:ISnd} on \pfref{eindet}} \pflabel{[pair]sndindet}
        \item $\hexptyp{\cdot}{\Delta}{\hfst{e}}{\tau_1}$ \BY{\ruleref{rule:TFst} on \pfref{etyp}} \pflabel{[pair]fsttyp}
        \item $\hexptyp{\cdot}{\Delta}{\hsnd{e}}{\tau_2}$ \BY{\ruleref{rule:TSnd} on \pfref{etyp}} \pflabel{[pair]sndtyp}
        \end{pfsteps*}
        By case analysis on the result of $\fsatisfyormay{\hfst{e}}{\hxi_1}$.
        \begin{byCases}
          \savelocalsteps{2}
          \item[\true]
          \begin{pfsteps*}
          \item $\fsatisfyormay{\hfst{e}}{\hxi_1}=\true$ \BY{assumption} \pflabel{[pair]fsatormay1}
          \item $\csatisfyormay{\hfst{e}}{\hxi_1}$ \BY{\autoref{lem:sound-complete-satormay} on \pfref{[pair]fsatormay1}} \pflabel{[pair]satormay1}
          \end{pfsteps*} 
          By case analysis on the result of $\fsatisfyormay{\hsnd{e}}{\hxi_2}$.
          \begin{byCases}
            \savelocalsteps{3}
            \item[\true]
            \begin{pfsteps*}
            \item $\fsatisfyormay{\hsnd{e}}{\hxi_2}=\true$ \BY{assumption} \pflabel{[pair]fsatormay2}
            \item $\csatisfyormay{\hsnd{e}}{\hxi_2}$ \BY{\autoref{lem:sound-complete-satormay} on \pfref{[pair]fsatormay2}} \pflabel{[pair]satormay2}
            \end{pfsteps*}  
            By rule induction over \rulesref{rules:satormay} on \pfref{[pair]satormay1}.
            \begin{byCases}
              \savelocalsteps{4}
              \item[\text{(\ref{rule:CSMSSat})}]
              \begin{pfsteps*}
              \item $\csatisfy{\hfst{e}}{\hxi_1}$ \BY{asssumption} \pflabel{[pair]satisfy1}
              \end{pfsteps*} 
              By rule induction over \rulesref{rules:satormay} on \pfref{[pair]satormay2}.
              \begin{byCases}
                \savelocalsteps{5}
                \item[\text{(\ref{rule:CSMSSat})}]
                \begin{pfsteps*}
                \item $\csatisfy{\hsnd{e}}{\hxi_2}$ \BY{asssumption} \pflabel{[pair]satisfy2}
                \item $\csatisfy{e}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\ruleref{rule:CSNotIntroPair} on \pfref{[pair]notintro} and \pfref{[pair]satisfy1} and \pfref{[pair]satisfy2}} \pflabel{[pair]satisfy}
                \item $\csatisfyormay{e}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\ruleref{rule:CSMSSat} on \pfref{[pair]satisfy}}
                \end{pfsteps*} 
                Contradicts \pfref{not-satormay}.
                \restorelocalsteps{5}
                \item[\text{(\ref{rule:CSMSMay})}]
                \begin{pfsteps*}
                \item $\cmaysatisfy{\hsnd{e}}{\hxi_2}$ \BY{assumption} \pflabel{[pair]maysat2}
                \item $\refutable{\hxi_2}$ \BY{\autoref{lem:notintro-maysat-or-notsat-refutable} on \pfref{[pair]sndnotintro} and \pfref{[pair]maysat2}} \pflabel{[pair]refutable2}
                \item $\refutable{\cpair{\hxi_1}{\hxi_2}}$ \BY{\ruleref{rule:RXPairR} on \pfref{[pair]refutable2}} \pflabel{[pair]refutable}
                \item $\cmaysatisfy{e}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[pair]notintro} and \pfref{[pair]refutable}} \pflabel{[pair]maysat}
                \item $\csatisfyormay{e}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[pair]maysat}}
                \end{pfsteps*} 
              \end{byCases}
              \restorelocalsteps{4} 
              \item[\text{(\ref{rule:CSMSMay})}]
              \begin{pfsteps*}
              \item $\cmaysatisfy{\hfst{e}}{\hxi_1}$ \BY{assumption} \pflabel{[pair]maysat1}
              \item $\refutable{\hxi_1}$ \BY{\autoref{lem:notintro-maysat-or-notsat-refutable} on \pfref{[pair]fstnotintro} and \pfref{[pair]maysat1}} \pflabel{[pair]refutable1}
              \item $\refutable{\cpair{\hxi_1}{\hxi_2}}$ \BY{\ruleref{rule:RXPairL} on \pfref{[pair]refutable1}} \pflabel{[pair]refutable'}
              \item $\cmaysatisfy{e}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[pair]notintro} and \pfref{[pair]refutable'}} \pflabel{[pair]maysat'}
              \item $\csatisfyormay{e}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\ruleref{rule:CSMSMay} on \pfref{[pair]maysat'}}
              \end{pfsteps*} 
            \end{byCases} 
            \restorelocalsteps{3} 
            \item[\false]
            \begin{pfsteps*}
            \item $\fsatisfyormay{\hsnd{e}}{\hxi_2} = \false$ \BY{assumption} \pflabel{[pair]not-fsatormay2}
            \item $\csatisfyormay{\hsnd{e}}{\hxi_2}$ \BY{\autoref{lem:sound-complete-satormay} on \pfref{[pair]not-fsatormay2}} \pflabel{[pair]not-satormay2}
            \item if $\inValues{e_2'}{\Delta}{\hsnd{e}}$ then $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{IH on \pfref{[pair]sndindet} and \pfref{[pair]sndtyp} and \pfref{[pair]c2typ} and \pfref{[pair]not-satormay2}} \pflabel{[pair]complete2}
            \end{pfsteps*} 
            To show if $\inValues{e'}{\Delta}{e}$ then $\cnotsatisfyormay{e'}{\cpair{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{e}$.
            \begin{pfsteps*}
            \item $\inValues{e'}{\Delta}{e}$ \BY{assumption} \pflabel{e'invalues'}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on \pfref{e'invalues'}, only two rules apply.
            \begin{byCases}
              \savelocalsteps{4}
              \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $\isVal{e}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
              \restorelocalsteps{4} 
              \item[\text{(\ref{rule:IVIndet})}] 
              \begin{pfsteps*}
              \item $\isVal{e'}$ \BY{assumption} \pflabel{e'val'}
              \item $\hexptyp{\cdot}{\Delta}{e'}{\tprod{\tau_1}{\tau_2}}$ \BY{assumption} \pflabel{e'typ'}
              \end{pfsteps*}
              By rule induction over \rulesref{rules:Value} on \pfref{e'val'}.
              \begin{byCases}
                \savelocalsteps{5}
                \item[\text{(\ref{rule:VNum})}]
                \begin{pfsteps*}
                \item $e'=\hnum{n}$ \BY{assumption}
                \end{pfsteps*} 
                By rule induction over \rulesref{rules:TExp} on \pfref{e'typ'}, no rule applies due to syntactic contradiction.
                \restorelocalsteps{5}
                \item[\text{(\ref{rule:VLam})}]
                \begin{pfsteps*} 
                \item $e'=\hlam{x}{\tau'}{e_1'}$ \BY{assumption}
                \end{pfsteps*}
                By rule induction over \rulesref{rules:TExp} on \pfref{e'typ'}, no rule applies due to syntactic contradiction.
                \restorelocalsteps{5}
                \item[\text{(\ref{rule:VPair})}] 
                \begin{pfsteps*} 
                \item $e'=\hpair{e_1'}{e_2'}$ \BY{assumption}
                \item $\isVal{e_2'}$ \BY{assumption} \pflabel{e2'val}
                \end{pfsteps*}
                By rule induction over \rulesref{rules:TExp} on \pfref{e'typ'}, only one rule applies. \\
                  \textbf{Case} \text{(\ref{rule:TPair})}\textbf{.}
                  \begin{pfsteps*}
                  \item $\hexptyp{\cdot}{\Delta}{e_2'}{\tau_2}$ \BY{assumption} \pflabel{e2'typ}
                  \item $\inValues{e_2'}{\Delta}{\hsnd{e}}$ \BY{\ruleref{rule:IVIndet} on \pfref{[pair]sndnotintro} and \pfref{[pair]sndtyp} and \pfref{e2'val} and \pfref{e2'typ}} \pflabel{e2'invalues}
                  \item $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{\pfref{[pair]complete2} on \pfref{e2'invalues}} \pflabel{[pair]not-satormay2'}
                  \item $\cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair]not-satormay1'}}
                  \end{pfsteps*}
                \restorelocalsteps{5}
                \item[\text{(\ref{rule:VInl})}] 
                \begin{pfsteps*} 
                \item $e'=\hinl{\tau_2}{e_1'}$ \BY{assumption}
                \end{pfsteps*}
                By rule induction over \rulesref{rules:TExp} on \pfref{e'typ'}, no rule applies due to syntactic contradiction.
                \restorelocalsteps{5}
                \item[\text{(\ref{rule:VInr})}] 
                \begin{pfsteps*} 
                \item $e'=\hinr{\tau_1}{e_2'}$ \BY{assumption}
                \end{pfsteps*}
                By rule induction over \rulesref{rules:TExp} on \pfref{e'typ'}, no rule applies due to syntactic contradiction.
              \end{byCases}
            \end{byCases}
          \end{byCases}

          \restorelocalsteps{2}
          \item[\false] 
          \begin{pfsteps*}
          \item $\fsatisfyormay{\hfst{e}}{\hxi_1}=\false$ \BY{assumption} \pflabel{[pair]not-fsatormay1}
          \item $\cnotsatisfyormay{\hfst{e}}{\hxi_1}$ \BY{\autoref{lem:sound-complete-satormay} on \pfref{[pair]not-fsatormay1}} \pflabel{[pair]not-satormay1}
          \item if $\inValues{e_1'}{\Delta}{\hfst{e}}$ then $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{IH on \pfref{[pair]fstindet} and \pfref{[pair]fsttyp} and \pfref{[pair]c1typ} and \pfref{[pair]not-satormay1}} \pflabel{[pair]complete1}
          \end{pfsteps*} 
          To show if $\inValues{e'}{\Delta}{e}$ then $\cnotsatisfyormay{e'}{\cpair{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{e}$.
          \begin{pfsteps*}
          \item $\inValues{e'}{\Delta}{e}$ \BY{assumption} \pflabel{e'invalues}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:inValues} on \pfref{e'invalues}, only two rules apply.
          \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:IVVal})}]
            \begin{pfsteps*}
            \item $\isVal{e}$ \BY{assumption}
            \end{pfsteps*} 
            Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
            \restorelocalsteps{3} 
            \item[\text{(\ref{rule:IVIndet})}] 
            \begin{pfsteps*}
            \item $\isVal{e'}$ \BY{assumption} \pflabel{e'val}
            \item $\hexptyp{\cdot}{\Delta}{e'}{\tprod{\tau_1}{\tau_2}}$ \BY{assumption} \pflabel{e'typ}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:Value} on \pfref{e'val}.
            \begin{byCases}
              \savelocalsteps{3}
              \item[\text{(\ref{rule:VNum})}]
              \begin{pfsteps*}
              \item $e'=\hnum{n}$ \BY{assumption}
              \end{pfsteps*} 
              By rule induction over \rulesref{rules:TExp} on \pfref{e'typ}, no rule applies due to syntactic contradiction.
              \restorelocalsteps{3}
              \item[\text{(\ref{rule:VLam})}]
              \begin{pfsteps*} 
              \item $e'=\hlam{x}{\tau'}{e_1'}$ \BY{assumption}
              \end{pfsteps*}
              By rule induction over \rulesref{rules:TExp} on \pfref{e'typ}, no rule applies due to syntactic contradiction.
              \restorelocalsteps{3}
              \item[\text{(\ref{rule:VPair})}] 
              \begin{pfsteps*} 
              \item $e'=\hpair{e_1'}{e_2'}$ \BY{assumption}
              \item $\isVal{e_1'}$ \BY{assumption} \pflabel{e1'val}
              \end{pfsteps*}
              By rule induction over \rulesref{rules:TExp} on \pfref{e'typ}, only one rule applies.
              \begin{byCases}
                \item[\text{(\ref{rule:TPair})}]
                \begin{pfsteps*}
                \item $\hexptyp{\cdot}{\Delta}{e_1'}{\tau_1}$ \BY{assumption} \pflabel{e1'typ}
                \item $\inValues{e_1'}{\Delta}{\hfst{e}}$ \BY{\ruleref{rule:IVIndet} on \pfref{[pair]fstnotintro} and \pfref{[pair]fsttyp} and \pfref{e1'val} and \pfref{e1'typ}} \pflabel{e1'invalues}
                \item $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{\pfref{[pair]complete1} on \pfref{e1'invalues}} \pflabel{[pair]not-satormay1'}
                \item $\cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair]not-satormay1'}}
                \end{pfsteps*} 
              \end{byCases}
              \restorelocalsteps{3}
              \item[\text{(\ref{rule:VInl})}] 
              \begin{pfsteps*} 
              \item $e'=\hinl{\tau_2}{e_1'}$ \BY{assumption}
              \end{pfsteps*}
              By rule induction over \rulesref{rules:TExp} on \pfref{e'typ}, no rule applies due to syntactic contradiction.
              \restorelocalsteps{3}
              \item[\text{(\ref{rule:VInr})}] 
              \begin{pfsteps*} 
              \item $e'=\hinr{\tau_1}{e_2'}$ \BY{assumption}
              \end{pfsteps*}
              By rule induction over \rulesref{rules:TExp} on \pfref{e'typ}, no rule applies due to syntactic contradiction.
            \end{byCases}
          \end{byCases}
        \end{byCases}
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IPairL})}] 
        \begin{pfsteps*}
        \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
        \item $\isIndet{e_1}$ \BY{assumption} \pflabel{[pair1]e1indet}
        \item $\isVal{e_2}$ \BY{assumption} \pflabel{[pair1]e2val}
        \item $\cnotsatisfyormay{e_1}{\hxi_1}$ or $\cnotsatisfyormay{e_2}{\hxi_2}$ \BY{\autoref{lem:satormay-pair} on \pfref{not-satormay}} \pflabel{[pair1]not-satormay-1or2}
        \end{pfsteps*}
        By case analysis on the disjunction in \pfref{[pair1]not-satormay-1or2}.
        \begin{byCases}
          \savelocalsteps{2}
          \item[\cnotsatisfyormay{e_1}{\hxi_1}]
          \begin{pfsteps*}
          \item $\cnotsatisfyormay{e_1}{\hxi_1}$ \BY{assumption} \pflabel{[pair1]not-satormay-1}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:TPair})}]
            \begin{pfsteps*}
            \item $\hexptyp{\cdot}{\Delta}{e_1}{\tau_1}$ \BY{assumption} \pflabel{[pair1]e1typ}
            \item if $\inValues{e_1'}{\Delta}{e_1}$ then $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{IH on \pfref{[pair1]e1indet} and \pfref{[pair1]e1typ} and \pfref{[pair]c1typ} and \pfref{[pair1]not-satormay-1}} \pflabel{[pair1]complete1}
            \end{pfsteps*} 
            To show that if $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ then $\cnotsatisfyormay{\hpair{e_1}{e_2}}{\cpair{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$.
            \begin{pfsteps*}
            \item $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ \BY{assumption} \pflabel{[pair1]invalues}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on \pfref{[pair1]invalues}.
            \begin{byCases}
              \savelocalsteps{3}
              \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $\isVal{\hpair{e_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
              \restorelocalsteps{3} 
              \item[\text{(\ref{rule:IVIndet})}] 
              \begin{pfsteps*}
              \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*}
              Contradicts \autoref{lem:no-pair-notintro}.
              \restorelocalsteps{3}
              \item[\text{(\ref{rule:IVPair})}]
              \begin{pfsteps*}
              \item $e'=\hpair{e_1'}{e_2'}$ \BY{assumption}
              \item $\inValues{e_1'}{\Delta}{e_1}$ \BY{assumption} \pflabel{[pair1]invalues1}
              \item $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{\pfref{[pair1]complete1} on \pfref{[pair1]invalues1}} \pflabel{[pair1]not-satormay1}
              \item $\cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair1]not-satormay1}}
              \end{pfsteps*} 
            \end{byCases}
          \end{byCases}
          \restorelocalsteps{2}
          \item[\cnotsatisfyormay{e_2}{\hxi_2}]
          \begin{pfsteps*}
          \item $\cnotsatisfyormay{e_2}{\hxi_2}$ \BY{assumption} \pflabel{[pair1]not-satormay-2}
          \end{pfsteps*}
          To show that if $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ then $\cnotsatisfyormay{\hpair{e_1}{e_2}}{\cpair{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$.
          \begin{pfsteps*}
          \item $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ \BY{assumption} \pflabel{[pair1]invalues'}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:inValues} on \pfref{[pair1]invalues'}.
          \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:IVVal})}]
            \begin{pfsteps*}
            \item $\isVal{\hpair{e_1}{e_2}}$ \BY{assumption}
            \end{pfsteps*} 
            Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
            \restorelocalsteps{3} 
            \item[\text{(\ref{rule:IVIndet})}] 
            \begin{pfsteps*}
            \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
            \end{pfsteps*}
            Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:IVPair})}]
            \begin{pfsteps*}
            \item $e'=\hpair{e_1'}{e_2'}$ \BY{assumption}
            \item $\inValues{e_2'}{\Delta}{e_2}$ \BY{assumption} \pflabel{[pair1]invalues1'}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on \pfref{[pair1]invalues1'}.
            \begin{byCases}
              \savelocalsteps{4}
              \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $e_2'=e_2$ \BY{assumption} \pflabel{subst}
              \item $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{\pfref{subst} and \pfref{[pair1]not-satormay-2}} \pflabel{[pair1]not-satormay-2'}
              \item $\cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair1]not-satormay-2'}}
              \end{pfsteps*} 
              \restorelocalsteps{4} 
              \item[\text{(\ref{rule:IVIndet})}]
              \begin{pfsteps*}
              \item $\notIntro{e_2}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{[pair1]e2val} by \autoref{lem:val-not-notintro}.
              \restorelocalsteps{4} 
              \item[\text{(\ref{rule:IVInl}), (\ref{rule:IVInr}), (\ref{rule:IVPair})}]
              \begin{pfsteps*}
              \item $\isIndet{e_2}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{[pair1]e2val} by \autoref{lem:val-not-indet}.
            \end{byCases}
          \end{byCases}
        \end{byCases}
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IPairR})}] 
        \begin{pfsteps*}
        \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
        \item $\isVal{e_1}$ \BY{assumption} \pflabel{[pair2]e1val}
        \item $\isIndet{e_2}$ \BY{assumption} \pflabel{[pair2]e2indet}
        \item $\cnotsatisfyormay{e_1}{\hxi_1}$ or $\cnotsatisfyormay{e_2}{\hxi_2}$ \BY{\autoref{lem:satormay-pair} on \pfref{not-satormay}} \pflabel{[pair2]not-satormay-1or2}
        \end{pfsteps*}
        By case analysis on the disjunction in \pfref{[pair2]not-satormay-1or2}.
        \begin{byCases}
          \savelocalsteps{2}
          \item[\cnotsatisfyormay{e_1}{\hxi_1}]
          \begin{pfsteps*}
          \item $\cnotsatisfyormay{e_1}{\hxi_1}$ \BY{assumption} \pflabel{[pair2]not-satormay-1}
          \end{pfsteps*}
          To show that if $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ then $\cnotsatisfyormay{\hpair{e_1}{e_2}}{\cpair{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$.
          \begin{pfsteps*}
          \item $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ \BY{assumption} \pflabel{[pair2]invalues'}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:inValues} on \pfref{[pair2]invalues'}.
          \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:IVVal})}]
            \begin{pfsteps*}
            \item $\isVal{\hpair{e_1}{e_2}}$ \BY{assumption}
            \end{pfsteps*} 
            Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
            \restorelocalsteps{3} 
            \item[\text{(\ref{rule:IVIndet})}] 
            \begin{pfsteps*}
            \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
            \end{pfsteps*}
            Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:IVPair})}]
            \begin{pfsteps*}
            \item $e'=\hpair{e_1'}{e_2'}$ \BY{assumption}
            \item $\inValues{e_1'}{\Delta}{e_1}$ \BY{assumption} \pflabel{[pair2]invalues1'}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on \pfref{[pair2]invalues1'}.
            \begin{byCases}
              \savelocalsteps{4}
              \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $e_1'=e_1$ \BY{assumption} \pflabel{[pair2]subst}
              \item $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{\pfref{[pair2]subst} and \pfref{[pair2]not-satormay-1}} \pflabel{[pair2]not-satormay-1'}
              \item $\cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair2]not-satormay-1'}}
              \end{pfsteps*} 
              \restorelocalsteps{4} 
              \item[\text{(\ref{rule:IVIndet})}]
              \begin{pfsteps*}
              \item $\notIntro{e_1}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{[pair2]e1val} by \autoref{lem:val-not-notintro}.
              \restorelocalsteps{4} 
              \item[\text{(\ref{rule:IVInl}), (\ref{rule:IVInr}), (\ref{rule:IVPair})}]
              \begin{pfsteps*}
              \item $\isIndet{e_1}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{[pair2]e1val} by \autoref{lem:val-not-indet}.
            \end{byCases}
          \end{byCases}
          \restorelocalsteps{2}
          \item[\cnotsatisfyormay{e_2}{\hxi_2}]
          \begin{pfsteps*}
          \item $\cnotsatisfyormay{e_2}{\hxi_2}$ \BY{assumption} \pflabel{[pair2]not-satormay-2}
          \end{pfsteps*}
          By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, only one rule applies.
          \begin{byCases}
            \item[\text{(\ref{rule:TPair})}]
            \begin{pfsteps*}
            \item $\hexptyp{\cdot}{\Delta}{e_2}{\tau_2}$ \BY{assumption} \pflabel{[pair2]e2typ}
            \item if $\inValues{e_2'}{\Delta}{e_2}$ then $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{IH on \pfref{[pair2]e2indet} and \pfref{[pair2]e2typ} and \pfref{[pair]c2typ} and \pfref{[pair2]not-satormay-2}} \pflabel{[pair2]complete2}
            \end{pfsteps*} 
            To show that if $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ then $\cnotsatisfyormay{\hpair{e_1}{e_2}}{\cpair{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$.
            \begin{pfsteps*}
            \item $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ \BY{assumption} \pflabel{[pair2]invalues}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on \pfref{[pair2]invalues}.
            \begin{byCases}
              \savelocalsteps{3}
              \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $\isVal{\hpair{e_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
              \restorelocalsteps{3} 
              \item[\text{(\ref{rule:IVIndet})}] 
              \begin{pfsteps*}
              \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*}
              Contradicts \autoref{lem:no-pair-notintro}.
              \restorelocalsteps{3}
              \item[\text{(\ref{rule:IVPair})}]
              \begin{pfsteps*}
              \item $e'=\hpair{e_1'}{e_2'}$ \BY{assumption}
              \item $\inValues{e_2'}{\Delta}{e_2}$ \BY{assumption} \pflabel{[pair2]invalues2}
              \item $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{\pfref{[pair2]complete2} on \pfref{[pair2]invalues2}} \pflabel{[pair2]not-satormay2}
              \item $\cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair2]not-satormay2}}
              \end{pfsteps*} 
            \end{byCases}
          \end{byCases}
        \end{byCases}
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IPair})}] 
        \begin{pfsteps*}
        \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
        \item $\isIndet{e_1}$ \BY{assumption} \pflabel{[pair3]e1indet}
        \item $\isIndet{e_2}$ \BY{assumption} \pflabel{[pair3]e2indet}
        \item $\cnotsatisfyormay{e_1}{\hxi_1}$ or $\cnotsatisfyormay{e_2}{\hxi_2}$ \BY{\autoref{lem:satormay-pair} on \pfref{not-satormay}} \pflabel{[pair3]not-satormay-1or2}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, only one rule applies.
        \begin{byCases}
          \item[\text{(\ref{rule:TPair})}]
          \begin{pfsteps*}
          \item $\hexptyp{\cdot}{\Delta}{e_1}{\tau_1}$ \BY{assumption} \pflabel{[pair3]e1typ}
          \item $\hexptyp{\cdot}{\Delta}{e_2}{\tau_2}$ \BY{assumption} \pflabel{[pair3]e2typ}
          \end{pfsteps*} 
          By case analysis on the disjunction in \pfref{[pair3]not-satormay-1or2}.
          \begin{byCases}
            \savelocalsteps{2}
            \item[\cnotsatisfyormay{e_1}{\hxi_1}]
            \begin{pfsteps*}
            \item $\cnotsatisfyormay{e_1}{\hxi_1}$ \BY{assumption} \pflabel{[pair3]not-satormay-1}
            \item if $\inValues{e_1'}{\Delta}{e_1}$ then $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{IH on \pfref{[pair3]e1indet} and \pfref{[pair3]e1typ} and \pfref{[pair]c1typ} and \pfref{[pair3]not-satormay-1}} \pflabel{[pair3]complete1}
            \end{pfsteps*}
            To show that if $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ then $\cnotsatisfyormay{\hpair{e_1}{e_2}}{\cpair{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$.
            \begin{pfsteps*}
            \item $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ \BY{assumption} \pflabel{[pair3]invalues}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on \pfref{[pair3]invalues}.
            \begin{byCases}
              \savelocalsteps{3}
              \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $\isVal{\hpair{e_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
              \restorelocalsteps{3} 
              \item[\text{(\ref{rule:IVIndet})}] 
              \begin{pfsteps*}
              \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*}
              Contradicts \autoref{lem:no-pair-notintro}.
              \restorelocalsteps{3}
              \item[\text{(\ref{rule:IVPair})}]
              \begin{pfsteps*}
              \item $e'=\hpair{e_1'}{e_2'}$ \BY{assumption}
              \item $\inValues{e_1'}{\Delta}{e_1}$ \BY{assumption} \pflabel{[pair3]invalues1}
              \item $\cnotsatisfyormay{e_1'}{\hxi_1}$ \BY{\pfref{[pair3]complete1} on \pfref{[pair3]invalues1}} \pflabel{[pair3]not-satormay1}
              \item $\cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair3]not-satormay1}}
              \end{pfsteps*} 
            \end{byCases}
            \restorelocalsteps{2}
            \item[\cnotsatisfyormay{e_2}{\hxi_2}]
            \begin{pfsteps*}
            \item $\cnotsatisfyormay{e_2}{\hxi_2}$ \BY{assumption} \pflabel{[pair3]not-satormay-2}
            \item if $\inValues{e_2'}{\Delta}{e_2}$ then $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{IH on \pfref{[pair3]e2indet} and \pfref{[pair3]e2typ} and \pfref{[pair]c2typ} and \pfref{[pair3]not-satormay-2}} \pflabel{[pair3]complete2}
            \end{pfsteps*}
            To show that if $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ then $\cnotsatisfyormay{\hpair{e_1}{e_2}}{\cpair{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$.
            \begin{pfsteps*}
            \item $\inValues{e'}{\Delta}{\hpair{e_1}{e_2}}$ \BY{assumption} \pflabel{[pair3]invalues'}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:inValues} on \pfref{[pair3]invalues'}.
            \begin{byCases}
              \savelocalsteps{3}
              \item[\text{(\ref{rule:IVVal})}]
              \begin{pfsteps*}
              \item $\isVal{\hpair{e_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*} 
              Contradicts \pfref{eindet} by \autoref{lem:val-not-indet}.
              \restorelocalsteps{3} 
              \item[\text{(\ref{rule:IVIndet})}] 
              \begin{pfsteps*}
              \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
              \end{pfsteps*}
              Contradicts \autoref{lem:no-pair-notintro}.
              \restorelocalsteps{3}
              \item[\text{(\ref{rule:IVPair})}]
              \begin{pfsteps*}
              \item $e'=\hpair{e_1'}{e_2'}$ \BY{assumption}
              \item $\inValues{e_2'}{\Delta}{e_2}$ \BY{assumption} \pflabel{[pair3]invalues2}
              \item $\cnotsatisfyormay{e_2'}{\hxi_2}$ \BY{\pfref{[pair3]complete2} on \pfref{[pair3]invalues2}} \pflabel{[pair3]not-satormay2}
              \item $\cnotsatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-pair} on \pfref{[pair3]not-satormay2}}
              \end{pfsteps*} 
            \end{byCases}
          \end{byCases}
        \end{byCases}
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IInl})}] 
        \begin{pfsteps*}
        \item $e=\hinl{\tau_2}{e_1}$ \BY{assumption}
        \end{pfsteps*} 
        By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, no rule applies due to syntactic contradiction.
        \restorelocalsteps{1}
        \item[\text{(\ref{rule:IInr})}] 
        \begin{pfsteps*}
        \item $e=\hinr{\tau_1'}{e_2}$ \BY{assumption}
        \end{pfsteps*} 
        By rule induction over \rulesref{rules:TExp} on \pfref{etyp}, no rule applies due to syntactic contradiction.
      \end{byCases}
    \end{byCases}

    \restorelocalsteps{0}
    \item[\text{(\ref{rule:CTOr})}]
    \begin{pfsteps*}
    \item $\hxi=\cor{\hxi_1}{\hxi_2}$ \BY{assumption}
    \item $\ctyp{\hxi_1}{\tau_1}$ \BY{assumption} \pflabel{[or]c1typ}
    \item $\ctyp{\hxi_2}{\tau_2}$ \BY{assumption} \pflabel{[or]c2typ}
    \item $\cnotsatisfyormay{e}{\cor{\hxi_1}{\hxi_2}}$ \BY{assumption} \pflabel{[or]not-satormay}
    \item $\cnotsatisfyormay{e}{\hxi_1}$ \BY{\autoref{lem:satormay-or} on \pfref{[or]not-satormay}} \pflabel{[or]not-satormay-1}
    \item $\cnotsatisfyormay{e}{\hxi_2}$ \BY{\autoref{lem:satormay-or} on \pfref{[or]not-satormay}} \pflabel{[or]not-satormay-2}
    \item if $\inValues{e'}{\Delta}{e}$ then $\cnotsatisfyormay{e'}{\hxi_1}$ \BY{IH on \pfref{eindet} and \pfref{etyp} and \pfref{[or]c1typ} and \pfref{[or]not-satormay-1}} \pflabel{[or]complete1}
    \item if $\inValues{e'}{\Delta}{e}$ then $\cnotsatisfyormay{e'}{\hxi_2}$ \BY{IH on \pfref{eindet} and \pfref{etyp} and \pfref{[or]c2typ} and \pfref{[or]not-satormay-2}} \pflabel{[or]complete2}
    \end{pfsteps*}
    To show that if $\inValues{e'}{\Delta}{e}$ then $\cnotsatisfyormay{e'}{\cor{\hxi_1}{\hxi_2}}$, we assume $\inValues{e'}{\Delta}{e}$.
    \begin{pfsteps*}
    \item $\inValues{e'}{\Delta}{e}$ \BY{assumption} \pflabel{[or]invalues}
    \item $\cnotsatisfyormay{e'}{\hxi_1}$ \BY{\pfref{[or]complete1} on \pfref{[or]invalues}} \pflabel{[or]not-satormay-1'}
    \item $\cnotsatisfyormay{e'}{\hxi_2}$ \BY{\pfref{[or]complete2} on \pfref{[or]invalues}} \pflabel{[or]not-satormay-2'}
    \item $\cnotsatisfyormay{e'}{\cor{\hxi_1}{\hxi_2}}$ \BY{\autoref{lem:satormay-or} on \pfref{[or]not-satormay-1'} and \pfref{[or]not-satormay-2'}}
    \end{pfsteps*}
  \end{byCases}

  \restorelocalsteps{iff}
  \textbf{Necessity} \\
  Since we already shown that $\csatisfyormay{e}{\hxi}$ is decidable with
  \autoref{lem:sound-complete-satormay}, we just need to prove its
  contraposition -- if $\csatisfyormay{e}{\hxi}$ then there exists
  $\inValues{e'}{\Delta}{e}$ such that $\csatisfyormay{e'}{\hxi}$.
  \begin{pfsteps}
  \item \csatisfyormay{e}{\hxi} \BY{assumption} \pflabel{satormay}
  \end{pfsteps}
  By rule induction over \rulesref{rules:satormay} on \pfref{satormay}.
  \begin{byCases}
    \savelocalsteps{0}
  \item[\text{(\ref{rule:CSMSSat})}]
    \begin{pfsteps}
    \item \csatisfy{e}{\hxi} \BY{assumption} \pflabel{satisfy}
    \end{pfsteps}
    By rule induction over \rulesref{rules:Satisfy} on \pfref{satisfy}.
    \begin{byCases}
      \savelocalsteps{1}
    \item[\text{(\ref{rule:CSTruth})}]
      \begin{pfsteps}
      \item \hxi = \ctruth \BY{assumption}
      \end{pfsteps}
      By rule induction over \rulesref{rules:Final} on \pfref{efinal}.
      \begin{byCases}
        \savelocalsteps{2}
      \item[\text{(\ref{rule:FVal})}]
        \begin{pfsteps}
        \item \isVal{e} \BY{assumption}\pflabel{[truth]eval}
        \item \inValues{e}{\Delta}{e} \BY{\ruleref{rule:IVVal} on \pfref{[truth]eval}} \pflabel{[truth]invalues}
        \end{pfsteps}
        In conclusion, we have \pfref{[truth]invalues} and \pfref{satormay}.
        \restorelocalsteps{2}
      \item[\text{(\ref{rule:FIndet})}]
        \begin{pfsteps}
        \item \isIndet{e} \BY{assumption}\pflabel{[truth]indet}
        \item \inValues{e'}{\Delta}{e} \text{ for fresh $e'$} \BY{\autoref{lem:invalues-derivable}}\pflabel{[truth]e'invalues}
        \item \csatisfy{e'}{\ctruth} \BY{\ruleref{rule:CSTruth}} \pflabel{[truth]e'satisfy}
        \item \csatisfyormay{e'}{\ctruth} \BY{\ruleref{rule:CSMSSat} on
            \pfref{[truth]e'satisfy}} \pflabel{[truth]e'satormay}
        \end{pfsteps}
        In conclusion, we have \pfref{[truth]e'invalues} and \pfref{[truth]e'satormay}
      \end{byCases}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CSNum})}]
      \begin{pfsteps}
      \item e=\hnum{n} \BY{assumption}
      \item \hxi=\cnum{n} \BY{assumption}
      \item \isVal{\hnum{n}} \BY{\ruleref{rule:VNum}} \pflabel{[num]val}
      \item \inValues{\hnum{n}}{\Delta}{\hnum{n}} \BY{\ruleref{rule:IVVal} on
          \pfref{[num]val}} \pflabel{[num]invalues}
      \end{pfsteps}
      In conclusion, we have \pfref{[num]invalues} and \pfref{satormay}.
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CSInl})}]
      \begin{pfsteps}
      \item e = \hinl{\tau_2}{e_1} \BY{assumption}
      \item \hxi = \cinl{\hxi_1} \BY{assumption}
      \item \csatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[inl]satisfy1}
      \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[inl]satisfy1}} \pflabel{[inl]satormay1}
      \item \tau = \tsum{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}}
      \item \hexptyp{\cdot}{\Delta}{e_1}{\tau_1} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[inl]e1typ}
      \item \ctyp{\hxi_1}{\tau_1} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[inl]c1typ}
      \item \isFinal{e_1} \BY{\autoref{lem:inv-final-inl} on \pfref{efinal}} \pflabel{[inl]e1final}
      \item \inValues{e_1'}{\Delta}{e_1} \text{ for fresh $e_1'$} \BY{IH on \pfref{[inl]c1typ},
          \pfref{[inl]e1typ}, \pfref{[inl]e1final}, \pfref{[inl]satormay1}} \pflabel{[inl]e1'values}
      \item \csatisfyormay{e_1'}{\hxi_1} \BY{IH on \pfref{[inl]c1typ},
          \pfref{[inl]e1typ}, \pfref{[inl]e1final}, \pfref{[inl]satormay1}} \pflabel{[inl]e1'satormay}
      \item \inValues{\hinl{\tau_2}{e_1'}}{\Delta}{\hinl{\tau_2}{e_1}}
        \BY{\ruleref{rule:IVInl} on \pfref{[inl]e1'values}}
      \item \csatisfyormay{\hinl{\tau_2}{e_1'}}{\cinl{\hxi_1}}
        \BY{\autoref{lem:satormay-inl} on \pfref{[inl]e1'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CSInr})}]
      \begin{pfsteps}
      \item e = \hinr{\tau_1}{e_2} \BY{assumption}
      \item \hxi = \cinr{\hxi_2} \BY{assumption}
      \item \csatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[inr]satisfy2}
      \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[inr]satisfy2}} \pflabel{[inr]satormay2}
      \item \tau = \tsum{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}}
      \item \hexptyp{\cdot}{\Delta}{e_2}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[inr]e2typ}
      \item \ctyp{\hxi_2}{\tau_2} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[inr]c2typ}
      \item \isFinal{e_2} \BY{\autoref{lem:inv-final-inr} on \pfref{efinal}} \pflabel{[inr]e2final}
      \item \inValues{e_2'}{\Delta}{e_2} \text{ for fresh $e_2'$} \BY{IH on \pfref{[inr]c2typ},
          \pfref{[inr]e2typ}, \pfref{[inr]e2final}, \pfref{[inr]satormay2}} \pflabel{[inr]e2'values}
      \item \csatisfyormay{e_2'}{\hxi_2} \BY{IH on \pfref{[inr]c2typ},
          \pfref{[inr]e2typ}, \pfref{[inr]e2final}, \pfref{[inr]satormay2}} \pflabel{[inr]e2'satormay}
      \item \inValues{\hinr{\tau_1}{e_2'}}{\Delta}{\hinr{\tau_1}{e_2}}
        \BY{\ruleref{rule:IVInr} on \pfref{[inr]e2'values}}
      \item \csatisfyormay{\hinr{\tau_1}{e_2'}}{\cinr{\hxi_2}}
        \BY{\autoref{lem:satormay-inr} on \pfref{[inr]e2'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CSPair})}]
      \begin{pfsteps}
      \item e = \hpair{e_1}{e_2} \BY{assumption}
      \item \hxi = \cpair{\hxi_1}{\hxi_2} \BY{assumption}
      \item \csatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[pair]satisfy1}
      \item \csatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[pair]satisfy2}
      \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[pair]satisfy1}} \pflabel{[pair]satormay1}
      \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[pair]satisfy2}} \pflabel{[pair]satormay2}
      \item \tau = \tprod{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}}
      \item \hexptyp{\cdot}{\Delta}{e_1}{\tau_1} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[pair]e1typ}
      \item \hexptyp{\cdot}{\Delta}{e_2}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[pair]e2typ}
      \item \ctyp{\hxi_1}{\tau_1} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[pair]c1typ}
      \item \ctyp{\hxi_2}{\tau_2} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[pair]c2typ}
      \item \isFinal{e_1} \BY{\autoref{lem:inv-final-pair} on \pfref{efinal}} \pflabel{[pair]e1final}
      \item \isFinal{e_2} \BY{\autoref{lem:inv-final-pair} on \pfref{efinal}} \pflabel{[pair]e2final}
      \item \inValues{e_1'}{\Delta}{e_1} \text{ for fresh $e_1'$} \BY{IH on \pfref{[pair]c1typ},
          \pfref{[pair]e1typ}, \pfref{[pair]e1final}, \pfref{[pair]satormay1}} \pflabel{[pair]e1'values}
      \item \csatisfyormay{e_1'}{\hxi_1} \BY{IH on \pfref{[pair]c1typ},
          \pfref{[pair]e1typ}, \pfref{[pair]e1final}, \pfref{[pair]satormay1}} \pflabel{[pair]e1'satormay}
      \item \inValues{e_2'}{\Delta}{e_2} \text{ for fresh $e_2'$} \BY{IH on \pfref{[pair]c2typ},
          \pfref{[pair]e2typ}, \pfref{[pair]e2final}, \pfref{[pair]satormay2}} \pflabel{[pair]e2'values}
      \item \csatisfyormay{e_2'}{\hxi_2} \BY{IH on \pfref{[pair]c2typ},
          \pfref{[pair]e2typ}, \pfref{[pair]e2final}, \pfref{[pair]satormay2}} \pflabel{[pair]e2'satormay}
      \item \inValues{\hpair{e_1'}{e_2'}}{\Delta}{\hpair{e_1}{e_2}}
        \BY{\ruleref{rule:IVPair} on \pfref{[pair]e1'values} and \pfref{[pair]e2'values}}
      \item \csatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-pair} on \pfref{[pair]e1'satormay} and \pfref{[pair]e2'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CSNotIntroPair})}]
      \begin{pfsteps}
      \item \hxi = \cpair{\hxi_1}{\hxi_2} \BY{assumption}
      \item \notIntro{e} \BY{assumption} \pflabel{[notintro]enotintro}
      \item \csatisfy{\hfst{e}}{\hxi_1} \BY{assumption} \pflabel{[notintro]satisfy1}
      \item \csatisfy{\hsnd{e}}{\hxi_2} \BY{assumption} \pflabel{[notintro]satisfy2}
      \item \csatisfyormay{\hfst{e}}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[notintro]satisfy1}} \pflabel{[notintro]satormay1}
      \item \csatisfyormay{\hsnd{e}}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[notintro]satisfy2}} \pflabel{[notintro]satormay2}
      \item \tau = \tprod{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:CTyp}
          on \pfref{ctyp}}
      \item \ctyp{\hxi_1}{\tau_1} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[notintro]c1typ}
      \item \ctyp{\hxi_2}{\tau_2} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[notintro]c2typ}
      \item \hexptyp{\cdot}{\Delta}{\hfst{e}}{\tau_1} \BY{\ruleref{rule:TFst} on
        \pfref{etyp}} \pflabel{[notintro]e1typ}
    \item \hexptyp{\cdot}{\Delta}{\hsnd{e}}{\tau_2} \BY{\ruleref{rule:TSnd} on
        \pfref{etyp}} \pflabel{[notintro]e2typ}
      \item \isIndet{\hfst{e}} \BY{\ruleref{rule:IFst} on \pfref{efinal}} \pflabel{[notintro]e1indet}
      \item \isFinal{\hfst{e}} \BY{\ruleref{rule:FIndet} on \pfref{[notintro]e1indet}} \pflabel{[notintro]e1final}
      \item \isIndet{\hsnd{e}} \BY{\ruleref{rule:ISnd} on \pfref{efinal}} \pflabel{[notintro]e2indet}
      \item \isFinal{\hsnd{e}} \BY{\ruleref{rule:FIndet} on \pfref{[notintro]e2indet}} \pflabel{[notintro]e2final}
      \item \inValues{e_1'}{\Delta}{\hfst{e}} \text{ for fresh $e_1'$} \BY{IH on \pfref{[notintro]c1typ},
          \pfref{[notintro]e1typ}, \pfref{[notintro]e1final}, \pfref{[notintro]satormay1}} \pflabel{[notintro]e1'values}
      \item \csatisfyormay{e_1'}{\hxi_1} \BY{IH on \pfref{[notintro]c1typ},
          \pfref{[notintro]e1typ}, \pfref{[notintro]e1final}, \pfref{[notintro]satormay1}} \pflabel{[notintro]e1'satormay}
      \item \inValues{e_2'}{\Delta}{\hsnd{e}} \text{ for fresh $e_2'$} \BY{IH on \pfref{[notintro]c2typ},
          \pfref{[notintro]e2typ}, \pfref{[notintro]e2final}, \pfref{[notintro]satormay2}} \pflabel{[notintro]e2'values}
      \item \csatisfyormay{e_2'}{\hxi_2} \BY{IH on \pfref{[notintro]c2typ},
          \pfref{[notintro]e2typ}, \pfref{[notintro]e2final}, \pfref{[notintro]satormay2}} \pflabel{[notintro]e2'satormay}
      \item \isVal{e_1'} \BY{\autoref{lem:invalues-val} on
          \pfref{[notintro]e1'values}} \pflabel{[notintro]e1'val}
      \item \isVal{e_2'} \BY{\autoref{lem:invalues-val} on
          \pfref{[notintro]e2'values}} \pflabel{[notintro]e2'val}
      \item \isVal{\hpair{e_1'}{e_2'}} \BY{\ruleref{rule:VPair} on
          \pfref{[notintro]e1'val} and \pfref{[notintro]e2'val}} \pflabel{[notintro]e'val}
      \item \hexptyp{\cdot}{\Delta}{e_1'}{\tau_1} \BY{\autoref{lem:invalues-typ}
        on \pfref{[notintro]e1'values} and \pfref{[notintro]e1typ}} \pflabel{[notintro]e1'typ}
      \item \hexptyp{\cdot}{\Delta}{e_2'}{\tau_2} \BY{\autoref{lem:invalues-typ}
        on \pfref{[notintro]e2'values} and \pfref{[notintro]e2typ}} \pflabel{[notintro]e2'typ}
      \item \hexptyp{\cdot}{\Delta}{\hpair{e_1'}{e_2'}}{\tprod{\tau_1}{\tau_2}}
        \BY{\ruleref{rule:TPair} on \pfref{[notintro]e1'typ} and
          \pfref{[notintro]e2'typ}} \pflabel{[notintro]e'typ}
      \item \inValues{\hpair{e_1'}{e_2'}}{\Delta}{e}
        \BY{\ruleref{rule:IVIndet} on \pfref{[notintro]enotintro}, \pfref{etyp},
          \pfref{[notintro]e'val} and \pfref{[notintro]e'typ}}
      \item \csatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-pair} on \pfref{[notintro]e1'satormay} and \pfref{[notintro]e2'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CSOr1})}]
      \begin{pfsteps}
      \item \hxi=\cor{\hxi_1}{\hxi_2} \BY{assumption} 
      \item \csatisfy{e}{\hxi_1} \BY{assumption} \pflabel{[or1]satisfy1}
      \item \csatisfyormay{e}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[or1]satisfy1}} \pflabel{[or1]satormay1}
      \item \ctyp{\hxi_1}{\tau} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[or1]c1typ}
      \item \inValues{e'}{\Delta}{e} \text{ for fresh $e'$} \BY{IH on \pfref{[or1]c1typ},
          \pfref{etyp}, \pfref{efinal}, \pfref{[or1]satormay1}} \pflabel{[or1]e'values}
      \item \csatisfyormay{e'}{\hxi_1} \BY{IH on \pfref{[or1]c1typ},
          \pfref{etyp}, \pfref{efinal}, \pfref{[or1]satormay1}} \pflabel{[or1]e'satormay}
      \item \csatisfyormay{e'}{\cor{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-or} on \pfref{[or1]e'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CSOr2})}]
      \begin{pfsteps}
      \item \hxi=\cor{\hxi_1}{\hxi_2} \BY{assumption} 
      \item \csatisfy{e}{\hxi_2} \BY{assumption} \pflabel{[or2]satisfy2}
      \item \csatisfyormay{e}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[or2]satisfy2}} \pflabel{[or2]satormay2}
      \item \ctyp{\hxi_2}{\tau} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[or2]c2typ}
      \item \inValues{e'}{\Delta}{e} \text{ for fresh $e'$} \BY{IH on \pfref{[or2]c2typ},
          \pfref{etyp}, \pfref{efinal}, \pfref{[or2]satormay2}} \pflabel{[or2]e'values}
      \item \csatisfyormay{e'}{\hxi_2} \BY{IH on \pfref{[or2]c2typ},
          \pfref{etyp}, \pfref{efinal}, \pfref{[or2]satormay2}} \pflabel{[or2]e'satormay}
      \item \csatisfyormay{e'}{\cor{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-or} on \pfref{[or2]e'satormay}}
      \end{pfsteps}
    \end{byCases}
    \restorelocalsteps{0}
  \item[\text{(\ref{rule:CSMSMay})}]
    \begin{pfsteps}
    \item \cmaysatisfy{e}{\hxi} \BY{assumption} \pflabel{maysat}
    \end{pfsteps}
    By rule induction over \rulesref{rules:MaySatisfy} on \pfref{maysat}.
    \begin{byCases}
      \savelocalsteps{1}
    \item[\text{(\ref{rule:CMSUnknown})}]
      \begin{pfsteps}
      \item \hxi = \cunknown \BY{assumption}
      \end{pfsteps}
      By rule induction over \rulesref{rules:Final} on \pfref{efinal}.
      \begin{byCases}
        \savelocalsteps{2}
      \item[\text{(\ref{rule:FVal})}]
        \begin{pfsteps}
        \item \isVal{e} \BY{assumption}\pflabel{[unknown]eval}
        \item \inValues{e}{\Delta}{e} \BY{\ruleref{rule:IVVal} on \pfref{[unknown]eval}} \pflabel{[unknown]invalues}
        \end{pfsteps}
        In conclusion, we have \pfref{[unknown]invalues} and \pfref{satormay}.
        \restorelocalsteps{2}
      \item[\text{(\ref{rule:FIndet})}]
        \begin{pfsteps}
        \item \isIndet{e} \BY{assumption}\pflabel{[unknown]indet}
        \item \inValues{e'}{\Delta}{e} \text{ for fresh $e'$} \BY{\autoref{lem:invalues-derivable}}\pflabel{[unknown]e'invalues}
        \item \cmaysatisfy{e'}{\cunknown} \BY{\ruleref{rule:CMSUnknown}} \pflabel{[unknown]e'satisfy}
        \item \csatisfyormay{e'}{\ctruth} \BY{\ruleref{rule:CSMSSat} on
            \pfref{[unknown]e'satisfy}} \pflabel{[unknown]e'satormay}
        \end{pfsteps}
        In conclusion, we have \pfref{[unknown]e'invalues} and \pfref{[unknown]e'satormay}
      \end{byCases}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CMSInl})}]
      \begin{pfsteps}
      \item e = \hinl{\tau_2}{e_1} \BY{assumption}
      \item \hxi = \cinl{\hxi_1} \BY{assumption}
      \item \cmaysatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[inl']satisfy1}
      \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSMay} on
          \pfref{[inl']satisfy1}} \pflabel{[inl']satormay1}
      \item \tau = \tsum{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}}
      \item \hexptyp{\cdot}{\Delta}{e_1}{\tau_1} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[inl']e1typ}
      \item \ctyp{\hxi_1}{\tau_1} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[inl']c1typ}
      \item \isFinal{e_1} \BY{\autoref{lem:inv-final-inl} on \pfref{efinal}} \pflabel{[inl']e1final}
      \item \inValues{e_1'}{\Delta}{e_1} \text{ for fresh $e_1'$} \BY{IH on \pfref{[inl']c1typ},
          \pfref{[inl']e1typ}, \pfref{[inl']e1final}, \pfref{[inl']satormay1}} \pflabel{[inl']e1'values}
      \item \csatisfyormay{e_1'}{\hxi_1} \BY{IH on \pfref{[inl']c1typ},
          \pfref{[inl']e1typ}, \pfref{[inl']e1final}, \pfref{[inl']satormay1}} \pflabel{[inl']e1'satormay}
      \item \inValues{\hinl{\tau_2}{e_1'}}{\Delta}{\hinl{\tau_2}{e_1}}
        \BY{\ruleref{rule:IVInl} on \pfref{[inl']e1'values}}
      \item \csatisfyormay{\hinl{\tau_2}{e_1'}}{\cinl{\hxi_1}}
        \BY{\autoref{lem:satormay-inl} on \pfref{[inl']e1'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CMSInr})}]
      \begin{pfsteps}
      \item e = \hinr{\tau_1}{e_2} \BY{assumption}
      \item \hxi = \cinr{\hxi_2} \BY{assumption}
      \item \cmaysatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[inr']satisfy2}
      \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSMay} on
          \pfref{[inr']satisfy2}} \pflabel{[inr']satormay2}
      \item \tau = \tsum{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}}
      \item \hexptyp{\cdot}{\Delta}{e_2}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[inr']e2typ}
      \item \ctyp{\hxi_2}{\tau_2} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[inr']c2typ}
      \item \isFinal{e_2} \BY{\autoref{lem:inv-final-inr} on \pfref{efinal}} \pflabel{[inr']e2final}
      \item \inValues{e_2'}{\Delta}{e_2} \text{ for fresh $e_2'$} \BY{IH on \pfref{[inr']c2typ},
          \pfref{[inr']e2typ}, \pfref{[inr']e2final}, \pfref{[inr']satormay2}} \pflabel{[inr']e2'values}
      \item \csatisfyormay{e_2'}{\hxi_2} \BY{IH on \pfref{[inr']c2typ},
          \pfref{[inr']e2typ}, \pfref{[inr']e2final}, \pfref{[inr']satormay2}} \pflabel{[inr']e2'satormay}
      \item \inValues{\hinr{\tau_1}{e_2'}}{\Delta}{\hinr{\tau_1}{e_2}}
        \BY{\ruleref{rule:IVInr} on \pfref{[inr']e2'values}}
      \item \csatisfyormay{\hinr{\tau_1}{e_2'}}{\cinr{\hxi_2}}
        \BY{\autoref{lem:satormay-inr} on \pfref{[inr']e2'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CMSPair1})}]
      \begin{pfsteps}
      \item e = \hpair{e_1}{e_2} \BY{assumption}
      \item \hxi = \cpair{\hxi_1}{\hxi_2} \BY{assumption}
      \item \cmaysatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[pair1]satisfy1}
      \item \csatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[pair1]satisfy2}
      \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSMay} on
          \pfref{[pair1]satisfy1}} \pflabel{[pair1]satormay1}
      \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[pair1]satisfy2}} \pflabel{[pair1]satormay2}
      \item \tau = \tprod{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}}
      \item \hexptyp{\cdot}{\Delta}{e_1}{\tau_1} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[pair1]e1typ}
      \item \hexptyp{\cdot}{\Delta}{e_2}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[pair1]e2typ}
      \item \ctyp{\hxi_1}{\tau_1} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[pair1]c1typ}
      \item \ctyp{\hxi_2}{\tau_2} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[pair1]c2typ}
      \item \isFinal{e_1} \BY{\autoref{lem:inv-final-pair} on \pfref{efinal}} \pflabel{[pair1]e1final}
      \item \isFinal{e_2} \BY{\autoref{lem:inv-final-pair} on \pfref{efinal}} \pflabel{[pair1]e2final}
      \item \inValues{e_1'}{\Delta}{e_1} \text{ for fresh $e_1'$} \BY{IH on \pfref{[pair1]c1typ},
          \pfref{[pair1]e1typ}, \pfref{[pair1]e1final}, \pfref{[pair1]satormay1}} \pflabel{[pair1]e1'values}
      \item \csatisfyormay{e_1'}{\hxi_1} \BY{IH on \pfref{[pair1]c1typ},
          \pfref{[pair1]e1typ}, \pfref{[pair1]e1final}, \pfref{[pair1]satormay1}} \pflabel{[pair1]e1'satormay}
      \item \inValues{e_2'}{\Delta}{e_2} \text{ for fresh $e_2'$} \BY{IH on \pfref{[pair1]c2typ},
          \pfref{[pair1]e2typ}, \pfref{[pair1]e2final}, \pfref{[pair1]satormay2}} \pflabel{[pair1]e2'values}
      \item \csatisfyormay{e_2'}{\hxi_2} \BY{IH on \pfref{[pair1]c2typ},
          \pfref{[pair1]e2typ}, \pfref{[pair1]e2final}, \pfref{[pair1]satormay2}} \pflabel{[pair1]e2'satormay}
      \item \inValues{\hpair{e_1'}{e_2'}}{\Delta}{\hpair{e_1}{e_2}}
        \BY{\ruleref{rule:IVPair} on \pfref{[pair1]e1'values} and \pfref{[pair1]e2'values}}
      \item \csatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-pair} on \pfref{[pair1]e1'satormay} and \pfref{[pair1]e2'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CMSPair2})}]
      \begin{pfsteps}
      \item e = \hpair{e_1}{e_2} \BY{assumption}
      \item \hxi = \cpair{\hxi_1}{\hxi_2} \BY{assumption}
      \item \csatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[pair2]satisfy1}
      \item \cmaysatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[pair2]satisfy2}
      \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSSat} on
          \pfref{[pair2]satisfy1}} \pflabel{[pair2]satormay1}
      \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSMay} on
          \pfref{[pair2]satisfy2}} \pflabel{[pair2]satormay2}
      \item \tau = \tprod{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}}
      \item \hexptyp{\cdot}{\Delta}{e_1}{\tau_1} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[pair2]e1typ}
      \item \hexptyp{\cdot}{\Delta}{e_2}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[pair2]e2typ}
      \item \ctyp{\hxi_1}{\tau_1} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[pair2]c1typ}
      \item \ctyp{\hxi_2}{\tau_2} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[pair2]c2typ}
      \item \isFinal{e_1} \BY{\autoref{lem:inv-final-pair} on \pfref{efinal}} \pflabel{[pair2]e1final}
      \item \isFinal{e_2} \BY{\autoref{lem:inv-final-pair} on \pfref{efinal}} \pflabel{[pair2]e2final}
      \item \inValues{e_1'}{\Delta}{e_1} \text{ for fresh $e_1'$} \BY{IH on \pfref{[pair2]c1typ},
          \pfref{[pair2]e1typ}, \pfref{[pair2]e1final}, \pfref{[pair2]satormay1}} \pflabel{[pair2]e1'values}
      \item \csatisfyormay{e_1'}{\hxi_1} \BY{IH on \pfref{[pair2]c1typ},
          \pfref{[pair2]e1typ}, \pfref{[pair2]e1final}, \pfref{[pair2]satormay1}} \pflabel{[pair2]e1'satormay}
      \item \inValues{e_2'}{\Delta}{e_2} \text{ for fresh $e_2'$} \BY{IH on \pfref{[pair2]c2typ},
          \pfref{[pair2]e2typ}, \pfref{[pair2]e2final}, \pfref{[pair2]satormay2}} \pflabel{[pair2]e2'values}
      \item \csatisfyormay{e_2'}{\hxi_2} \BY{IH on \pfref{[pair2]c2typ},
          \pfref{[pair2]e2typ}, \pfref{[pair2]e2final}, \pfref{[pair2]satormay2}} \pflabel{[pair2]e2'satormay}
      \item \inValues{\hpair{e_1'}{e_2'}}{\Delta}{\hpair{e_1}{e_2}}
        \BY{\ruleref{rule:IVPair} on \pfref{[pair2]e1'values} and \pfref{[pair2]e2'values}}
      \item \csatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-pair} on \pfref{[pair2]e1'satormay} and \pfref{[pair2]e2'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CMSPair3})}]
      \begin{pfsteps}
      \item e = \hpair{e_1}{e_2} \BY{assumption}
      \item \hxi = \cpair{\hxi_1}{\hxi_2} \BY{assumption}
      \item \cmaysatisfy{e_1}{\hxi_1} \BY{assumption} \pflabel{[pair3]satisfy1}
      \item \cmaysatisfy{e_2}{\hxi_2} \BY{assumption} \pflabel{[pair3]satisfy2}
      \item \csatisfyormay{e_1}{\hxi_1} \BY{\ruleref{rule:CSMSMay} on
          \pfref{[pair3]satisfy1}} \pflabel{[pair3]satormay1}
      \item \csatisfyormay{e_2}{\hxi_2} \BY{\ruleref{rule:CSMSMay} on
          \pfref{[pair3]satisfy2}} \pflabel{[pair3]satormay2}
      \item \tau = \tprod{\tau_1}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}}
      \item \hexptyp{\cdot}{\Delta}{e_1}{\tau_1} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[pair3]e1typ}
      \item \hexptyp{\cdot}{\Delta}{e_2}{\tau_2} \BY{Inversion of \rulesref{rules:TExp}
          on \pfref{etyp}} \pflabel{[pair3]e2typ}
      \item \ctyp{\hxi_1}{\tau_1} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[pair3]c1typ}
      \item \ctyp{\hxi_2}{\tau_2} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[pair3]c2typ}
      \item \isFinal{e_1} \BY{\autoref{lem:inv-final-pair} on \pfref{efinal}} \pflabel{[pair3]e1final}
      \item \isFinal{e_2} \BY{\autoref{lem:inv-final-pair} on \pfref{efinal}} \pflabel{[pair3]e2final}
      \item \inValues{e_1'}{\Delta}{e_1} \text{ for fresh $e_1'$} \BY{IH on \pfref{[pair3]c1typ},
          \pfref{[pair3]e1typ}, \pfref{[pair3]e1final}, \pfref{[pair3]satormay1}} \pflabel{[pair3]e1'values}
      \item \csatisfyormay{e_1'}{\hxi_1} \BY{IH on \pfref{[pair3]c1typ},
          \pfref{[pair3]e1typ}, \pfref{[pair3]e1final}, \pfref{[pair3]satormay1}} \pflabel{[pair3]e1'satormay}
      \item \inValues{e_2'}{\Delta}{e_2} \text{ for fresh $e_2'$} \BY{IH on \pfref{[pair3]c2typ},
          \pfref{[pair3]e2typ}, \pfref{[pair3]e2final}, \pfref{[pair3]satormay2}} \pflabel{[pair3]e2'values}
      \item \csatisfyormay{e_2'}{\hxi_2} \BY{IH on \pfref{[pair3]c2typ},
          \pfref{[pair3]e2typ}, \pfref{[pair3]e2final}, \pfref{[pair3]satormay2}} \pflabel{[pair3]e2'satormay}
      \item \inValues{\hpair{e_1'}{e_2'}}{\Delta}{\hpair{e_1}{e_2}}
        \BY{\ruleref{rule:IVPair} on \pfref{[pair3]e1'values} and \pfref{[pair3]e2'values}}
      \item \csatisfyormay{\hpair{e_1'}{e_2'}}{\cpair{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-pair} on \pfref{[pair3]e1'satormay} and \pfref{[pair3]e2'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CMSOr1})}]
      \begin{pfsteps}
      \item \hxi=\cor{\hxi_1}{\hxi_2} \BY{assumption} 
      \item \cmaysatisfy{e}{\hxi_1} \BY{assumption} \pflabel{[or1']satisfy1}
      \item \csatisfyormay{e}{\hxi_1} \BY{\ruleref{rule:CSMSMay} on
          \pfref{[or1']satisfy1}} \pflabel{[or1']satormay1}
      \item \ctyp{\hxi_1}{\tau} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[or1']c1typ}
      \item \inValues{e'}{\Delta}{e} \text{ for fresh $e'$} \BY{IH on \pfref{[or1']c1typ},
          \pfref{etyp}, \pfref{efinal}, \pfref{[or1']satormay1}} \pflabel{[or1']e'values}
      \item \csatisfyormay{e'}{\hxi_1} \BY{IH on \pfref{[or1']c1typ},
          \pfref{etyp}, \pfref{efinal}, \pfref{[or1']satormay1}} \pflabel{[or1']e'satormay}
      \item \csatisfyormay{e'}{\cor{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-or} on \pfref{[or1']e'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CMSOr2})}]
      \begin{pfsteps}
      \item \hxi=\cor{\hxi_1}{\hxi_2} \BY{assumption} 
      \item \cmaysatisfy{e}{\hxi_2} \BY{assumption} \pflabel{[or2']satisfy2}
      \item \csatisfyormay{e}{\hxi_2} \BY{\ruleref{rule:CSMSMay} on
          \pfref{[or2']satisfy2}} \pflabel{[or2']satormay2}
      \item \ctyp{\hxi_2}{\tau} \BY{Inversion of \rulesref{rules:CTyp} on
          \pfref{ctyp}} \pflabel{[or2']c2typ}
      \item \inValues{e'}{\Delta}{e} \text{ for fresh $e'$} \BY{IH on \pfref{[or2']c2typ},
          \pfref{etyp}, \pfref{efinal}, \pfref{[or2']satormay2}} \pflabel{[or2']e'values}
      \item \csatisfyormay{e'}{\hxi_2} \BY{IH on \pfref{[or2']c2typ},
          \pfref{etyp}, \pfref{efinal}, \pfref{[or2']satormay2}} \pflabel{[or2']e'satormay}
      \item \csatisfyormay{e'}{\cor{\hxi_1}{\hxi_2}}
        \BY{\autoref{lem:satormay-or} on \pfref{[or2']e'satormay}}
      \end{pfsteps}
      \restorelocalsteps{1}
    \item[\text{(\ref{rule:CMSNotIntro})}]
      \begin{pfsteps}
      \item \notIntro{e} \BY{assumption} \pflabel{[notintro]notintro}
      \item \isVal{e'} \text{ for fresh $e'$} \BY{\autoref{lem:exist-val-satormay-hxi} on \pfref{ctyp}} \pflabel{[notintro]e'val}
      \item \hexptyp{\cdot}{\Delta}{e'}{\tau} \BY{\autoref{lem:exist-val-satormay-hxi} on \pfref{ctyp}} \pflabel{[notintro]e'typ}
      \item \csatisfyormay{e'}{\hxi} \BY{\autoref{lem:exist-val-satormay-hxi} on \pfref{ctyp}} \pflabel{[notintro]e'satormay}
      \item \inValues{e'}{\Delta}{e} \BY{\ref{rule:IVIndet} on
          \pfref{[notintro]notintro} and \pfref{etyp} and \pfref{[notintro]e'val} and
          \pfref{[notintro]e'typ}}
      \end{pfsteps}
      $e'$ is such an expression that $\inValues{e'}{\Delta}{e}$ and $\csatisfyormay{e'}{\hxi}$.
    \end{byCases}
  \end{byCases}
  \resetpfcounter
\end{proof}

\begin{lemma}
  \label{lem:incomplete-satormay}
  If $\isIndet{e}$ and $\hexptyp{\cdot}{\Delta}{e}{\tau}$ and
  $\ctyp{\hxi}{\tau}$ and there exists $e'$ such that $\inValues{e'}{\Delta}{e}$
  and $\csatisfyormay{e'}{\hxi}$ then $\csatisfyormay{e}{\hxi}$.
\end{lemma}
\begin{proof}
  Proved by directly taking the contraposition of \autoref{lem:complete-not-satormay}.
\end{proof}

\judgboxa{
  \hsubstyp{\Gamma}{\Delta}{\theta}{\Gamma\theta}
}{
  $\theta$ is of type $\Gamma\theta$
}
\begin{subequations}
\begin{equation}
\inferrule[STEmpty]{ }{
  \hsubstyp{\Gamma}{\Delta}{\emptyset}{\cdot}
}
\end{equation}
\begin{equation}
\inferrule[STExtend]{
  \hsubstyp{\Gamma}{\Delta}{\theta}{\Gamma_\theta} \\
  \hexptyp{\Gamma}{\Delta}{e}{\tau}
}{
  \hsubstyp{\Gamma}{\Delta}{\theta , x / e}{\Gamma_\theta , x : \tau}
}
\end{equation}
\end{subequations}

\judgboxa{
  \refutable{p}
}{$p$ is refutable}
\begin{subequations}\label{rules:p-refutable}
\begin{equation}\label{rule:RNum}
\inferrule[RNum]{ }{
  \refutable{\hnum{n}}
}
\end{equation}
\begin{equation}\label{rule:REHole}
\inferrule[REHole]{ }{
  \refutable{\heholep{w}}
}
\end{equation}
\begin{equation}\label{rule:RHole}
\inferrule[RHole]{ }{
  \refutable{\hholep{p}{w}{\tau}}
}
\end{equation}
\begin{equation}\label{rule:RInl}
\inferrule[RInl]{ }{
  \refutable{\hinlp{p}}
}
\end{equation}
\begin{equation}\label{rule:RInr}
\inferrule[RInr]{ }{
  \refutable{\hinrp{p}}
}
\end{equation}
\begin{equation}\label{rule:RPairL}
\inferrule[RPairL]{
  \refutable{p_1}
}{
  \refutable{\hpair{p_1}{p_2}}
}
\end{equation}
\begin{equation}\label{rule:RPairR}
\inferrule[RPairR]{
  \refutable{p_2}
}{
  \refutable{\hpair{p_1}{p_2}}
}
\end{equation}
\end{subequations}

\judgboxa{
  \hpatmatch{e}{p}{\theta}
}{
  $e$ matches $p$, emitting $\theta$
}
\begin{subequations}\label{rules:match}
\begin{equation}\label{rule:MVar}
\inferrule[MVar]{ }{
  \hpatmatch{e}{x}{e / x}
}
\end{equation}
\begin{equation}\label{rule:MWild}
\inferrule[MWild]{ }{
  \hpatmatch{e}{\_}{\cdot}
}
\end{equation}
\begin{equation}\label{rule:MNum}
\inferrule[MNum]{ }{
  \hpatmatch{\hnum{n}}{\hnum{n}}{\cdot}
}
\end{equation}
\begin{equation}\label{rule:MPair}
\inferrule[MPair]{
  \hpatmatch{e_1}{p_1}{\theta_1} \\
  \hpatmatch{e_2}{p_2}{\theta_2}
}{
  \hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta_1 \uplus \theta_2}
}
\end{equation}
\begin{equation}\label{rule:MInl}
\inferrule[MInl]{
  \hpatmatch{e}{p}{\theta}
}{
  \hpatmatch{\hinl{\tau}{e}}{\hinlp{p}}{\theta}
}
\end{equation}
\begin{equation}\label{rule:MInr}
\inferrule[MInr]{
  \hpatmatch{e}{p}{\theta}
}{
  \hpatmatch{\hinr{\tau}{e}}{\hinrp{p}}{\theta}
}
\end{equation}
\begin{equation}\label{rule:MNotIntroPair}
\inferrule[MNotIntroPair]{
  \notIntro{e} \\
  \hpatmatch{\hfst{e}}{p_1}{\theta_1} \\
  \hpatmatch{\hsnd{e}}{p_2}{\theta_2}
}{
  \hpatmatch{e}{\hpair{p_1}{p_2}}{\theta_1 \uplus \theta_2}
}
\end{equation}
\end{subequations}

\judgboxa{
  \hmaymatch{e}{p}
}{
  $e$ may match $p$
}
\begin{subequations}\label{rules:maymatch}
\begin{equation}\label{rule:MMEHole}
\inferrule[MMEHole]{ }{
  \hmaymatch{e}{\heholep{w}}
}
\end{equation}
\begin{equation}\label{rule:MMHole}
\inferrule[MMHole]{ }{
  \hmaymatch{e}{\hholep{p}{w}{\tau}}
}
\end{equation}
\begin{equation}\label{rule:MMNotIntro}
\inferrule[MMNotIntro]{
  \notIntro{e} \\
  \refutable{p}
}{
  \hmaymatch{e}{p}
}
\end{equation}
\begin{equation}\label{rule:MMPairL}
\inferrule[MMPairL]{
  \hmaymatch{e_1}{p_1} \\
  \hpatmatch{e_2}{p_2}{\theta_2}
}{
  \hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}
}
\end{equation}
\begin{equation}\label{rule:MMPairR}
\inferrule[MMPairR]{
  \hpatmatch{e_1}{p_1}{\theta_1} \\
  \hmaymatch{e_2}{p_2}
}{
  \hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}
}
\end{equation}
\begin{equation}\label{rule:MMPair}
\inferrule[MMPair]{
  \hmaymatch{e_1}{p_1} \\
  \hmaymatch{e_2}{p_2}
}{
  \hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}
}
\end{equation}
\begin{equation}\label{rule:MMInl}
\inferrule[MMInl]{
  \hmaymatch{e}{p}
}{
  \hmaymatch{\hinl{\tau}{e}}{\hinlp{p}}
}
\end{equation}
\begin{equation}\label{rule:MMInr}
\inferrule[MMInr]{
  \hmaymatch{e}{p}
}{
  \hmaymatch{\hinr{\tau}{e}}{\hinrp{p}}
}
\end{equation}
\end{subequations}

\judgboxa{
  \hnotmatch{e}{p}
}{
  $e$ does not match $p$
}
\begin{subequations}\label{rules:notmatch}
\begin{equation}\label{rule:NMNum}
\inferrule[NMNum]{
  n_1 \neq n_2
}{
  \hnotmatch{\hnum{n_1}}{\hnum{n_2}}
}
\end{equation}
\begin{equation}\label{rule:NMPairL}
\inferrule[NMPairL]{
  \hnotmatch{e_1}{p_1}
}{
  \hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}
}
\end{equation}
\begin{equation}\label{rule:NMPairR}
\inferrule[NMPairR]{
  \hnotmatch{e_2}{p_2}
}{
  \hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}
}
\end{equation}
\begin{equation}\label{rule:NMConfL}
\inferrule[NMConfL]{ }{
  \hnotmatch{\hinr{\tau}{e}}{\hinlp{p}}
}
\end{equation}
\begin{equation}\label{rule:NMConfR}
\inferrule[NMConfR]{ }{
  \hnotmatch{\hinl{\tau}{e}}{\hinrp{p}}
}
\end{equation}
\begin{equation}\label{rule:NMInl}
\inferrule[NMInl]{
  \hnotmatch{e}{p}
}{
  \hnotmatch{\hinl{\tau}{e}}{\hinlp{p}}
}
\end{equation}
\begin{equation}\label{rule:NMInr}
\inferrule[NMInr]{
  \hnotmatch{e}{p}
}{
  \hnotmatch{\hinr{\tau}{e}}{\hinrp{p}}
}
\end{equation}
\end{subequations}

\judgboxa{\htrans{e}{e'}}{$e$ takes a step to $e'$}
\begin{subequations}\label{rules:ITExp}
\begin{equation}
\inferrule[ITHole]{
  \htrans{e}{e'}
}{
  \htrans{\hhole{e}{u}}{\hhole{e'}{u}}
}
\end{equation}
\begin{equation}
\inferrule[ITApFun]{
  \htrans{e_1}{e_1'}
}{
  \htrans{\hap{e_1}{e_2}}{\hap{e_1'}{e_2}}
}
\end{equation}
\begin{equation}
\inferrule[ITApArg]{
  \isVal{e_1} \\
  \htrans{e_2}{e_2'}
}{
  \htrans{\hap{e_1}{e_2}}{\hap{e_1}{e_2'}}
}
\end{equation}
\begin{equation}
\inferrule[ITAP]{
  \isVal{e_2}
}{
  \hap{\hlam{x}{\tau}{e_1}}{e_2} \mapsto
    [e_2/x]e_1
}
\end{equation}
\begin{equation}
\inferrule[ITPairL]{
  \htrans{e_1}{e_1'}
}{
  \htrans{\hpair{e_1}{e_2}}{\hpair{e_1'}{e_2}}
}
\end{equation}
\begin{equation}
\inferrule[ITPairR]{
  \isVal{e_1} \\
  \htrans{e_2}{e_2'}
}{
  \htrans{\hpair{e_1}{e_2}}{\hpair{e_1}{e_2'}}
}
\end{equation}
\begin{equation}
\inferrule[ITFstPair]{
  \isFinal{\hpair{e_1}{e_2}}
}{
  \htrans{\hfst{\hpair{e_1}{e_2}}}{e_1}
}
\end{equation}
\begin{equation}
\inferrule[ITSndPair]{
  \isFinal{\hpair{e_1}{e_2}}
}{
  \htrans{\hsnd{\hpair{e_1}{e_2}}}{e_2}
}
\end{equation}
\begin{equation}
\inferrule[ITInl]{
  \htrans{e}{e'}
}{
  \htrans{\hinl{\tau}{e}}{\hinl{\tau}{e'}}
}
\end{equation}
\begin{equation}
\inferrule[ITInr]{
  \htrans{e}{e'}
}{
  \htrans{\hinr{\tau}{e}}{\hinr{\tau}{e'}}
}
\end{equation}
\begin{equation}\label{rule:ITExpMatch}
\inferrule[ITExpMatch]{
  \htrans{e}{e'}
}{
  \htrans{\hmatch{e}{\zrules}}{\hmatch{e'}{\zrules}}
}
\end{equation}
\begin{equation}\label{rule:ITSuccMatch}
\inferrule[ITSuccMatch]{
  \isFinal{e} \\
  \hpatmatch{e}{p_r}{\theta}
}{
  \htrans{
    \hmatch{e}{\zruls{rs_{pre}}{\hrulP{p_r}{e_r}}{rs_{post}}}
  }{
    [\theta](e_r)
  }
}
\end{equation}
\begin{equation}\label{rule:ITFailMatch}
\inferrule[ITFailMatch]{
  \isFinal{e} \\
  \hnotmatch{e}{p_r}
}{
  \htrans{
    \hmatch{e}{\zruls{rs}{\hrulP{p_r}{e_r}}{\hrulesP{r'}{rs'}}}
  }{
    \hmatch{e}{
      \zruls{
        \rmpointer{\zruls{rs}{\hrulP{p_r}{e_r}}{\cdot}}
      }{r'}{rs'}
    }
  }
}
\end{equation}
\end{subequations}

\begin{lemma}
  \label{lem:inl-final}
  If $\isFinal{\hinl{\tau_2}{e_1}}$ then $\isFinal{e_1}$.
\end{lemma}
\begin{proof}
By rule induction over Rules (\ref{rules:Final}) on $\isFinal{\hinl{\tau_2}{e_1}}$.
\begin{byCases}
\savelocalsteps{0}
\item[\text{(\ref{rule:FVal})}]
    \begin{pfsteps*}
    \item $\isVal{\hinl{\tau_2}{e_1}}$ \BY{assumption} \pflabel{inl-val}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:Value}) on \pfref{inl-val}, only one case applies.
    \begin{byCases}
    \item[\text{(\ref{rule:VInl})}]
        \begin{pfsteps*}
        \item $\isVal{e_1}$ \BY{assumption} \pflabel{val}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FVal}) on \pfref{val}}
        \end{pfsteps*}
    \end{byCases}
\restorelocalsteps{0}
\item[\text{(\ref{rule:FIndet})}]
    \begin{pfsteps*}
    \item $\isIndet{\hinl{\tau_2}{e_1}}$ \BY{assumption} \pflabel{inl-indet}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:Indet}) on \pfref{inl-indet}, only one case applies.
    \begin{byCases}
    \item[\text{(\ref{rule:IInl})}]
        \begin{pfsteps*}
        \item $\isIndet{e_1}$ \BY{assumption} \pflabel{indet}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{indet}}
        \end{pfsteps*}
    \end{byCases}
\end{byCases}
\resetpfcounter
\end{proof}

\begin{lemma}
  \label{lem:inr-final}
  If $\isFinal{\hinr{\tau_1}{e_2}}$ then $\isFinal{e_2}$.
\end{lemma}
\begin{proof}
By rule induction over Rules (\ref{rules:Final}) on $\isFinal{\hinr{\tau_1}{e_2}}$.
\begin{byCases}
\savelocalsteps{0}
\item[\text{(\ref{rule:FVal})}]
    \begin{pfsteps*}
    \item $\isVal{\hinr{\tau_1}{e_2}}$ \BY{assumption} \pflabel{inr-val}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:Value}) on \pfref{inr-val}, only one case applies.
    \begin{byCases}
    \item[\text{(\ref{rule:VInl})}]
        \begin{pfsteps*}
        \item $\isVal{e_2}$ \BY{assumption} \pflabel{val}
        \item $\isFinal{e_2}$ \BY{Rule (\ref{rule:FVal}) on \pfref{val}}
        \end{pfsteps*}
    \end{byCases}
\restorelocalsteps{0}
\item[\text{(\ref{rule:FIndet})}]
    \begin{pfsteps*}
    \item $\isIndet{\hinr{\tau_1}{e_2}}$ \BY{assumption} \pflabel{inr-indet}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:Indet}) on \pfref{inr-indet}, only one case applies.
    \begin{byCases}
    \item[\text{(\ref{rule:IInl})}]
        \begin{pfsteps*}
        \item $\isIndet{e_2}$ \BY{assumption} \pflabel{indet}
        \item $\isFinal{e_2}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{indet}}
        \end{pfsteps*}
    \end{byCases}
\end{byCases}
\resetpfcounter
\end{proof}

\begin{lemma}
  \label{lem:pair-final}
  If $\isFinal{\hpair{e_1}{e_2}}$ then $\isFinal{e_1}$ and $\isFinal{e_2}$.
\end{lemma}
\begin{proof}
By rule induction over Rules (\ref{rules:Final}) on $\isFinal{\hpair{e_1}{e_2}}$.
\begin{byCases}
\savelocalsteps{0}
\item[\text{(\ref{rule:FVal})}]
    \begin{pfsteps*}
    \item $\isVal{\hpair{e_1}{e_2}}$ \BY{assumption} \pflabel{pair-val}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:Value}) on \pfref{pair-val}, only one case applies.
    \begin{byCases}
    \item[\text{(\ref{rule:VPair})}]
        \begin{pfsteps*}
        \item $\isVal{e_1}$ \BY{assumption} \pflabel{e1-val}
        \item $\isVal{e_2}$ \BY{assumption} \pflabel{e2-val}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FVal}) on \pfref{e1-val}}
        \item $\isFinal{e_2}$ \BY{Rule (\ref{rule:FVal}) on \pfref{e2-val}}
        \end{pfsteps*}
    \end{byCases}
\restorelocalsteps{0}
\item[\text{(\ref{rule:FIndet})}]
    \begin{pfsteps*}
    \item $\isIndet{\hpair{e_1}{e_2}}$ \BY{assumption} \pflabel{pair-indet}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:Indet}) on \pfref{pair-indet}, only three cases apply.
    \begin{byCases}
    \savelocalsteps{1}
    \item[\text{(\ref{rule:IPairL})}]
        \begin{pfsteps*}
        \item $\isIndet{e_1}$ \BY{assumption} \pflabel{[indet1]e1-indet}
        \item $\isVal{e_2}$ \BY{assumption} \pflabel{[indet1]e2-val}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{[indet1]e1-indet}}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FVal}) on \pfref{[indet1]e2-val}}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:IPairR})}]
        \begin{pfsteps*}
        \item $\isVal{e_1}$ \BY{assumption} \pflabel{[indet2]e1-val}
        \item $\isIndet{e_2}$ \BY{assumption} \pflabel{[indet2]e2-indet}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FVal}) on \pfref{[indet2]e1-val}}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{[indet2]e2-indet}}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:IPair})}]
        \begin{pfsteps*}
        \item $\isIndet{e_1}$ \BY{assumption} \pflabel{[indet3]e1-indet}
        \item $\isIndet{e_2}$ \BY{assumption} \pflabel{[indet3]e2-indet}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{[indet3]e1-indet}}
        \item $\isFinal{e_1}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{[indet3]e2-indet}}
        \end{pfsteps*}
    \end{byCases}
\end{byCases}
\resetpfcounter
\end{proof}

\begin{lemma}
  \label{lem:no-num-notintro}
  There doesn't exist $\hnum{n}$ such that $\notIntro{\hnum{n}}$.
\end{lemma}
\begin{proof}
    By rule induction over Rules (\ref{rules:notintro}) on $\notIntro{\hnum{n}}$, no case applies due to syntactic contradiction.
\end{proof}

\begin{lemma}
  \label{lem:no-inl-notintro}
  There doesn't exist $\hinl{\tau}{e}$ such that $\notIntro{\hinl{\tau}{e}}$.
\end{lemma}
\begin{proof}
    By rule induction over Rules (\ref{rules:notintro}) on $\notIntro{\hinl{\tau}{e}}$, no case applies due to syntactic contradiction.
\end{proof}

\begin{lemma}
  \label{lem:no-inr-notintro}
  There doesn't exist $\hinr{\tau}{e}$ such that $\notIntro{\hinr{\tau}{e}}$.
\end{lemma}
\begin{proof}
    By rule induction over Rules (\ref{rules:notintro}) on $\notIntro{\hinr{\tau}{e}}$, no case applies due to syntactic contradiction.
\end{proof}

\begin{lemma}
  \label{lem:no-pair-notintro}
  There doesn't exist $\hpair{e_1}{e_2}$ such that $\notIntro{\hpair{e_1}{e_2}}$.
\end{lemma}
\begin{proof}
    By rule induction over Rules (\ref{rules:notintro}) on $\notIntro{\hpair{e_1}{e_2}}$, no case applies due to syntactic contradiction.
\end{proof}

\begin{lemma}
  \label{lem:final-notintro-indet}
  If $\isFinal{e}$ and $\notIntro{e}$ then $\isIndet{e}$.
\end{lemma}
\begin{proof}[Proof Sketch]
By rule induction over Rules (\ref{rules:notintro}) on  $\notIntro{e}$, for each case, by rule induction over Rules (\ref{rules:Value}) on $\isVal{e}$ and we notice that $\isVal{e}$ is not derivable. By rule induction over Rules (\ref{rules:Final}) on $\isFinal{e}$, Rule (\ref{rule:FVal}) result in a contradiction with the fact that $\isVal{e}$ is not derivable while Rule (\ref{rule:FIndet}) tells us $\isIndet{e}$.
\end{proof}

\begin{lemma}
  \label{lem:val-not-indet}
  There doesn't exist such an expression $e$ such that both $\isVal{e}$ and $\isIndet{e}$.
\end{lemma}

\begin{lemma}
  \label{lem:val-not-notintro}
  There doesn't exist such an expression $e$ such that both $\isVal{e}$ and $\notIntro{e}$.
\end{lemma}

\begin{lemma}[Finality]
  \label{lem:finality}
  There doesn't exist such an expression $e$ such that both $\isFinal{e}$ and $\htrans{e}{e'}$ for some $e'$
\end{lemma}
\begin{proof}Assume there exists such an $e$ such that both $\isFinal{e}$ and $\htrans{e}{e'}$ for some $e'$ then proof by contradiction.
 
  By rule induction over Rules (\ref{rules:Final}) and Rules (\ref{rules:ITExp}), \textit{i.e.}, over Rules (\ref{rules:Value}) and Rules (\ref{rules:ITExp}) and over Rules (\ref{rules:Indet}) and Rules (\ref{rules:ITExp}) respectively. The proof can be done by straightforward observation of syntactic contradictions.
\end{proof}

\begin{lemma}[Matching Determinism]
  \label{lem:match-determinism}
  If $\isFinal{e}$ and $\hexptyp{\cdot}{\Delta_e}{e}{\tau}$ and $\chpattyp{p}{\tau}{\xi}{\Gamma}{\Delta}$ then exactly one of the following holds
  \begin{enumerate}
    \item $\hpatmatch{e}{p}{\theta}$ for some $\theta$
    \item $\hmaymatch{e}{p}$
    \item $\hnotmatch{e}{p}$
  \end{enumerate}
\end{lemma}
\begin{proof}
\begin{pfsteps*}
\item $\isFinal{e}$ \BY{assumption} \pflabel{e-final}
\item $\hexptyp{\cdot}{\Delta_e}{e}{\tau}$ \BY{assumption} \pflabel{e-typ}
\item $\chpattyp{p}{\tau}{\xi}{\Gamma}{\Delta}$ \BY{assumption} \pflabel{p-typ}
\end{pfsteps*}
By rule induction over Rules (\ref{rules:PatTyp}) on \pfref{p-typ}, we would show one conclusion is derivable while the other two are not.
\begin{byCases}
\savelocalsteps{0}
\item[\text{(\ref{rule:PTVar})}]
    \begin{pfsteps*}
    \item $p=x$ \BY{assumption}
    \item $\hpatmatch{e}{x}{e / x}$ \BY{\ruleref{rule:MVar}}
    \end{pfsteps*}
    Assume $\hmaymatch{e}{x}$. By rule induction over \rulesref{rules:maymatch} on it, only one case applies.
    \begin{byCases}
    \item[\text{(\ref{rule:MMNotIntro})}]
        \begin{pfsteps*}
        \item $\refutable{x}$ \BY{assumption} \pflabel{[var]rft}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:p-refutable} on \pfref{[var]rft}, no case applies due to syntactic contradiction.
    \end{byCases}
    \begin{pfsteps*}
    \item $\cancel{\hmaymatch{e}{x}}$ \BY{contradiction}
    \end{pfsteps*}
    Assume $\hnotmatch{e}{x}$. By rule induction over \rulesref{rules:notmatch} on it, no case applies due to syntactic contradiction.
    \begin{pfsteps*}
    \item $\cancel{\hnotmatch{e}{x}}$ \BY{contradiction}
    \end{pfsteps*}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTWild})}]
    \begin{pfsteps*}
    \item $p=\_$ \BY{assumption}
    \item $\hpatmatch{e}{\_}{\cdot}$ \BY{\ruleref{rule:MWild}}
    \end{pfsteps*}
    Assume $\hmaymatch{e}{\_}$. By rule induction over \rulesref{rules:maymatch} on it, only one case applies.
    \begin{byCases}
    \item[\text{(\ref{rule:MMNotIntro})}]
        \begin{pfsteps*}
        \item $\refutable{\_}$ \BY{assumption} \pflabel{[wild]rft}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:p-refutable} on \pfref{[wild]rft}, no case applies due to syntactic contradiction.
    \end{byCases}
    \begin{pfsteps*}
    \item $\cancel{\hmaymatch{e}{\_}}$ \BY{contradiction}
    \end{pfsteps*}
    Assume $\hnotmatch{e}{\_}$. By rule induction over \rulesref{rules:notmatch} on it, no case applies due to syntactic contradiction.
    \begin{pfsteps*}
    \item $\cancel{\hnotmatch{e}{\_}}$ \BY{contradiction}
    \end{pfsteps*}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTEHole})}]
    \begin{pfsteps*}
    \item $p=\heholep{w}$ \BY{assumption}
    \item $\hmaymatch{e}{\heholep{w}}$ \BY{\ruleref{rule:MMEHole}}
    \end{pfsteps*}
    Assume $\hpatmatch{e}{\heholep{w}}{\theta}$ for some $\theta$. By rule induction over \rulesref{rules:maymatch} on it, no case applies due to syntactic contradiction.
    \begin{pfsteps*}
    \item $\cancel{\hpatmatch{e}{\heholep{w}}{\theta}}$ \BY{contradiction}
    \end{pfsteps*}
    Assume $\hnotmatch{e}{\heholep{w}}$. By rule induction over \rulesref{rules:notmatch} on it, no case applies due to syntactic contradiction.
    \begin{pfsteps*}
    \item $\cancel{\hnotmatch{e}{\heholep{w}}}$ \BY{contradiction}
    \end{pfsteps*}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTHole})}]
    \begin{pfsteps*}
    \item $p=\hholep{p_0}{w}{\tau'}$ \BY{assumption}
    \item $\hmaymatch{e}{\hholep{p_0}{w}{\tau'}}$ \BY{\ruleref{rule:MMHole}}
    \end{pfsteps*}
    Assume $\hpatmatch{e}{\hholep{p_0}{w}{\tau'}}{\theta}$ for some $\theta$. By rule induction over \rulesref{rules:maymatch} on it, no case applies due to syntactic contradiction.
    \begin{pfsteps*}
    \item $\cancel{\hpatmatch{e}{\hholep{p_0}{w}{\tau'}}{\theta}}$ \BY{contradiction}
    \end{pfsteps*}
    Assume $\hnotmatch{e}{\hholep{p_0}{w}{\tau'}}$. By rule induction over \rulesref{rules:notmatch} on it, no case applies due to syntactic contradiction.
    \begin{pfsteps*}
    \item $\cancel{\hnotmatch{e}{\hholep{p_0}{w}{\tau'}}}$ \BY{contradiction}
    \end{pfsteps*}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTNum})}]
    \begin{pfsteps*}
    \item $p=\hnum{n_2}$ \BY{assumption}
    \item $\tau=\tnum$ \BY{assumption}
    \item $\xi=\cnum{n_2}$ \BY{assumption}
    \item $\refutable{\hnum{n_2}}$ \BY{\ruleref{rule:RNum}} \pflabel{[num]rft}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:TExp}) on \pfref{e-typ}, the following cases apply.
    \begin{byCases}
    \savelocalsteps{1}
    \item[\text{(\ref{rule:TEHole}),(\ref{rule:THole}),(\ref{rule:TAp}),(\ref{rule:TFst}),(\ref{rule:TSnd}),(\ref{rule:TMatchZPre}),(\ref{rule:TMatchNZPre})}]
        \begin{pfsteps*}
        \item $e=\hehole{u},\hhole{e_0}{u},\hap{e_1}{e_2},\hfst{e_0},\hsnd{e_0},\hmatch{e_0}{\zrules}$ \BY{assumption}
        \item $\notIntro{e}$ \BY{Rule (\ref{rule:NVEHole}),(\ref{rule:NVHole}),(\ref{rule:NVAp}),(\ref{rule:NVMatch}),(\ref{rule:NVFst}),(\ref{rule:NVSnd})} \pflabel{[num]notintro}
        \item $\hmaymatch{e}{\hnum{n_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[num]rft} and \pfref{[num]notintro}}
        \end{pfsteps*}
        Assume $\hpatmatch{e}{\hnum{n_2}}{\theta}$ for some $\theta$. By rule induction over it, no case applies due to syntactic contradiction.
        \begin{pfsteps*}
        \item $\cancel{\hpatmatch{e}{\hnum{n_2}}{\theta}}$ \BY{contradiction}
        \end{pfsteps*}
        Assume $\hnotmatch{e}{\hnum{n_2}}$. By rule induction over it, no case applies due to syntactic contradiction.
        \begin{pfsteps*}
        \item $\cancel{\hnotmatch{e}{\hnum{n_2}}}$ \BY{contradiction}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:TNum})}]
        \begin{pfsteps*}
        \item $e=\hnum{n_1}$
        \end{pfsteps*}
        Assume $\hmaymatch{\hnum{n_1}}{\hnum{n_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only two cases apply.
        \begin{byCases}
        \item[\text{(\ref{rule:MMNotIntro})}]
            \begin{pfsteps*}
            \item $\notIntro{\hnum{n_1}}$ \BY{assumption}
            \end{pfsteps*}
            Contradicts \autoref{lem:no-num-notintro}.
        \end{byCases}
        \begin{pfsteps*}
        \item $\cancel{\hmaymatch{\hnum{n_1}}{\hnum{n_2}}}$ \BY{contradiction}
        \end{pfsteps*}
        By case analysis on whether $n_1=n_2$.
        \begin{byCases}
        \savelocalsteps{2}
        \item[n_1=n_2]
            \begin{pfsteps*}
            \item $n_1=n_2$ \BY{assumption} \pflabel{[num]eq}
            \item $\hpatmatch{\hnum{n_1}}{\hnum{n_2}}{\cdot}$ \BY{\ruleref{rule:MNum}}
            \end{pfsteps*}
            Assume $\hnotmatch{\hnum{n_1}}{\hnum{n_2}}$. By rule induction over \rulesref{rules:notmatch} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:NMNum})}]
                \begin{pfsteps*}
                \item $n_1\neq n_2$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[num]eq}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hnum{n_1}}{\hnum{n_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[n_1\neq n_2]
            \begin{pfsteps*}
            \item $n_1\neq n_2$ \BY{assumption} \pflabel{[num]neq}
            \item $\hnotmatch{\hnum{n_1}}{\hnum{n_2}}$ \BY{\ruleref{rule:NMNum} on \pfref{[num]neq}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hnum{n_1}}{\hnum{n_2}}{\theta}$ for some $\theta$. By rule induction over \rulesref{rules:match} on it, no case applies due to syntactic contradiction.
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hnum{n_1}}{\hnum{n_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
        \end{byCases}
    \end{byCases}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTInl})}]
    \begin{pfsteps*}
    \item $p=\hinlp{p_1}$ \BY{assumption}
    \item $\tau=\tsum{\tau_1}{\tau_2}$ \BY{assumption}
    \item $\xi=\cinl{\xi_1}$ \BY{assumption}
    \item $\chpattyp{p_1}{\tau_1}{\xi_1}{\Gamma}{\Delta}$ \BY{assumption} \pflabel{[inl]p1-typ}
    \item $\refutable{\hinlp{p_1}}$ \BY{\ruleref{rule:RInl}} \pflabel{[inl]rft}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:TExp}) on \pfref{e-typ}, the following cases apply.
    \begin{byCases}
    \savelocalsteps{1}
    \item[\text{(\ref{rule:TEHole}),(\ref{rule:THole}),(\ref{rule:TAp}),(\ref{rule:TFst}),(\ref{rule:TSnd}),(\ref{rule:TMatchZPre}),(\ref{rule:TMatchNZPre})}]
        \begin{pfsteps*}
        \item $e=\hehole{u},\hhole{e_0}{u},\hap{e_1}{e_2},\hfst{e_0},\hsnd{e_0},\hmatch{e_0}{\zrules}$ \BY{assumption}
        \item $\notIntro{e}$ \BY{Rule (\ref{rule:NVEHole}),(\ref{rule:NVHole}),(\ref{rule:NVAp}),(\ref{rule:NVMatch}),(\ref{rule:NVFst}),(\ref{rule:NVSnd})} \pflabel{[inl]notintro}
        \item $\hmaymatch{e}{\hinlp{p_1}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[inl]rft} and \pfref{[inl]notintro}}
        \end{pfsteps*}
        Assume $\hpatmatch{e}{\hinlp{p_1}}{\theta_1}$ for some $\theta_1$. By rule induction over it, no case applies due to syntactic contradiction.
        \begin{pfsteps*}
        \item $\cancel{\hpatmatch{e}{\hinlp{p_1}}{\theta_1}}$ \BY{contradiction}
        \end{pfsteps*}
        Assume $\hnotmatch{e}{\hinlp{p_1}}$. By rule induction over it, no case applies due to syntactic contradiction.
        \begin{pfsteps*}
        \item $\cancel{\hnotmatch{e}{\hinlp{p_1}}}$ \BY{contradiction}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:TInl})}]
        \begin{pfsteps*}
        \item $e=\hinl{\tau_2}{e_1}$ \BY{assumption}
        \item $\hexptyp{\cdot}{\Delta_e}{e_1}{\tau_1}$ \BY{assumption} \pflabel{[inl]e1-typ}
        \item $\isFinal{e_1}$ \BY{\autoref{lem:inl-final} on \pfref{e-final}} \pflabel{[inl]e1-final}
        \end{pfsteps*}
        By inductive hypothesis on \pfref{[inl]e1-typ} and \pfref{[inl]e1-final} and \pfref{[inl]p1-typ}, exactly one of $\hpatmatch{e_1}{p_1}{\theta_1}$ for some $\theta_1$, $\hmaymatch{e_1}{p_1}$, and $\hnotmatch{e_1}{p_1}$ holds.\\
        By case analysis on which one holds.
        \begin{byCases}
        \savelocalsteps{2}
        \item[\hpatmatch{e_1}{p_1}{\theta_1}]
            \begin{pfsteps*}
            \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[inl1]match}
            \item $\cancel{\hmaymatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[inl1]not-maymatch}
            \item $\cancel{\hnotmatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[inl1]not-notmatch}
            \item $\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta_1}$ \BY{\ruleref{rule:MInl} on \pfref{[inl1]match}}
            \end{pfsteps*}
            Assume $\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$. By rule induction over \rulesref{rules:maymatch} on it, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hinl{\tau_2}{e_1}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-inl-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMInl})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inl1]not-maymatch}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hnotmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$. By rule induction over \rulesref{rules:notmatch} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:NMInl})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inl1]not-notmatch}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hmaymatch{e_1}{p_1}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_1}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[inl2]not-match}
            \item $\hmaymatch{e_1}{p_1}$ \BY{assumption} \pflabel{[inl2]maymatch}
            \item $\cancel{\hnotmatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[inl2]not-notmatch}
            \item $\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$ \BY{\ruleref{rule:MMInl} on \pfref{[inl2]maymatch}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta}$ for some $\theta$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MInl})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_1}{p_1}{\theta}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inl2]not-match}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hnotmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$. By rule induction over \rulesref{rules:notmatch} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:NMInl})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inl2]not-notmatch}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hnotmatch{e_1}{p_1}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_1}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[inl3]not-match}
            \item $\cancel{\hmaymatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[inl3]not-maymatch}
            \item $\hnotmatch{e_1}{p_1}$ \BY{assumption} \pflabel{[inl3]notmatch}
            \item $\hnotmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$ \BY{\ruleref{rule:NMInl} on \pfref{[inl3]notmatch}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta}$ for some $\theta$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MInl})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_1}{p_1}{\theta}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inl3]not-match}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$. By rule induction over \rulesref{rules:maymatch} on it, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hinl{\tau_2}{e_1}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-inl-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMInl})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inl3]not-maymatch}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}}$ \BY{contradiction}
            \end{pfsteps*}
        \end{byCases}
    \end{byCases}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTInr})}]
    \begin{pfsteps*}
    \item $p=\hinrp{p_2}$ \BY{assumption}
    \item $\tau=\tsum{\tau_1}{\tau_2}$ \BY{assumption}
    \item $\xi=\cinr{\xi_2}$ \BY{assumption}
    \item $\chpattyp{p_2}{\tau_2}{\xi_2}{\Gamma}{\Delta}$ \BY{assumption} \pflabel{[inr]p2-typ}
    \item $\refutable{\hinrp{p_2}}$ \BY{\ruleref{rule:RInr}} \pflabel{[inr]rft}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:TExp}) on \pfref{e-typ}, the following cases apply.
    \begin{byCases}
    \savelocalsteps{1}
    \item[\text{(\ref{rule:TEHole}),(\ref{rule:THole}),(\ref{rule:TAp}),(\ref{rule:TFst}),(\ref{rule:TSnd}),(\ref{rule:TMatchZPre}),(\ref{rule:TMatchNZPre})}]
        \begin{pfsteps*}
        \item $e=\hehole{u},\hhole{e_0}{u},\hap{e_1}{e_2},\hfst{e_0},\hsnd{e_0},\hmatch{e_0}{\zrules}$ \BY{assumption}
        \item $\notIntro{e}$ \BY{Rule (\ref{rule:NVEHole}),(\ref{rule:NVHole}),(\ref{rule:NVAp}),(\ref{rule:NVMatch}),(\ref{rule:NVFst}),(\ref{rule:NVSnd})} \pflabel{[inr]notintro}
        \item $\hmaymatch{e}{\hinrp{p_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[inr]rft} and \pfref{[inr]notintro}}
        \end{pfsteps*}
        Assume $\hpatmatch{e}{\hinrp{p_2}}{\theta_2}$ for some $\theta_2$. By rule induction over it, no case applies due to syntactic contradiction.
        \begin{pfsteps*}
        \item $\cancel{\hpatmatch{e}{\hinrp{p_2}}{\theta_2}}$ \BY{contradiction}
        \end{pfsteps*}
        Assume $\hnotmatch{e}{\hinrp{p_2}}$. By rule induction over it, no case applies due to syntactic contradiction.
        \begin{pfsteps*}
        \item $\cancel{\hnotmatch{e}{\hinrp{p_2}}}$ \BY{contradiction}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:TInr})}]
        \begin{pfsteps*}
        \item $e=\hinr{\tau_1}{e_2}$ \BY{assumption}
        \item $\hexptyp{\cdot}{\Delta_e}{e_2}{\tau_2}$ \BY{assumption} \pflabel{[inr]e2-typ}
        \item $\isFinal{e_2}$ \BY{\autoref{lem:inr-final} on \pfref{e-final}} \pflabel{[inr]e2-final}
        \end{pfsteps*}
        By inductive hypothesis on \pfref{[inr]e2-typ} and \pfref{[inr]e2-final} and \pfref{[inr]p2-typ}, exactly one of $\hpatmatch{e_2}{p_2}{\theta_2}$ for some $\theta_2$, $\hmaymatch{e_2}{p_2}$, and $\hnotmatch{e_2}{p_2}$ holds.\\
        By case analysis on which one holds.
        \begin{byCases}
        \savelocalsteps{2}
        \item[\hpatmatch{e_2}{p_2}{\theta_2}]
            \begin{pfsteps*}
            \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[inr1]match}
            \item $\cancel{\hmaymatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[inr1]not-maymatch}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[inr1]not-notmatch}
            \item $\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta_2}$ \BY{\ruleref{rule:MInr} on \pfref{[inr1]match}}
            \end{pfsteps*}
            Assume $\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hinr{\tau_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-inr-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMInr})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inr1]not-maymatch}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hnotmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$. By rule induction over \rulesref{rules:notmatch} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:NMInr})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inr1]not-notmatch}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hmaymatch{e_2}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_2}{p_2}{\theta}}$ \BY{assumption} \pflabel{[inr2]not-match}
            \item $\hmaymatch{e_2}{p_2}$ \BY{assumption} \pflabel{[inr2]maymatch}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[inr2]not-notmatch}
            \item $\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$ \BY{\ruleref{rule:MMInr} on \pfref{[inr2]maymatch}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta}$ for some $\theta$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MInr})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_2}{p_2}{\theta}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inr2]not-match}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hnotmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$. By rule induction over \rulesref{rules:notmatch} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:NMInr})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inr2]not-notmatch}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hnotmatch{e_2}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_2}{p_2}{\theta}}$ \BY{assumption} \pflabel{[inr3]not-match}
            \item $\cancel{\hmaymatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[inr3]not-maymatch}
            \item $\hnotmatch{e_2}{p_2}$ \BY{assumption} \pflabel{[inr3]notmatch}
            \item $\hnotmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$ \BY{\ruleref{rule:NMInr} on \pfref{[inr3]notmatch}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta}$ for some $\theta$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MInr})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_2}{p_2}{\theta}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inr3]not-match}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hinr{\tau_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-inr-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMInr})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[inr3]not-maymatch}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \end{byCases}
    \end{byCases}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTPair})}]
    \begin{pfsteps*}
    \item $p=\hpair{p_1}{p_2}$ \BY{assumption}
    \item $\tau=\tprod{\tau_1}{\tau_2}$ \BY{assumption}
    \item $\xi=\cpair{\xi_1}{\xi_2}$ \BY{assumption}
    \item $\Gamma=\Gamma_1 \uplus \Gamma_2$ \BY{assumption}
    \item $\Delta=\Delta_1 \uplus \Delta_2$ \BY{assumption}
    \item $\chpattyp{p_1}{\tau_1}{\xi_1}{\Gamma_1}{\Delta_1}$ \BY{assumption} \pflabel{[pair]p1-typ}
    \item $\chpattyp{p_2}{\tau_2}{\xi_2}{\Gamma_2}{\Delta_2}$ \BY{assumption} \pflabel{[pair]p2-typ}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:TExp}) on \pfref{e-typ}, the following cases apply.
    \begin{byCases}
    \savelocalsteps{1}
    \item[\text{(\ref{rule:TEHole}),(\ref{rule:THole}),(\ref{rule:TAp}),(\ref{rule:TFst}),(\ref{rule:TSnd}),(\ref{rule:TMatchZPre}),(\ref{rule:TMatchNZPre})}]
        \begin{pfsteps*}
        \item $e=\hehole{u},\hhole{e_0}{u},\hap{e_1}{e_2},\hfst{e_0},\hsnd{e_0},\hmatch{e_0}{\zrules}$ \BY{assumption}
        \item $\notIntro{e}$ \BY{Rule (\ref{rule:NVEHole}),(\ref{rule:NVHole}),(\ref{rule:NVAp}),(\ref{rule:NVMatch}),(\ref{rule:NVFst}),(\ref{rule:NVSnd})} \pflabel{[epair]notintro}
        \item $\isIndet{e}$ \BY{\autoref{lem:final-notintro-indet} on \pfref{e-final} and \pfref{[epair]notintro}} \pflabel{[epair]indet}
        \item $\isIndet{\hfst{e}}$ \BY{Rule (\ref{rule:IFst}) on \pfref{[epair]indet}} \pflabel{[epair]fst-indet}
        \item $\isFinal{\hfst{e}}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{[epair]fst-indet}} \pflabel{[epair]fst-final}
        \item $\isIndet{\hsnd{e}}$ \BY{Rule (\ref{rule:ISnd}) on \pfref{[epair]indet}} \pflabel{[epair]snd-indet}
        \item $\isFinal{\hsnd{e}}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{[epair]snd-indet}} \pflabel{[epair]snd-final}
        \item $\hexptyp{\cdot}{\Delta}{\hfst{e}}{\tau_1}$ \BY{Rule (\ref{rule:TFst}) on \pfref{e-typ}} \pflabel{[epair]fst-typ}
        \item $\hexptyp{\cdot}{\Delta}{\hsnd{e}}{\tau_2}$ \BY{Rule (\ref{rule:TSnd}) on \pfref{e-typ}} \pflabel{[epair]snd-typ}
        \end{pfsteps*}
        Assume $\hnotmatch{e}{\hpair{p_1}{p_2}}$. By rule induction on it, no case applies due to syntactic contradiction.
        \begin{pfsteps*}
        \item $\cancel{\hnotmatch{e}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
        \end{pfsteps*}
        By inductive hypothesis on \pfref{[epair]fst-final} and \pfref{[epair]fst-typ} and \pfref{[pair]p1-typ}, exactly one of $\hpatmatch{\hfst{e}}{p_1}{\theta_1}$, $\hmaymatch{\hfst{e}}{p_1}$, and $\hnotmatch{\hfst{e}}{p_1}$ holds. \\
        By inductive hypothesis on \pfref{[epair]snd-final} and \pfref{[epair]snd-typ} and \pfref{[pair]p2-typ}, exactly one of $\hpatmatch{\hsnd{e}}{p_2}{\theta_2}$, $\hmaymatch{\hsnd{e}}{p_2}$, and $\hnotmatch{\hsnd{e}}{p_2}$ holds. \\
        By case analysis on which conclusion holds for $p_1$ and $p_2$. Note that we have already shown $\cancel{\hnotmatch{e}{\hpair{p_1}{p_2}}}$.
        \begin{byCases}
        \savelocalsteps{2}
        \item[\hpatmatch{\hfst{e}}{p_1}{\theta_1},\hpatmatch{\hsnd{e}}{p_2}{\theta_2}]
            \begin{pfsteps*}
            \item $\hpatmatch{\hfst{e}}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[epair1]match1}
            \item $\cancel{\hmaymatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair1]not-maymatch1}
            \item $\cancel{\hnotmatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair1]not-notmatch1}
            \item $\hpatmatch{\hsnd{e}}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[epair1]match2}
            \item $\cancel{\hmaymatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair1]not-maymatch2}
            \item $\cancel{\hnotmatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair1]not-notmatch2}
            \item $\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta_1 \uplus \theta_2}$ \BY{\ruleref{rule:MNotIntroPair} on \pfref{[epair]notintro} and \pfref{[epair1]match1} and \pfref{[epair1]match2}}
            \end{pfsteps*}
            Assume $\hmaymatch{e}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\refutable{\hpair{p_1}{p_2}}$ \BY{assumption} \pflabel{[epair1]rft-pair}
                \end{pfsteps*}
                By rule induction over \rulesref{rules:p-refutable}, only two cases apply.
                \begin{byCases}
                \savelocalsteps{3}
                \item[\text{(\ref{rule:RPairL})}]
                    \begin{pfsteps*}
                    \item $\refutable{p_1}$ \BY{assumption} \pflabel{[epair1]rft-p1}
                    \item $\notIntro{\hfst{e}}$ \BY{\ruleref{rule:NVFst}} \pflabel{[epair1]notintro-fst}
                    \item $\hmaymatch{\hfst{e}}{p_1}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair1]rft-p1} and \pfref{[epair1]notintro-fst}}
                    \end{pfsteps*}
                    Contradicts \pfref{[epair1]not-maymatch1}.
                \restorelocalsteps{3}
                \item[\text{(\ref{rule:RPairR})}]
                    \begin{pfsteps*}
                    \item $\refutable{p_2}$ \BY{assumption} \pflabel{[epair1]rft-p2}
                    \item $\notIntro{\hsnd{e}}$ \BY{\ruleref{rule:NVSnd}} \pflabel{[epair1]notintro-snd}
                    \item $\hmaymatch{\hfst{e}}{p_1}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair1]rft-p2} and \pfref{[epair1]notintro-snd}}
                    \end{pfsteps*}
                    Contradicts \pfref{[epair1]not-maymatch1}.
                \end{byCases}
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{e}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hpatmatch{\hfst{e}}{p_1}{\theta_1},\hmaymatch{\hsnd{e}}{p_2}]
            \begin{pfsteps*}
            \item $\hpatmatch{\hfst{e}}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[epair2]match1}
            \item $\cancel{\hmaymatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair2]not-maymatch1}
            \item $\cancel{\hnotmatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair2]not-notmatch1}
            \item $\cancel{\hpatmatch{\hsnd{e}}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[epair2]not-match2}
            \item $\hmaymatch{\hsnd{e}}{p_2}$ \BY{assumption} \pflabel{[epair2]maymatch2}
            \item $\cancel{\hnotmatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair2]not-notmatch2}
            \end{pfsteps*}
            Assume $\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MNotIntroPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$ \BY{assumption}
                \item $\hpatmatch{\hsnd{e}}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[epair2]match2}
                \end{pfsteps*}
                Contradicts \pfref{[epair2]not-match2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:maymatch} on \pfref{[epair2]maymatch2}, the following cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMEHole}),(\ref{rule:MMHole})}]
                \begin{pfsteps*}
                \item $p_2=\heholep{w},\hholep{p}{w}{\tau'}$ \BY{assumption}
                \item $\refutable{p_2}$ \BY{\ruleref{rule:REHole} and \ruleref{rule:RHole}} \pflabel{[epair2]rft-p2}
                \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairR} on \pfref{[epair2]rft-p2}} \pflabel{[epair2]rft-pair}
                \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair2]rft-pair}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\refutable{p_2}$ \BY{assumption} \pflabel{[epair2]rft-p2'}
                \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairR} on \pfref{[epair2]rft-p2'}} \pflabel{[epair2]rft-pair'}
                \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair2]rft-pair'}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item[\hpatmatch{\hfst{e}}{p_1}{\theta_1},\hnotmatch{\hsnd{e}}{p_2}]
            \begin{pfsteps*}
            \item $\hpatmatch{\hfst{e}}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[epair3]match1}
            \item $\cancel{\hmaymatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair3]not-maymatch1}
            \item $\cancel{\hnotmatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair3]not-notmatch1}
            \item $\cancel{\hpatmatch{\hsnd{e}}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[epair3]not-match2}
            \item $\cancel{\hmaymatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair3]not-maymatch2}
            \item $\hnotmatch{\hsnd{e}}{p_2}$ \BY{assumption} \pflabel{[epair3]notmatch2}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:notmatch} on \pfref{[epair3]notmatch2}, no case applies due to syntactic contradiction.\\
            Therefore, vacuously true.
        \restorelocalsteps{2}
        \item[\hmaymatch{\hfst{e}}{p_1},\hpatmatch{\hsnd{e}}{p_2}{\theta_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hfst{e}}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[epair4]not-match1}
            \item $\hmaymatch{\hfst{e}}{p_1}$ \BY{assumption} \pflabel{[epair4]maymatch1}
            \item $\cancel{\hnotmatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair4]not-notmatch1}
            \item $\hpatmatch{\hsnd{e}}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[epair4]match2}
            \item $\cancel{\hmaymatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair4]not-maymatch2}
            \item $\cancel{\hnotmatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair4]not-notmatch2}
            \end{pfsteps*}
            Assume $\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MNotIntroPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$ \BY{assumption}
                \item $\hpatmatch{\hfst{e}}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[epair4]match1}
                \end{pfsteps*}
                Contradicts \pfref{[epair4]not-match1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:maymatch} on \pfref{[epair4]maymatch1}, the following cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMEHole}),(\ref{rule:MMHole})}]
                \begin{pfsteps*}
                \item $p_1=\heholep{w},\hholep{p}{w}{\tau'}$ \BY{assumption}
                \item $\refutable{p_1}$ \BY{\ruleref{rule:REHole} and \ruleref{rule:RHole}} \pflabel{[epair4]rft-p1}
                \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairR} on \pfref{[epair4]rft-p1}} \pflabel{[epair4]rft-pair}
                \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair4]rft-pair}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\refutable{p_1}$ \BY{assumption} \pflabel{[epair4]rft-p1'}
                \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairR} on \pfref{[epair4]rft-p1'}} \pflabel{[epair4]rft-pair'}
                \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair4]rft-pair'}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item[\hmaymatch{\hfst{e}}{p_1},\hmaymatch{\hsnd{e}}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hfst{e}}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[epair5]not-match1}
            \item $\hmaymatch{\hfst{e}}{p_1}$ \BY{assumption} \pflabel{[epair5]maymatch1}
            \item $\cancel{\hnotmatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair5]not-notmatch1}
            \item $\cancel{\hpatmatch{\hsnd{e}}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[epair5]not-match2}
            \item $\hmaymatch{\hsnd{e}}{p_2}$ \BY{assumption} \pflabel{[epair5]maymatch2}
            \item $\cancel{\hnotmatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair5]not-notmatch2}
            \end{pfsteps*}
            Assume $\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MNotIntroPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$ \BY{assumption}
                \item $\hpatmatch{\hfst{e}}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[epair5]match1}
                \end{pfsteps*}
                Contradicts \pfref{[epair5]not-match1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:maymatch} on \pfref{[epair5]maymatch1}, the following cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMEHole}),(\ref{rule:MMHole})}]
                \begin{pfsteps*}
                \item $p_1=\heholep{w},\hholep{p}{w}{\tau'}$ \BY{assumption}
                \item $\refutable{p_1}$ \BY{\ruleref{rule:REHole} and \ruleref{rule:RHole}} \pflabel{[epair5]rft-p1}
                \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairR} on \pfref{[epair5]rft-p1}} \pflabel{[epair5]rft-pair}
                \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair5]rft-pair}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\refutable{p_1}$ \BY{assumption} \pflabel{[epair5]rft-p1'}
                \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairR} on \pfref{[epair5]rft-p1'}} \pflabel{[epair5]rft-pair'}
                \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair5]rft-pair'}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item[\hmaymatch{\hfst{e}}{p_1},\hnotmatch{\hsnd{e}}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hfst{e}}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[epair6]not-match1}
            \item $\hmaymatch{\hfst{e}}{p_1}$ \BY{assumption} \pflabel{[epair6]maymatch1}
            \item $\cancel{\hnotmatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair6]not-notmatch1}
            \item $\cancel{\hpatmatch{\hsnd{e}}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[epair6]not-match2}
            \item $\cancel{\hmaymatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair6]not-maymatch2}
            \item $\hnotmatch{\hsnd{e}}{p_2}$ \BY{assumption} \pflabel{[epair6]notmatch2}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:notmatch} on \pfref{[epair6]notmatch2}, no case applies due to syntactic contradiction.\\
            Therefore, vacuously true.
        \restorelocalsteps{2}
        \item[\hnotmatch{\hfst{e}}{p_1},\hpatmatch{\hsnd{e}}{p_2}{\theta_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hfst{e}}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[epair7]not-match1}
            \item $\cancel{\hmaymatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair7]not-maymatch1}
            \item $\hnotmatch{\hfst{e}}{p_1}$ \BY{assumption} \pflabel{[epair7]notmatch1}
            \item $\hpatmatch{\hsnd{e}}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[epair7]match2}
            \item $\cancel{\hmaymatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair7]not-maymatch2}
            \item $\cancel{\hnotmatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair7]not-notmatch2}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:notmatch} on \pfref{[epair7]notmatch1}, no case applies due to syntactic contradiction.\\
            Therefore, vacuously true.
        \restorelocalsteps{2}
        \item[\hnotmatch{\hfst{e}}{p_1},\hmaymatch{\hsnd{e}}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hfst{e}}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[epair8]not-match1}
            \item $\cancel{\hmaymatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair8]not-maymatch1}
            \item $\hnotmatch{\hfst{e}}{p_1}$ \BY{assumption} \pflabel{[epair8]notmatch1}
            \item $\cancel{\hpatmatch{\hsnd{e}}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[epair8]not-match2}
            \item $\hmaymatch{\hsnd{e}}{p_2}$ \BY{assumption} \pflabel{[epair8]maymatch2}
            \item $\cancel{\hnotmatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair8]not-notmatch2}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:notmatch} on \pfref{[epair8]notmatch1}, no case applies due to syntactic contradiction.\\
            Therefore, vacuously true.
        \restorelocalsteps{2}
        \item[\hnotmatch{\hfst{e}}{p_1},\hnotmatch{\hsnd{e}}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hfst{e}}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[epair9]not-match1}
            \item $\cancel{\hmaymatch{\hfst{e}}{p_1}}$ \BY{assumption} \pflabel{[epair9]not-maymatch1}
            \item $\hnotmatch{\hfst{e}}{p_1}$ \BY{assumption} \pflabel{[epair9]notmatch1}
            \item $\cancel{\hpatmatch{\hsnd{e}}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[epair9]not-match2}
            \item $\hmaymatch{\hsnd{e}}{p_2}$ \BY{assumption} \pflabel{[epair9]maymatch2}
            \item $\cancel{\hnotmatch{\hsnd{e}}{p_2}}$ \BY{assumption} \pflabel{[epair9]not-notmatch2}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:notmatch} on \pfref{[epair9]notmatch1}, no case applies due to syntactic contradiction.\\
            Therefore, vacuously true.
        \end{byCases}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:TPair})}]
        \begin{pfsteps*}
        \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
        \item $\hexptyp{\cdot}{\Delta}{e_1}{\tau_1}$ \BY{assumption} \pflabel{[pair]e1-typ}
        \item $\hexptyp{\cdot}{\Delta}{e_2}{\tau_2}$ \BY{assumption} \pflabel{[pair]e2-typ}
        \item $\isFinal{e_1}$ \BY{\autoref{lem:pair-final} on \pfref{e-final}} \pflabel{[pair]e1-final}
        \item $\isFinal{e_2}$ \BY{\autoref{lem:pair-final} on \pfref{e-final}} \pflabel{[pair]e2-final}
        \end{pfsteps*}
        By inductive hypothesis on \pfref{[pair]p1-typ} and \pfref{[pair]e1-typ} and \pfref{[pair]e1-final}, exactly one of $\hpatmatch{e_1}{p_1}{\theta_1}$, $\hmaymatch{e_1}{p_1}$, and $\hnotmatch{e_1}{p_1}$ holds. \\
        By inductive hypothesis on \pfref{[pair]p2-typ} and \pfref{[pair]e2-typ} and \pfref{[pair]e2-final}, exactly one of $\hpatmatch{e_2}{p_2}{\theta_2}$, $\hmaymatch{e_2}{p_2}$, and $\hnotmatch{e_2}{p_2}$ holds. \\
        By case analysis on which conclusion holds for $p_1$ and $p_2$.
        \begin{byCases}
        \savelocalsteps{2}
        \item[\hpatmatch{e_1}{p_1}{\theta_1},\hpatmatch{e_2}{p_2}{\theta_2}]
            \begin{pfsteps*}
            \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[pair1]match1}
            \item $\cancel{\hmaymatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair1]not-maymatch1}
            \item $\cancel{\hnotmatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair1]not-notmatch1}
            \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[pair1]match2}
            \item $\cancel{\hmaymatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair1]not-maymatch2}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair1]not-notmatch2}
            \item $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta_1 \uplus \theta_2}$ \BY{\ruleref{rule:MPair} on \pfref{[pair1]match1} and \pfref{[pair1]match2}}
            \end{pfsteps*}
            Assume $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only four cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairL})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair1]not-maymatch1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairR})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair1]not-maymatch2}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPair})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair1]not-maymatch1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:notmatch} on it, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:NMPairL})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair1]not-notmatch1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:NMPairR})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair1]not-notmatch2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hpatmatch{e_1}{p_1}{\theta_1},\hmaymatch{e_2}{p_2}]
            \begin{pfsteps*}
            \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[pair2]match1}
            \item $\cancel{\hmaymatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair2]not-maymatch1}
            \item $\cancel{\hnotmatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair2]not-notmatch1}
            \item $\cancel{\hpatmatch{e_2}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[pair2]not-match2}
            \item $\hmaymatch{e_2}{p_2}$ \BY{assumption} \pflabel{[pair2]maymatch2}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair2]not-notmatch2}
            \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMPairR} on \pfref{[pair2]match1} and \pfref{[pair2]maymatch2}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair2]not-match2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:notmatch} on it, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:NMPairL})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair2]not-notmatch1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:NMPairR})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair2]not-notmatch2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hpatmatch{e_1}{p_1}{\theta_1},\hnotmatch{e_2}{p_2}]
            \begin{pfsteps*}
            \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[pair3]match1}
            \item $\cancel{\hmaymatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair3]not-maymatch1}
            \item $\cancel{\hnotmatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair3]not-notmatch1}
            \item $\cancel{\hpatmatch{e_2}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[pair3]not-match2}
            \item $\cancel{\hmaymatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair3]not-maymatch2}
            \item $\hnotmatch{e_2}{p_2}$ \BY{assumption} \pflabel{[pair3]notmatch2}
            \item $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:NMPairR} on \pfref{[pair3]notmatch2}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair3]not-match2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only four cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairL})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair3]not-maymatch1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairR})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair3]not-maymatch2}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPair})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair3]not-maymatch1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hmaymatch{e_1}{p_1},\hpatmatch{e_2}{p_2}{\theta_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_1}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[pair4]not-match1}
            \item $\hmaymatch{e_1}{p_1}$ \BY{assumption} \pflabel{[pair4]maymatch1}
            \item $\cancel{\hnotmatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair4]not-notmatch1}
            \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[pair4]match2}
            \item $\cancel{\hmaymatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair4]not-maymatch2}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair4]not-notmatch2}
            \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMPairL} on \pfref{[pair4]maymatch1} and \pfref{[pair4]match2}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair4]not-match1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:notmatch} on it, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:NMPairL})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair4]not-notmatch1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:NMPairR})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair4]not-notmatch2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hmaymatch{e_1}{p_1},\hmaymatch{e_2}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_1}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[pair5]not-match1}
            \item $\hmaymatch{e_1}{p_1}$ \BY{assumption} \pflabel{[pair5]maymatch1}
            \item $\cancel{\hnotmatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair5]not-notmatch1}
            \item $\cancel{\hpatmatch{e_2}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[pair5]not-match2}
            \item $\hmaymatch{e_2}{p_2}$ \BY{assumption} \pflabel{[pair5]maymatch2}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair5]not-notmatch2}
            \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMPair} on \pfref{[pair5]maymatch1} and \pfref{[pair5]maymatch2}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair5]not-match2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:notmatch} on it, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:NMPairL})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair5]not-notmatch1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:NMPairR})}]
                \begin{pfsteps*}
                \item $\hnotmatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair5]not-notmatch2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hmaymatch{e_1}{p_1},\hnotmatch{e_2}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_1}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[pair6]not-match1}
            \item $\hmaymatch{e_1}{p_1}$ \BY{assumption} \pflabel{[pair6]maymatch1}
            \item $\cancel{\hnotmatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair6]not-notmatch1}
            \item $\cancel{\hpatmatch{e_2}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[pair6]not-match2}
            \item $\cancel{\hmaymatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair6]not-maymatch2}
            \item $\hnotmatch{e_2}{p_2}$ \BY{assumption} \pflabel{[pair6]notmatch2}
            \item $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:NMPairR} on \pfref{[pair6]notmatch2}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair6]not-match2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only four cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairL})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair6]not-match2}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairR})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair6]not-maymatch2}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPair})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair6]not-maymatch2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hnotmatch{e_1}{p_1},\hpatmatch{e_2}{p_2}{\theta_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_1}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[pair7]not-match1}
            \item $\cancel{\hmaymatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair7]not-maymatch1}
            \item $\hnotmatch{e_1}{p_1}$ \BY{assumption} \pflabel{[pair7]notmatch1}
            \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[pair7]match2}
            \item $\cancel{\hmaymatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair7]not-maymatch2}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair7]not-notmatch2}
            \item $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:NMPairL} on \pfref{[pair7]notmatch1}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair7]not-match1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only four cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairL})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair7]not-maymatch1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairR})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair7]not-maymatch2}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPair})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair7]not-maymatch1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hnotmatch{e_1}{p_1},\hmaymatch{e_2}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_1}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[pair8]not-match1}
            \item $\cancel{\hmaymatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair8]not-maymatch1}
            \item $\hnotmatch{e_1}{p_1}$ \BY{assumption} \pflabel{[pair8]notmatch1}
            \item $\cancel{\hpatmatch{e_2}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[pair8]not-match2}
            \item $\hmaymatch{e_2}{p_2}$ \BY{assumption} \pflabel{[pair8]maymatch2}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair8]not-notmatch2}
            \item $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:NMPairL} on \pfref{[pair8]notmatch1}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair8]not-match2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only four cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairL})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair8]not-match2}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairR})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair8]not-match1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPair})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair8]not-maymatch1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item[\hnotmatch{e_1}{p_1},\hnotmatch{e_2}{p_2}]
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{e_1}{p_1}{\theta_1}}$ \BY{assumption} \pflabel{[pair9]not-match1}
            \item $\cancel{\hmaymatch{e_1}{p_1}}$ \BY{assumption} \pflabel{[pair9]not-maymatch1}
            \item $\hnotmatch{e_1}{p_1}$ \BY{assumption} \pflabel{[pair9]notmatch1}
            \item $\cancel{\hpatmatch{e_2}{p_2}{\theta_2}}$ \BY{assumption} \pflabel{[pair9]not-match2}
            \item $\hmaymatch{e_2}{p_2}$ \BY{assumption} \pflabel{[pair9]maymatch2}
            \item $\cancel{\hnotmatch{e_2}{p_2}}$ \BY{assumption} \pflabel{[pair9]not-notmatch2}
            \item $\hnotmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:NMPairL} on \pfref{[pair9]notmatch1}}
            \end{pfsteps*}
            Assume $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$. By rule induction over \rulesref{rules:match} on it, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair9]not-match2}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}}$ \BY{contradiction}
            \end{pfsteps*}
            Assume $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$. By rule induction over \rulesref{rules:maymatch} on it, only four cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairL})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair9]not-match2}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairR})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair9]not-match1}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPair})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \pfref{[pair9]not-maymatch1}.
            \end{byCases}
            \begin{pfsteps*}
            \item $\cancel{\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}}$ \BY{contradiction}
            \end{pfsteps*}
        \end{byCases}
    \end{byCases}
    
\end{byCases}
\resetpfcounter
\end{proof}

\begin{lemma}[Matching Coherence of Constraint]
  \label{lem:const-matching-coherence}
  Suppose that $\hexptyp{\cdot}{\Delta_e}{e}{\tau}$ and $\isFinal{e}$ and $\chpattyp{p}{\tau}{\xi}{\Gamma}{\Delta}$. Then we have
  \begin{enumerate}
  \item $\csatisfy{e}{\xi}$ iff $\hpatmatch{e}{p}{\theta}$
  \item $\cmaysatisfy{e}{\xi}$ iff $\hmaymatch{e}{p}$
  \item $\cnotsatisfyormay{e}{\xi}$ iff $\hnotmatch{e}{p}$
  \end{enumerate}
\end{lemma}
\begin{proof}
\begin{pfsteps*}
\item $\hexptyp{\cdot}{\Delta_e}{e}{\tau}$ \BY{assumption} \pflabel{eTyp}
\item $\isFinal{e}$ \BY{assumption} \pflabel{eFinal}
\item $\chpattyp{p}{\tau}{\xi}{\Gamma}{\Delta}$ \BY{assumption} \pflabel{patTyp}
\end{pfsteps*}
Given \autoref{lem:pat-xi-type}, \autoref{thrm:exclusive-constraint-satisfaction}, and \autoref{lem:match-determinism}, it is sufficient to prove
\begin{enumerate}
  \item $\csatisfy{e}{\xi}$ iff $\hpatmatch{e}{p}{\theta}$
  \item $\cmaysatisfy{e}{\xi}$ iff $\hmaymatch{e}{p}$
\end{enumerate}
By rule induction over Rules (\ref{rules:PatTyp}) on \pfref{patTyp}.
\begin{byCases}
\savelocalsteps{0}
\item[\text{(\ref{rule:PTVar})}]
    \begin{pfsteps*}
    \item $p=x$ \BY{assumption}
    \item $\xi=\ctruth$ \BY{assumption}
    \end{pfsteps*}
    \begin{enumerate}
    \savelocalsteps{1}
    \item Prove $\csatisfy{e}{\ctruth}$ implies $\hpatmatch{e}{x}{\theta}$ for some $\theta$.
        \begin{pfsteps*}
        \item $\hpatmatch{e}{x}{e / x}$ \BY{Rule (\ref{rule:MVar})}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item Prove $\hpatmatch{e}{x}{\theta}$ implies $\csatisfy{e}{\ctruth}$.
        \begin{pfsteps*}
        \item $\csatisfy{e}{\ctruth}$ \BY{Rule (\ref{rule:CSTruth})}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item Prove $\cmaysatisfy{e}{\ctruth}$ implies $\hmaymatch{e}{x}$.
        \begin{pfsteps*}
        \item $\cnotmaysatisfy{e}{\ctruth}$ \BY{\autoref{lem:no-e-may-satisfy-truth}}
        \end{pfsteps*}
        Vacuously true.
    \restorelocalsteps{1}
    \item Prove $\hmaymatch{e}{x}$ implies $\cmaysatisfy{e}{\ctruth}$.
    
        By rule induction over Rules (\ref{rules:maymatch}), we notice that either, $\hmaymatch{e}{x}$ is in syntactic contradiction with all the cases, or the premise $\refutable{x}$ is not derivable. Hence, $\hmaymatch{e}{x}$ are not derivable. And thus vacuously true.
    \end{enumerate}
    
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTWild})}]
    \begin{pfsteps*}
    \item $p=\_$ \BY{assumption}
    \item $\xi=\ctruth$ \BY{assumption}
    \end{pfsteps*}
    \begin{enumerate}
    \savelocalsteps{1}
    \item Prove $\csatisfy{e}{\ctruth}$ implies $\hpatmatch{e}{\_}{\theta}$ for some $\theta$.
        \begin{pfsteps*}
        \item $\hpatmatch{e}{\_}{\cdot}$ \BY{Rule (\ref{rule:MVar})}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item Prove $\hpatmatch{e}{\_}{\theta}$ implies $\csatisfy{e}{\ctruth}$.
        \begin{pfsteps*}
        \item $\csatisfy{e}{\ctruth}$ \BY{Rule (\ref{rule:CSTruth})}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item Prove $\cmaysatisfy{e}{\ctruth}$ implies $\hmaymatch{e}{\_}$.
        \begin{pfsteps*}
        \item $\cnotmaysatisfy{e}{\ctruth}$ \BY{\autoref{lem:no-e-may-satisfy-truth}}
        \end{pfsteps*}
        Vacuously true.
    \restorelocalsteps{1}
    \item Prove $\hmaymatch{e}{\_}$ implies $\cmaysatisfy{e}{\xi}$.
    
        By rule induction over Rules (\ref{rules:maymatch}), we notice that either, $\hmaymatch{e}{\_}$ is in syntactic contradiction with all the cases, or the premise $\refutable{\_}$ is not derivable. Hence, $\hmaymatch{e}{\_}$ are not derivable. And thus vacuously true.
    \end{enumerate}
    
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTEHole})}]
    \begin{pfsteps*}
    \item $p=\heholep{w}$ \BY{assumption}
    \item $\xi=\cunknown$ \BY{assumption}
    \item $\cdual{\xi}=\cunknown$ \BY{Definition \ref{defn:dual}}
    \end{pfsteps*}
    \begin{enumerate}
    \savelocalsteps{1}
    \item Prove $\csatisfy{e}{\cunknown}$ implies $\hpatmatch{e}{\heholep{w}}{\theta}$ for some $\theta$.
        \begin{pfsteps*}
        \item $\cnotsatisfy{e}{\cunknown}$ \BY{Rule (\ref{rule:MVar})}
        \end{pfsteps*}
        Vacuously true.
    \restorelocalsteps{1}
    \item Prove $\hpatmatch{e}{\heholep{w}}{\theta}$ implies $\csatisfy{e}{\cunknown}$.\\
        By rule induction over Rules (\ref{rules:match}), we notice that $\hpatmatch{e}{\heholep{w}}{\theta}$ is in syntactic contradiction with all the cases, hence not derivable. And thus vacuously true.
    \restorelocalsteps{1}
    \item Prove $\cmaysatisfy{e}{\cunknown}$ implies $\hmaymatch{e}{\heholep{w}}$.
        \begin{pfsteps*}
        \item $\hmaymatch{e}{\heholep{w}}$ \BY{Rule (\ref{rule:MMEHole})}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item Prove $\hmaymatch{e}{\heholep{w}}$ implies $\cmaysatisfy{e}{\cunknown}$.
        \begin{pfsteps*}
        \item $\cmaysatisfy{e}{\cunknown}$ \BY{Rule (\ref{rule:CMSUnknown})}
        \end{pfsteps*}
    \end{enumerate}

\restorelocalsteps{0}
\item[\text{(\ref{rule:PTHole})}]
    \begin{pfsteps*}
    \item $p=\hholep{p_0}{w}{\tau'}$ \BY{assumption}
    \item $\xi=\cunknown$ \BY{assumption}
    \end{pfsteps*}
    \begin{enumerate}
    \savelocalsteps{1}
    \item Prove $\csatisfy{e}{\cunknown}$ implies $\hpatmatch{e}{\hholep{p_0}{w}{\tau'}}{\theta}$ for some $\theta$.
        \begin{pfsteps*}
        \item $\cnotsatisfy{e}{\cunknown}$ \BY{Rule (\ref{rule:MVar})}
        \end{pfsteps*}
        Vacuously true.
    \restorelocalsteps{1}
    \item Prove $\hpatmatch{e}{\hholep{p_0}{w}{\tau'}}{\theta}$ implies $\csatisfy{e}{\cunknown}$.\\
        By rule induction over Rules (\ref{rules:match}), we notice that $\hpatmatch{e}{\hholep{p_0}{w}{\tau'}}{\theta}$ is in syntactic contradiction with all the cases, hence not derivable. And thus vacuously true.
    \restorelocalsteps{1}
    \item Prove $\cmaysatisfy{e}{\cunknown}$ implies $\hmaymatch{e}{\hholep{p_0}{w}{\tau'}}$.
        \begin{pfsteps*}
        \item $\hmaymatch{e}{\hholep{p_0}{w}{\tau'}}$ \BY{Rule (\ref{rule:MMHole})}
        \end{pfsteps*}
    \restorelocalsteps{1}
    \item Prove $\hmaymatch{e}{\hholep{p_0}{w}{\tau'}}$ implies $\cmaysatisfy{e}{\cunknown}$.
        \begin{pfsteps*}
        \item $\cmaysatisfy{e}{\cunknown}$ \BY{Rule (\ref{rule:CMSUnknown})}
        \end{pfsteps*}
    \end{enumerate}
    
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTNum})}]
    \begin{pfsteps*}
    \item $p=\hnum{n}$ \BY{assumption}
    \item $\xi=\cnum{n}$ \BY{assumption}
    \end{pfsteps*}
    \begin{enumerate}
    \savelocalsteps{1}
    \item Prove $\csatisfy{e}{\cnum{n}}$ implies $\hpatmatch{e}{\hnum{n}}{\theta}$ for some $\theta$.
        \begin{pfsteps*}
        \item $\csatisfy{e}{\cnum{n}}$ \BY{assumption} \pflabel{[num]satisfy}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:Satisfy} on \pfref{[num]satisfy}, only one case applies.
        \begin{byCases}
        \item[\text{(\ref{rule:CSNum})}]
            \begin{pfsteps*}
            \item $e=\hnum{n}$ \BY{assumption}
            \item $\hpatmatch{\hnum{n}}{\hnum{n}}{\cdot}$ \BY{\ruleref{rule:MNum}}
            \end{pfsteps*}
        \end{byCases}
    \restorelocalsteps{1}
    \item Prove $\hpatmatch{e}{\hnum{n}}{\theta}$ implies $\csatisfy{e}{\cnum{n}}$.
        \begin{pfsteps*}
        \item $\hpatmatch{e}{\hnum{n}}{\theta}$ \BY{assumption} \pflabel{[num]match}
        \end{pfsteps*}
        By rule induction over Rules (\ref{rules:match}) on \pfref{[num]match}, only one case applies.
        \begin{byCases}
        \item[\text{(\ref{rule:MNum})}]
            \begin{pfsteps*}
            \item $e=\hnum{n}$ \BY{assumption}
            \item $\theta=\cdot$ \BY{assumption}
            \item $\csatisfy{\hnum{n}}{\cnum{n}}$ \BY{\ruleref{rule:CSNum}}
            \end{pfsteps*}
        \end{byCases}
    \restorelocalsteps{1}
    \item Prove $\cmaysatisfy{e}{\cnum{n}}$ implies $\hmaymatch{e}{\hnum{n}}$.
        \begin{pfsteps*}
        \item $\cmaysatisfy{e}{\cnum{n}}$ \BY{assumption} \pflabel{[num]maysat}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:MaySatisfy} on \pfref{[num]maysat}, only one case applies.
        \begin{byCases}
        \item[\text{(\ref{rule:CMSNotIntro})}]
            \begin{pfsteps*}
            \item $\notIntro{e}$ \BY{assumption} \pflabel{[num]notnum}
            \item $\refutable{\hnum{n}}$ \BY{\ruleref{rule:RNum}} \pflabel{[num]rft}
            \item $\hmaymatch{e}{\hnum{n}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[num]notnum} and \pfref{[num]rft}}
            \end{pfsteps*}
        \end{byCases}
    \restorelocalsteps{1}
    \item Prove $\hmaymatch{e}{\hnum{n}}$ implies $\cmaysatisfy{e}{\cnum{n}}$.
        \begin{pfsteps*}
        \item $\hmaymatch{e}{\hnum{n}}$ \BY{assumption} \pflabel{[num]maymatch}
        \end{pfsteps*}
        By rule induction over \rulesref{rules:maymatch} on \pfref{[num]maymatch}, only one case applies.
        \begin{byCases}
        \item[\text{(\ref{rule:MMNotIntro})}]
            \begin{pfsteps*}
            \item $\notIntro{e}$ \BY{assumption} \pflabel{[num]notnum'}
            \item $\refutable{\cnum{n}}$ \BY{\ruleref{rule:RXNum}} \pflabel{[num]xi-rft}
            \item $\cmaysatisfy{e}{\cnum{n}}$ \BY{\ruleref{rules:MaySatisfy} on \pfref{[num]notnum'} and \pfref{[num]xi-rft}}
            \end{pfsteps*}
        \end{byCases}
    \end{enumerate}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTInl})}]
    \begin{pfsteps*}
    \item $p=\hinlp{p_1}$ \BY{assumption}
    \item $\xi=\cinl{\xi_1}$ \BY{assumption}
    \item $\tau=\tsum{\tau_1}{\tau_2}$ \BY{assumption}
    \item $\chpattyp{p_1}{\tau_1}{\xi_1}{\Gamma}{\Delta}$ \BY{assumption} \pflabel{[inl]p1-typ}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:TExp}) on \pfref{eTyp}, the following cases apply.
    \begin{byCases}
    \savelocalsteps{1}
    \item[\text{(\ref{rule:TEHole}),(\ref{rule:THole}),(\ref{rule:TAp}),(\ref{rule:TFst}),(\ref{rule:TSnd}),(\ref{rule:TMatchZPre}),(\ref{rule:TMatchNZPre})}]
        \begin{pfsteps*}
        \item $e=\hehole{u},\hhole{e_0}{u},\hap{e_1}{e_2},\hfst{e_0},\hsnd{e_0},\hmatch{e_0}{\zrules}$ \BY{assumption}
        \item $\notIntro{e}$ \BY{Rule (\ref{rule:NVEHole}),(\ref{rule:NVHole}),(\ref{rule:NVAp}),(\ref{rule:NVMatch}),(\ref{rule:NVFst}),(\ref{rule:NVSnd})} \pflabel{[inl]notintro}
        \end{pfsteps*}
        \begin{enumerate}
        \savelocalsteps{2}
        \item Prove $\csatisfy{e}{\cinl{\xi_1}}$ implies $\hpatmatch{e}{\hinlp{p_1}}{\theta}$ for some $\theta$.
        By rule induction over \rulesref{rules:Satisfy} on $\csatisfy{e}{\cinl{\xi_1}}$, no case applies due to syntactic contradiction. \\ Therefore, vacuously true.
        \restorelocalsteps{2}
        \item Prove $\hpatmatch{e}{\hinlp{p_1}}{\theta}$ implies $\csatisfy{e}{\cinl{\xi_1}}$.
        By rule induction over \rulesref{rules:match} on $\hpatmatch{e}{\hinlp{p_1}}{\theta}$, no case applies due to syntactic contradiction. \\ Therefore, vacuously true.
        \restorelocalsteps{2}
        \item Prove $\cmaysatisfy{e}{\cinl{\xi_1}}$ implies $\hmaymatch{e}{\hinlp{p_1}}$.
            \begin{pfsteps*}
            \item $\refutable{\hinlp{p_1}}$ \BY{\ruleref{rule:RInl}} \pflabel{[inl]rft}
            \item $\hmaymatch{e}{\hinlp{p_1}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[inl]notintro} and \pfref{[inl]rft}}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item Prove $\hmaymatch{e}{\hinlp{p_1}}$ implies $\cmaysatisfy{e}{\cinl{\xi_1}}$.
            \begin{pfsteps*}
            \item $\refutable{\hinlp{\xi_1}}$ \BY{\ruleref{rule:RXInl}} \pflabel{[inl]xi-rft}
            \item $\cmaysatisfy{e}{\cinl{\xi_1}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[inl]notintro} and \pfref{[inl]xi-rft}}
            \end{pfsteps*}
        \end{enumerate}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:TInl})}]
        \begin{pfsteps*}
        \item $e=\hinl{\tau_2}{e_1}$ \BY{assumption}
        \item $\hexptyp{\cdot}{\Delta_e}{e_1}{\tau_1}$ \BY{assumption} \pflabel{[inl]e1-typ}
        \item $\isFinal{e_1}$ \BY{\autoref{lem:inl-final} on \pfref{eFinal}} \pflabel{[inl]e1-final}
        \end{pfsteps*}
        By inductive hypothesis on \pfref{[inl]e1-final} and \pfref{[inl]e1-typ} and \pfref{[inl]p1-typ}.
        \begin{pfsteps*}
        \item $\csatisfy{e_1}{\xi_1}$ iff $\hpatmatch{e_1}{p_1}{\theta}$ for some $\theta$ \pflabel{[inl]true-equiv}
        \item $\cmaysatisfy{e_1}{\xi_1}$ iff $\hmaymatch{e_1}{p_1}$ \pflabel{[inl]may-equiv}
        \end{pfsteps*}
        \begin{enumerate}
        \savelocalsteps{2}
        \item Prove $\csatisfy{\hinl{\tau_2}{e_1}}{\cinl{\xi_1}}$ implies $\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta}$ for some $\theta$.
            \begin{pfsteps*}
            \item $\csatisfy{\hinl{\tau_2}{e_1}}{\cinl{\xi_1}}$ \BY{assumption} \pflabel{[inl1]satisfy}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:Satisfy} on \pfref{[inl1]satisfy}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:CSInl})}]
                \begin{pfsteps*}
                \item $\csatisfy{e_1}{\xi_1}$ \BY{assumption} \pflabel{[inl1]satisfy1}
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ for some $\theta_1$ \BY{\pfref{[inl]true-equiv} on \pfref{[inl1]satisfy1}} \pflabel{[inl1]match1}
                \item $\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta_1}$ \BY{\ruleref{rule:MInl} on \pfref{[inl1]match1}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta}$ implies $\csatisfy{\hinl{\tau_2}{e_1}}{\cinl{\xi_1}}$.
            \begin{pfsteps*}
            \item $\hpatmatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}{\theta}$ \BY{assumption} \pflabel{[inl2]match}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:match} on \pfref{[inl2]match}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MInl})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_1}{p_1}{\theta}$ \BY{assumption} \pflabel{[inl2]match1}
                \item $\csatisfy{e_1}{\xi_1}$ \BY{\pfref{[inl]true-equiv} on \pfref{[inl2]match1}} \pflabel{[inl2]satisfy1}
                \item $\csatisfy{\hinl{\tau_2}{e_1}}{\cinl{\xi_1}}$ \BY{\ruleref{rule:CSInl} on \pfref{[inl2]satisfy1}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\cmaysatisfy{\hinl{\tau_2}{e_1}}{\cinl{\xi_1}}$ implies $\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$.
            \begin{pfsteps*}
            \item $\cmaysatisfy{\hinl{\tau_2}{e_1}}{\cinl{\xi_1}}$ \BY{assumption} \pflabel{[inl3]maysat}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:MaySatisfy} on \pfref{[inl3]maysat}, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:CMSNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hinl{\tau_2}{e_1}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-inl-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:CMSInl})}]
                \begin{pfsteps*}
                \item $\cmaysatisfy{e_1}{\xi_1}$ \BY{assumption} \pflabel{[inl3]maysat1}
                \item $\hmaymatch{e_1}{p_1}$ \BY{\pfref{[inl]may-equiv} on \pfref{[inl3]maysat1}} \pflabel{[inl3]maymatch1}
                \item $\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$ \BY{\ruleref{rule:MMInl} on \pfref{[inl3]maymatch1}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$ implies $\cmaysatisfy{\hinl{\tau_2}{e_1}}{\cinl{\xi_1}}$.
            \begin{pfsteps*}
            \item $\hmaymatch{\hinl{\tau_2}{e_1}}{\hinlp{p_1}}$ \BY{assumption} \pflabel{[inl4]maymatch}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:maymatch} on \pfref{[inl4]maymatch}, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hinl{\tau_2}{e_1}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-inl-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMInl})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption} \pflabel{[inl4]maymatch1}
                \item $\cmaysatisfy{e_1}{\xi_1}$ \BY{\pfref{[inl]may-equiv} on \pfref{[inl4]maymatch1}} \pflabel{[inl4]maysat1}
                \item $\cmaysatisfy{\hinl{\tau_2}{e_1}}{\cinl{\xi_1}}$ \BY{\ruleref{rule:CMSInl} on \pfref{[inl4]maysat1}}
                \end{pfsteps*}
            \end{byCases}
        \end{enumerate}
    \end{byCases}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTInr})}]
    \begin{pfsteps*}
    \item $p=\hinrp{p_2}$ \BY{assumption}
    \item $\xi=\cinr{\xi_2}$ \BY{assumption}
    \item $\tau=\tsum{\tau_1}{\tau_2}$ \BY{assumption}
    \item $\chpattyp{p_2}{\tau_2}{\xi_2}{\Gamma}{\Delta}$ \BY{assumption} \pflabel{[inr]p1-typ}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:TExp}) on \pfref{eTyp}, the following cases apply.
    \begin{byCases}
    \savelocalsteps{1}
    \item[\text{(\ref{rule:TEHole}),(\ref{rule:THole}),(\ref{rule:TAp}),(\ref{rule:TFst}),(\ref{rule:TSnd}),(\ref{rule:TMatchZPre}),(\ref{rule:TMatchNZPre})}]
        \begin{pfsteps*}
        \item $e=\hehole{u},\hhole{e_0}{u},\hap{e_1}{e_2},\hfst{e_0},\hsnd{e_0},\hmatch{e_0}{\zrules}$ \BY{assumption}
        \item $\notIntro{e}$ \BY{Rule (\ref{rule:NVEHole}),(\ref{rule:NVHole}),(\ref{rule:NVAp}),(\ref{rule:NVMatch}),(\ref{rule:NVFst}),(\ref{rule:NVSnd})} \pflabel{[inr]notintro}
        \end{pfsteps*}
        \begin{enumerate}
        \savelocalsteps{2}
        \item Prove $\csatisfy{e}{\cinr{\xi_2}}$ implies $\hpatmatch{e}{\hinrp{p_2}}{\theta}$ for some $\theta$.
        By rule induction over \rulesref{rules:Satisfy} on $\csatisfy{e}{\cinr{\xi_2}}$, no case applies due to syntactic contradiction. \\ Therefore, vacuously true.
        \restorelocalsteps{2}
        \item Prove $\hpatmatch{e}{\hinrp{p_2}}{\theta}$ implies $\csatisfy{e}{\cinr{\xi_2}}$.
        By rule induction over \rulesref{rules:match} on $\hpatmatch{e}{\hinrp{p_2}}{\theta}$, no case applies due to syntactic contradiction. \\ Therefore, vacuously true.
        \restorelocalsteps{2}
        \item Prove $\cmaysatisfy{e}{\cinr{\xi_2}}$ implies $\hmaymatch{e}{\hinrp{p_2}}$.
            \begin{pfsteps*}
            \item $\refutable{\hinrp{p_2}}$ \BY{\ruleref{rule:RInr}} \pflabel{[inr]rft}
            \item $\hmaymatch{e}{\hinrp{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[inr]notintro} and \pfref{[inr]rft}}
            \end{pfsteps*}
        \restorelocalsteps{2}
        \item Prove $\hmaymatch{e}{\hinrp{p_2}}$ implies $\cmaysatisfy{e}{\cinr{\xi_2}}$.
            \begin{pfsteps*}
            \item $\refutable{\hinrp{\xi_2}}$ \BY{\ruleref{rule:RXInr}} \pflabel{[inr]xi-rft}
            \item $\cmaysatisfy{e}{\cinr{\xi_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[inr]notintro} and \pfref{[inr]xi-rft}}
            \end{pfsteps*}
        \end{enumerate}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:TInr})}]
        \begin{pfsteps*}
        \item $e=\hinr{\tau_1}{e_2}$ \BY{assumption}
        \item $\hexptyp{\cdot}{\Delta_e}{e_2}{\tau_2}$ \BY{assumption} \pflabel{[inr]e1-typ}
        \item $\isFinal{e_2}$ \BY{\autoref{lem:inl-final} on \pfref{eFinal}} \pflabel{[inr]e1-final}
        \end{pfsteps*}
        By inductive hypothesis on \pfref{[inr]e1-final} and \pfref{[inr]e1-typ} and \pfref{[inr]p1-typ}.
        \begin{pfsteps*}
        \item $\csatisfy{e_2}{\xi_2}$ iff $\hpatmatch{e_2}{p_2}{\theta}$ for some $\theta$ \pflabel{[inr]true-equiv}
        \item $\cmaysatisfy{e_2}{\xi_2}$ iff $\hmaymatch{e_2}{p_2}$ \pflabel{[inr]may-equiv}
        \end{pfsteps*}
        \begin{enumerate}
        \savelocalsteps{2}
        \item Prove $\csatisfy{\hinr{\tau_1}{e_2}}{\cinr{\xi_2}}$ implies $\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta}$ for some $\theta$.
            \begin{pfsteps*}
            \item $\csatisfy{\hinr{\tau_1}{e_2}}{\cinr{\xi_2}}$ \BY{assumption} \pflabel{[inr1]satisfy}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:Satisfy} on \pfref{[inr1]satisfy}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:CSInl})}]
                \begin{pfsteps*}
                \item $\csatisfy{e_2}{\xi_2}$ \BY{assumption} \pflabel{[inr1]satisfy1}
                \item $\hpatmatch{e_2}{p_2}{\theta_1}$ for some $\theta_1$ \BY{\pfref{[inr]true-equiv} on \pfref{[inr1]satisfy1}} \pflabel{[inr1]match1}
                \item $\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta_1}$ \BY{\ruleref{rule:MInl} on \pfref{[inr1]match1}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta}$ implies $\csatisfy{\hinr{\tau_1}{e_2}}{\cinr{\xi_2}}$.
            \begin{pfsteps*}
            \item $\hpatmatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}{\theta}$ \BY{assumption} \pflabel{[inr2]match}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:match} on \pfref{[inr2]match}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MInl})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_2}{p_2}{\theta}$ \BY{assumption} \pflabel{[inr2]match1}
                \item $\csatisfy{e_2}{\xi_2}$ \BY{\pfref{[inr]true-equiv} on \pfref{[inr2]match1}} \pflabel{[inr2]satisfy1}
                \item $\csatisfy{\hinr{\tau_1}{e_2}}{\cinr{\xi_2}}$ \BY{\ruleref{rule:CSInl} on \pfref{[inr2]satisfy1}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\cmaysatisfy{\hinr{\tau_1}{e_2}}{\cinr{\xi_2}}$ implies $\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$.
            \begin{pfsteps*}
            \item $\cmaysatisfy{\hinr{\tau_1}{e_2}}{\cinr{\xi_2}}$ \BY{assumption} \pflabel{[inr3]maysat}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:MaySatisfy} on \pfref{[inr3]maysat}, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:CMSNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hinr{\tau_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-inl-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:CMSInl})}]
                \begin{pfsteps*}
                \item $\cmaysatisfy{e_2}{\xi_2}$ \BY{assumption} \pflabel{[inr3]maysat1}
                \item $\hmaymatch{e_2}{p_2}$ \BY{\pfref{[inr]may-equiv} on \pfref{[inr3]maysat1}} \pflabel{[inr3]maymatch1}
                \item $\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$ \BY{\ruleref{rule:MMInl} on \pfref{[inr3]maymatch1}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$ implies $\cmaysatisfy{\hinr{\tau_1}{e_2}}{\cinr{\xi_2}}$.
            \begin{pfsteps*}
            \item $\hmaymatch{\hinr{\tau_1}{e_2}}{\hinrp{p_2}}$ \BY{assumption} \pflabel{[inr4]maymatch}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:maymatch} on \pfref{[inr4]maymatch}, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hinr{\tau_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-inl-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMInl})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption} \pflabel{[inr4]maymatch1}
                \item $\cmaysatisfy{e_2}{\xi_2}$ \BY{\pfref{[inr]may-equiv} on \pfref{[inr4]maymatch1}} \pflabel{[inr4]maysat1}
                \item $\cmaysatisfy{\hinr{\tau_1}{e_2}}{\cinr{\xi_2}}$ \BY{\ruleref{rule:CMSInl} on \pfref{[inr4]maysat1}}
                \end{pfsteps*}
            \end{byCases}
        \end{enumerate}
    \end{byCases}
\restorelocalsteps{0}
\item[\text{(\ref{rule:PTPair})}]
    \begin{pfsteps*}
    \item $p=\hpair{p_1}{p_2}$ \BY{assumption}
    \item $\xi=\cpair{\xi_1}{\xi_2}$ \BY{assumption}
    \item $\tau=\tprod{\tau_1}{\tau_2}$ \BY{assumption}
    \item $\Gamma=\Gamma_1\uplus \Gamma_2$ \BY{assumption}
    \item $\Delta=\Delta_1\uplus \Delta_2$ \BY{assumption}
    \item $\chpattyp{p_1}{\tau_1}{\xi_1}{\Gamma_1}{\Delta_1}$ \BY{assumption} \pflabel{[pair]p1-typ}
    \item $\chpattyp{p_2}{\tau_2}{\xi_2}{\Gamma_2}{\Delta_2}$ \BY{assumption} \pflabel{[pair]p2-typ}
    \end{pfsteps*}
    By rule induction over Rules (\ref{rules:TExp}) on \pfref{eTyp}, the following cases apply.
    \begin{byCases}
    \savelocalsteps{1}
    \item[\text{(\ref{rule:TEHole}),(\ref{rule:THole}),(\ref{rule:TAp}),(\ref{rule:TFst}),(\ref{rule:TSnd}),(\ref{rule:TMatchZPre}),(\ref{rule:TMatchNZPre})}]
        \begin{pfsteps*}
        \item $e=\hehole{u},\hhole{e_0}{u},\hap{e_1}{e_2},\hfst{e_0},\hsnd{e_0},\hmatch{e_0}{\zrules}$ \BY{assumption}
        \item $\notIntro{e}$ \BY{Rule (\ref{rule:NVEHole}),(\ref{rule:NVHole}),(\ref{rule:NVAp}),(\ref{rule:NVMatch}),(\ref{rule:NVFst}),(\ref{rule:NVSnd})} \pflabel{[epair]notintro}
        \item $\isIndet{e}$ \BY{\autoref{lem:final-notintro-indet} on \pfref{eFinal} and \pfref{[epair]notintro}} \pflabel{[epair]indet}
        \item $\isIndet{\hfst{e}}$ \BY{Rule (\ref{rule:IFst}) on \pfref{[epair]indet}} \pflabel{[epair]fst-indet}
        \item $\isFinal{\hfst{e}}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{[epair]fst-indet}} \pflabel{[epair]fst-final}
        \item $\isIndet{\hsnd{e}}$ \BY{Rule (\ref{rule:ISnd}) on \pfref{[epair]indet}} \pflabel{[epair]snd-indet}
        \item $\isFinal{\hsnd{e}}$ \BY{Rule (\ref{rule:FIndet}) on \pfref{[epair]snd-indet}} \pflabel{[epair]snd-final}
        \item $\hexptyp{\cdot}{\Delta}{\hfst{e}}{\tau_1}$ \BY{Rule (\ref{rule:TFst}) on \pfref{eTyp}} \pflabel{[epair]fst-typ}
        \item $\hexptyp{\cdot}{\Delta}{\hsnd{e}}{\tau_2}$ \BY{Rule (\ref{rule:TSnd}) on \pfref{eTyp}} \pflabel{[epair]snd-typ}
        \end{pfsteps*}
        By inductive hypothesis on \pfref{[pair]p1-typ} and \pfref{[epair]fst-typ} and \pfref{[epair]fst-final} and by inductive hypothesis on \pfref{[pair]p2-typ} and \pfref{[epair]snd-typ} and \pfref{[epair]snd-final}.
        \begin{pfsteps*}
        \item $\csatisfy{\hfst{e}}{\xi_1}$ iff $\hpatmatch{\hfst{e}}{p_1}{\theta_1}$ for some $\theta_1$ \pflabel{[epair]true-equiv1}
        \item $\cmaysatisfy{\hfst{e}}{\xi_1}$ iff $\hmaymatch{\hfst{e}}{p_1}$ \pflabel{[epair]may-equiv1}
        \item $\csatisfy{\hsnd{e}}{\xi_2}$ iff $\hpatmatch{\hsnd{e}}{p_2}{\theta_2}$ for some $\theta_2$ \pflabel{[epair]true-equiv2}
        \item $\cmaysatisfy{\hsnd{e}}{\xi_2}$ iff $\hmaymatch{\hsnd{e}}{p_2}$ \pflabel{[epair]may-equiv2}
        \end{pfsteps*}
        \begin{enumerate}
        \savelocalsteps{2}
        \item Prove $\csatisfy{e}{\cpair{\xi_1}{\xi_2}}$ implies $\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}$ for some $\theta$.
            \begin{pfsteps*}
            \item $\csatisfy{e}{\cpair{\xi_1}{\xi_2}}$ \BY{assumption} \pflabel{[epair1]satisfy}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:Satisfy} on \pfref{[epair1]satisfy}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:CSNotIntroPair})}]
                \begin{pfsteps*}
                \item $\csatisfy{\hfst{e}}{\xi_1}$ \BY{assumption} \pflabel{[epair1]satisfy1}
                \item $\csatisfy{\hsnd{e}}{\xi_2}$ \BY{assumption} \pflabel{[epair1]satisfy2}
                \item $\hpatmatch{\hfst{e}}{p_1}{\theta_1}$ \BY{\pfref{[epair]true-equiv1} on \pfref{[epair1]satisfy1}} \pflabel{[epair1]match1}
                \item $\hpatmatch{\hsnd{e}}{p_2}{\theta_2}$ \BY{\pfref{[epair]true-equiv2} on \pfref{[epair1]satisfy2}} \pflabel{[epair1]match2}
                \item $\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta_1\uplus\theta_2}$ \BY{\ruleref{rule:MNotIntroPair} on \pfref{[epair]notintro} and \pfref{[epair1]match1} and \pfref{[epair1]match2}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}$ implies $\csatisfy{e}{\cpair{\xi_1}{\xi_2}}$.
            \begin{pfsteps*}
            \item $\hpatmatch{e}{\hpair{p_1}{p_2}}{\theta}$ \BY{assumption} \pflabel{[epair2]match}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:match} on \pfref{[epair2]match}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MNotIntroPair})}]
                \begin{pfsteps*}
                \item $\theta=\theta_1\uplus\theta_2$ \BY{assumption}
                \item $\hpatmatch{\hfst{e}}{\xi_1}{\theta_1}$ \BY{assumption} \pflabel{[epair2]match1}
                \item $\hpatmatch{\hsnd{e}}{\xi_2}{\theta_2}$ \BY{assumption} \pflabel{[epair2]match2}
                \item $\csatisfy{\hfst{e}}{\xi_1}$ \BY{\pfref{[epair]true-equiv1} on \pfref{[epair2]match1}} \pflabel{[epair2]satisfy1}
                \item $\csatisfy{\hsnd{e}}{\xi_2}$ \BY{\pfref{[epair]true-equiv2} on \pfref{[epair2]match2}} \pflabel{[epair2]satisfy2}
                \item $\csatisfy{e}{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:CSNotIntroPair} on \pfref{[epair]notintro} and \pfref{[epair2]satisfy1} and \pfref{[epair2]satisfy2}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\cmaysatisfy{e}{\cpair{\xi_1}{\xi_2}}$ implies $\hmaymatch{e}{\hpair{p_1}{p_2}}$.
            \begin{pfsteps*}
            \item $\cmaysatisfy{e}{\cpair{\xi_1}{\xi_2}}$ \BY{assumption} \pflabel{[epair2]satisfy}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:MaySatisfy} on \pfref{[epair2]satisfy}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:CMSNotIntro})}]
                \begin{pfsteps*}
                \item $\refutable{\cpair{\xi_1}{\xi_2}}$ \BY{assumption} \pflabel{[epair3]rft}
                \end{pfsteps*}
                By rule induction over \rulesref{rules:xi-refutable} on \pfref{[epair3]rft}, only two cases apply.
                \begin{byCases}
                \savelocalsteps{3}
                \item[\text{(\ref{rule:RXPairL})}]
                    \begin{pfsteps*}
                    \item $\refutable{\xi_1}$ \BY{assumption} \pflabel{[epair3]rft1}
                    \item $\notIntro{\hfst{e}}$ \BY{\ruleref{rule:NVFst}} \pflabel{[epair3]notintro1}
                    \item $\cmaysatisfy{\hfst{e}}{\xi_1}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[epair3]rft1} and \pfref{[epair3]notintro1}} \pflabel{[epair3]satisfy1}
                    \item $\hmaymatch{\hfst{e}}{p_1}$ \BY{\pfref{[epair]may-equiv1} on \pfref{[epair3]satisfy1}} \pflabel{[epair3]match1}
                    \end{pfsteps*}
                    By rule induction over \rulesref{rules:maymatch} on \pfref{[epair3]match1}, only three cases apply.
                    \begin{byCases}
                    \savelocalsteps{4}
                    \item[\text{(\ref{rule:MMEHole}),(\ref{rule:MMHole})}]
                        \begin{pfsteps*}
                        \item $p_1=\heholep{w},\hholep{p_0}{w}{\tau'}$ \BY{assumption}
                        \item $\refutable{p_1}$ \BY{\ruleref{rule:REHole} and \ruleref{rule:RHole}} \pflabel{[epair3]p-rft1}
                        \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairL} on \pfref{[epair3]p-rft1}} \pflabel{[epair3]p-rft}
                        \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair3]p-rft}}
                        \end{pfsteps*}
                    \restorelocalsteps{4}
                    \item[\text{(\ref{rule:MMNotIntro})}]
                        \begin{pfsteps*}
                        \item $\refutable{p_1}$ \BY{assumption} \pflabel{[epair3]p-rft1'}
                        \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairL} on \pfref{[epair3]p-rft1'}} \pflabel{[epair3]p-rft'}
                        \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair3]p-rft'}}
                        \end{pfsteps*}
                    \end{byCases}
                \restorelocalsteps{3}
                \item[\text{(\ref{rule:RXPairR})}]
                    \begin{pfsteps*}
                    \item $\refutable{\xi_2}$ \BY{assumption} \pflabel{[epair3']rft1}
                    \item $\notIntro{\hsnd{e}}$ \BY{\ruleref{rule:NVFst}} \pflabel{[epair3']notintro1}
                    \item $\cmaysatisfy{\hsnd{e}}{\xi_2}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[epair3']rft1} and \pfref{[epair3']notintro1}} \pflabel{[epair3']satisfy1}
                    \item $\hmaymatch{\hsnd{e}}{p_2}$ \BY{\pfref{[epair]may-equiv2} on \pfref{[epair3']satisfy1}} \pflabel{[epair3']match1}
                    \end{pfsteps*}
                    By rule induction over \rulesref{rules:maymatch} on \pfref{[epair3']match1}, only three cases apply.
                    \begin{byCases}
                    \savelocalsteps{4}
                    \item[\text{(\ref{rule:MMEHole}),(\ref{rule:MMHole})}]
                        \begin{pfsteps*}
                        \item $p_2=\heholep{w},\hholep{p_0}{w}{\tau'}$ \BY{assumption}
                        \item $\refutable{p_2}$ \BY{\ruleref{rule:REHole} and \ruleref{rule:RHole}} \pflabel{[epair3']p-rft1}
                        \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairR} on \pfref{[epair3']p-rft1}} \pflabel{[epair3']p-rft}
                        \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair3']p-rft}}
                        \end{pfsteps*}
                    \restorelocalsteps{4}
                    \item[\text{(\ref{rule:MMNotIntro})}]
                        \begin{pfsteps*}
                        \item $\refutable{p_2}$ \BY{assumption} \pflabel{[epair3']p-rft1'}
                        \item $\refutable{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:RPairR} on \pfref{[epair3']p-rft1'}} \pflabel{[epair3']p-rft'}
                        \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair]notintro} and \pfref{[epair3']p-rft'}}
                        \end{pfsteps*}
                    \end{byCases}
                \end{byCases}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\hmaymatch{e}{\hpair{p_1}{p_2}}$ implies $\cmaysatisfy{e}{\cpair{\xi_1}{\xi_2}}$.
            \begin{pfsteps*}
            \item $\hmaymatch{e}{\hpair{p_1}{p_2}}$ \BY{assumption} \pflabel{[epair4]match}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:maymatch} on \pfref{[epair4]match}, only one case applies.
            \begin{byCases}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\refutable{\hpair{p_1}{p_2}}$ \BY{assumption} \pflabel{[epair4]rft}
                \end{pfsteps*}
                By rule induction over \rulesref{rules:p-refutable} on \pfref{[epair4]rft}, only two cases apply.
                \begin{byCases}
                \savelocalsteps{3}
                \item[\text{(\ref{rule:RPairL})}]
                    \begin{pfsteps*}
                    \item $\refutable{p_1}$ \BY{assumption} \pflabel{[epair4]rft1}
                    \item $\notIntro{\hfst{e}}$ \BY{\ruleref{rule:NVFst}} \pflabel{[epair4]notintro1}
                    \item $\hmaymatch{\hfst{e}}{p_1}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair4]rft1} and \pfref{[epair4]notintro1}} \pflabel{[epair4]match1}
                    \item $\cmaysatisfy{\hfst{e}}{\xi_1}$ \BY{\pfref{[epair]may-equiv1} on \pfref{[epair4]match1}} \pflabel{[epair4]satisfy1}
                    \end{pfsteps*}
                    By rule induction over \rulesref{rules:MaySatisfy} on \pfref{[epair4]satisfy1}, only three cases apply.
                    \begin{byCases}
                    \savelocalsteps{4}
                    \item[\text{(\ref{rule:CMSUnknown})}]
                        \begin{pfsteps*}
                        \item $\xi_1=\cunknown$ \BY{assumption}
                        \item $\refutable{\xi_1}$ \BY{\ruleref{rule:RXUnknown}} \pflabel{[epair4]p-rft1}
                        \item $\refutable{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:RXPairL} on \pfref{[epair4]p-rft1}} \pflabel{[epair4]p-rft}
                        \item $\cmaysatisfy{e}{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[epair]notintro} and \pfref{[epair4]p-rft}}
                        \end{pfsteps*}
                    \restorelocalsteps{4}
                    \item[\text{(\ref{rule:CMSNotIntro})}]
                        \begin{pfsteps*}
                        \item $\refutable{\xi_1}$ \BY{assumption} \pflabel{[epair4]p-rft1'}
                        \item $\refutable{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:RXPairL} on \pfref{[epair4]p-rft1'}} \pflabel{[epair4]p-rft'}
                        \item $\cmaysatisfy{e}{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[epair]notintro} and \pfref{[epair4]p-rft'}}
                        \end{pfsteps*}
                    \end{byCases}
                \restorelocalsteps{3}
                \item[\text{(\ref{rule:RPairR})}]
                    \begin{pfsteps*}
                    \item $\refutable{p_2}$ \BY{assumption} \pflabel{[epair4']rft1}
                    \item $\notIntro{\hsnd{e}}$ \BY{\ruleref{rule:NVFst}} \pflabel{[epair4']notintro1}
                    \item $\hmaymatch{\hsnd{e}}{p_2}$ \BY{\ruleref{rule:MMNotIntro} on \pfref{[epair4']rft1} and \pfref{[epair4']notintro1}} \pflabel{[epair4']satisfy1}
                    \item $\cmaysatisfy{\hsnd{e}}{\xi_2}$ \BY{\pfref{[epair]may-equiv2} on \pfref{[epair4']satisfy1}} \pflabel{[epair4']match1}
                    \end{pfsteps*}
                    By rule induction over \rulesref{rules:MaySatisfy} on \pfref{[epair4']match1}, only three cases apply.
                    \begin{byCases}
                    \savelocalsteps{4}
                    \item[\text{(\ref{rule:CMSUnknown})}]
                        \begin{pfsteps*}
                        \item $\xi_2=\cunknown$ \BY{assumption}
                        \item $\refutable{\xi_2}$ \BY{\ruleref{rule:RXUnknown}} \pflabel{[epair4']p-rft1}
                        \item $\refutable{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:RXPairR} on \pfref{[epair4']p-rft1}} \pflabel{[epair4']p-rft}
                        \item $\cmaysatisfy{e}{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[epair]notintro} and \pfref{[epair4']p-rft}}
                        \end{pfsteps*}
                    \restorelocalsteps{4}
                    \item[\text{(\ref{rule:CMSNotIntro})}]
                        \begin{pfsteps*}
                        \item $\refutable{\xi_2}$ \BY{assumption} \pflabel{[epair4']p-rft1'}
                        \item $\refutable{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:RXPairR} on \pfref{[epair4']p-rft1'}} \pflabel{[epair4']p-rft'}
                        \item $\cmaysatisfy{e}{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:CMSNotIntro} on \pfref{[epair]notintro} and \pfref{[epair4']p-rft'}}
                        \end{pfsteps*}
                    \end{byCases}
                \end{byCases}
            \end{byCases}
        \end{enumerate}
    \restorelocalsteps{1}
    \item[\text{(\ref{rule:TPair})}]
        \begin{pfsteps*}
        \item $e=\hpair{e_1}{e_2}$ \BY{assumption}
        \item $\hexptyp{\cdot}{\Delta_e}{e_1}{\tau_1}$ \BY{assumption} \pflabel{[pair]e1-typ}
        \item $\hexptyp{\cdot}{\Delta_e}{e_2}{\tau_2}$ \BY{assumption} \pflabel{[pair]e2-typ}
        \item $\isFinal{e_1}$ \BY{\autoref{lem:pair-final} on \pfref{eFinal}} \pflabel{[pair]e1-final}
        \item $\isFinal{e_2}$ \BY{\autoref{lem:pair-final} on \pfref{eFinal}} \pflabel{[pair]e2-final}
        \end{pfsteps*}
        By inductive hypothesis on \pfref{[pair]e1-final} and \pfref{[pair]e1-typ} and \pfref{[pair]p1-typ} and by inductive hypothesis on \pfref{[pair]e2-final} and \pfref{[pair]e2-typ} and \pfref{[pair]p2-typ}.
        \begin{pfsteps*}
        \item $\csatisfy{e_1}{\xi_1}$ iff $\hpatmatch{e_1}{p_1}{\theta_1}$ for some $\theta_1$ \pflabel{[pair]true-equiv1}
        \item $\cmaysatisfy{e_1}{\xi_1}$ iff $\hmaymatch{e_1}{p_1}$ \pflabel{[pair]may-equiv1}
        \item $\csatisfy{e_2}{\xi_2}$ iff $\hpatmatch{e_2}{p_2}{\theta_2}$ for some $\theta_2$ \pflabel{[pair]true-equiv2}
        \item $\cmaysatisfy{e_2}{\xi_2}$ iff $\hmaymatch{e_2}{p_2}$ \pflabel{[pair]may-equiv2}
        \end{pfsteps*}
        
        \begin{enumerate}
        \savelocalsteps{2}
        \item Prove $\csatisfy{\hpair{e_1}{e_2}}{\cpair{\xi_1}{\xi_2}}$ implies $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$ for some $\theta$.
            \begin{pfsteps*}
            \item $\csatisfy{\hpair{e_1}{e_2}}{\cpair{\xi_1}{\xi_2}}$ \BY{assumption} \pflabel{[pair1]satisfy}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:Satisfy} on \pfref{[pair1]satisfy}, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:CSPair})}]
                \begin{pfsteps*}
                \item $\csatisfy{e_1}{\xi_1}$ \BY{assumption} \pflabel{[pair1]satisfy1}
                \item $\csatisfy{e_2}{\xi_2}$ \BY{assumption} \pflabel{[pair1]satisfy2}
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ for some $\theta_1$ \BY{\pfref{[pair]true-equiv1} on \pfref{[pair1]satisfy1}} \pflabel{[pair1]match1}
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ for some $\theta_2$ \BY{\pfref{[pair]true-equiv2} on \pfref{[pair1]satisfy2}} \pflabel{[pair1]match2}
                \item $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta_1\uplus\theta_2}$ \BY{\ruleref{rule:MPair} on \pfref{[pair1]match1} and \pfref{[pair1]match2}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:CSNotIntroPair})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$ implies $\csatisfy{\hpair{e_1}{e_2}}{\cpair{\xi_1}{\xi_2}}$.
            \begin{pfsteps*}
            \item $\hpatmatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}{\theta}$ \BY{assumption} \pflabel{[pair2]match}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:match} on \pfref{[pair2]match}, only two cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MPair})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ for some $\theta_1$ \BY{assumption}  \pflabel{[pair2]match1}
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ for some $\theta_2$ \BY{assumption} \pflabel{[pair2]match2}
                \item $\csatisfy{e_1}{\xi_1}$ \BY{\pfref{[pair]true-equiv1} on \pfref{[pair2]match1}} \pflabel{[pair2]satisfy1}
                \item $\csatisfy{e_2}{\xi_2}$ \BY{\pfref{[pair]true-equiv2} on \pfref{[pair2]match2}} \pflabel{[pair2]satisfy2}
                \item $\csatisfy{\hpair{e_1}{e_2}}{\cpair{\xi_1}{\xi_2}}$ \BY{\ruleref{rule:CSPair} on \pfref{[pair2]satisfy1} and \pfref{[pair2]satisfy2}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MNotIntroPair})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\cmaysatisfy{\hpair{e_1}{e_2}}{\cpair{\xi_1}{\xi_2}}$ implies $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$.
            \begin{pfsteps*}
            \item $\cmaysatisfy{\hpair{e_1}{e_2}}{\cpair{\xi_1}{\xi_2}}$ \BY{assumption} \pflabel{[pair3]maysat}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:MaySatisfy} on \pfref{[pair3]maysat}, only four cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:CMSNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:CMSPair1})}]
                \begin{pfsteps*}
                \item $\cmaysatisfy{e_1}{\xi_1}$ \BY{assumption} \pflabel{[pair3]maysat1}
                \item $\csatisfy{e_2}{\xi_2}$ \BY{assumption} \pflabel{[pair3]satisfy2}
                \item $\hmaymatch{e_1}{p_1}$ \BY{\pfref{[pair]may-equiv1} on \pfref{[pair3]maysat1}} \pflabel{[pair3]maymatch1}
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{\pfref{[pair]true-equiv2} on \pfref{[pair3]satisfy2}} \pflabel{[pair3]match2}
                \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMPairL} on \pfref{[pair3]maymatch1} and \pfref{[pair3]match2}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:CMSPair2})}]
                \begin{pfsteps*}
                \item $\csatisfy{e_1}{\xi_1}$ \BY{assumption} \pflabel{[pair3]satisfy1}
                \item $\cmaysatisfy{e_2}{\xi_2}$ \BY{assumption} \pflabel{[pair3]maysat2}
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{\pfref{[pair]true-equiv1} on \pfref{[pair3]satisfy1}} \pflabel{[pair3]match1}
                \item $\hmaymatch{e_2}{p_2}$ \BY{\pfref{[pair]may-equiv2} on \pfref{[pair3]maysat2}} \pflabel{[pair3]maymatch2}
                \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMPairR} on \pfref{[pair3]match1} and \pfref{[pair3]maymatch2}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:CMSPair3})}]
                \begin{pfsteps*}
                \item $\cmaysatisfy{e_1}{\xi_1}$ \BY{assumption} \pflabel{[pair3]maysat1'}
                \item $\cmaysatisfy{e_2}{\xi_2}$ \BY{assumption} \pflabel{[pair3]maysat2'}
                \item $\hmaymatch{e_1}{p_1}$ \BY{\pfref{[pair]may-equiv1} on \pfref{[pair3]maysat1'}} \pflabel{[pair3]maymatch1'}
                \item $\hmaymatch{e_2}{p_2}$ \BY{\pfref{[pair]may-equiv2} on \pfref{[pair3]maysat2'}} \pflabel{[pair3]maymatch2'}
                \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:MMPair} on \pfref{[pair3]maymatch1'} and \pfref{[pair3]maymatch2'}}
                \end{pfsteps*}
            \end{byCases}
        \restorelocalsteps{2}
        \item Prove $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ implies $\cmaysatisfy{\hpair{e_1}{e_2}}{\cpair{\xi_1}{\xi_2}}$.
            \begin{pfsteps*}
            \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{assumption} \pflabel{[pair4]maymatch}
            \end{pfsteps*}
            By rule induction over \rulesref{rules:maymatch} on \pfref{[pair4]maymatch}, only four cases apply.
            \begin{byCases}
            \savelocalsteps{3}
            \item[\text{(\ref{rule:MMNotIntro})}]
                \begin{pfsteps*}
                \item $\notIntro{\hpair{e_1}{e_2}}$ \BY{assumption}
                \end{pfsteps*}
                Contradicts \autoref{lem:no-pair-notintro}.
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairL})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption} \pflabel{[pair4]maymatch1}
                \item $\hpatmatch{e_2}{p_2}{\theta_2}$ \BY{assumption} \pflabel{[pair4]match2}
                \item $\cmaysatisfy{e_1}{\xi_1}$ \BY{\pfref{[pair]may-equiv1} on \pfref{[pair4]maymatch1}} \pflabel{[pair4]maysat1}
                \item $\csatisfy{e_2}{\xi_2}$ \BY{\pfref{[pair]true-equiv2} on \pfref{[pair4]match2}} \pflabel{[pair4]satisfy2}
                \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:CMSPair1} on \pfref{[pair4]maysat1} and \pfref{[pair4]satisfy2}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPairR})}]
                \begin{pfsteps*}
                \item $\hpatmatch{e_1}{p_1}{\theta_1}$ \BY{assumption} \pflabel{[pair4]match1}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption} \pflabel{[pair4]maymatch2}
                \item $\csatisfy{e_1}{\xi_1}$ \BY{\pfref{[pair]true-equiv1} on \pfref{[pair4]match1}} \pflabel{[pair4]satisfy1}
                \item $\cmaysatisfy{e_2}{\xi_2}$ \BY{\pfref{[pair]may-equiv2} on \pfref{[pair4]maymatch2}} \pflabel{[pair4]maysat2}
                \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:CMSPair2} on \pfref{[pair4]satisfy1} and \pfref{[pair4]maysat2}}
                \end{pfsteps*}
            \restorelocalsteps{3}
            \item[\text{(\ref{rule:MMPair})}]
                \begin{pfsteps*}
                \item $\hmaymatch{e_1}{p_1}$ \BY{assumption} \pflabel{[pair4]maymatch1'}
                \item $\hmaymatch{e_2}{p_2}$ \BY{assumption} \pflabel{[pair4]maymatch2'}
                \item $\cmaysatisfy{e_1}{\xi_1}$ \BY{\pfref{[pair]may-equiv1} on \pfref{[pair4]maymatch1'}} \pflabel{[pair4]maysat1'}
                \item $\cmaysatisfy{e_2}{\xi_2}$ \BY{\pfref{[pair]may-equiv2} on \pfref{[pair4]maymatch2'}} \pflabel{[pair4]maysat2'}
                \item $\hmaymatch{\hpair{e_1}{e_2}}{\hpair{p_1}{p_2}}$ \BY{\ruleref{rule:CMSPair3} on \pfref{[pair4]maysat1'} and \pfref{[pair4]maysat2'}}
                \end{pfsteps*}
            \end{byCases}
        \end{enumerate}
    \end{byCases}
\end{byCases}
\resetpfcounter
\end{proof}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "appendix"
%%% End:
