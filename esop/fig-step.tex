% !TEX root= pattern-paper.tex

\begin{figure}[ht]

\judgbox{e \mapsto e'}{$e$ takes an instruction transition to $e'$}

\begin{mathpar}
\Infer{\ITHole}{
  \htrans{e}{e'}
}{
  \htrans{\hhole{e}{u}}{\hhole{e'}{u}}
}

\Infer{\ITApFun}{
  \htrans{e_1}{e_1'}
}{
  \htrans{\hap{e_1}{e_2}}{\hap{e_1'}{e_2}}
}

\Infer{\ITApArg}{
  \isVal{e_1} \\
  \htrans{e_2}{e_2'}
}{
  \htrans{\hap{e_1}{e_2}}{\hap{e_1}{e_2'}}
}

\Infer{\ITAp}{
  \isVal{e_2}
}{
  \hap{\hlam{x}{\tau}{e_1}}{e_2} \mapsto
    [e_2/x]e_1
}

\Infer{\ITPairL}{
  \htrans{e_1}{e_1'}
}{
  \htrans{\hpair{e_1}{e_2}}{\hpair{e_1'}{e_2}}
}

\Infer{\ITPairR}{
  \isVal{e_1} \\
  \htrans{e_2}{e_2'}
}{
  \htrans{\hpair{e_1}{e_2}}{\hpair{e_1}{e_2'}}
}

\Infer{\ITInl}{
  \htrans{e}{e'}
}{
  \htrans{\hinl{\tau}{e}}{\hinl{\tau}{e'}}
}

\Infer{\ITInr}{
  \htrans{e}{e'}
}{
  \htrans{\hinr{\tau}{e}}{\hinr{\tau}{e'}}
}

\Infer{\ITExpMatch}{
  \htrans{e}{e'}
}{
  \htrans{\hmatch{e}{\zrules}}{\hmatch{e'}{\zrules}}
}

\Infer{\ITSuccMatch}{
  \isFinal{e} \\
  \hpatmatch{e}{p_r}{\theta}
}{
  \htrans{
    \hmatch{e}{\zruls{rs_{pre}}{\hrulP{p_r}{e_r}}{rs_{post}}}
  }{
    [\theta](e_r)
  }
}

\Infer{\ITFailMatch}{
  \isFinal{e} \\
  \hnotmatch{e}{p_r}
}{
  \htrans{
    \hmatch{e}{\zruls{rs}{\hrulP{p_r}{e_r}}{\hrulesP{r'}{rs'}}}
  }{
    \hmatch{e}{
      \zruls{
        \rmpointer{\zruls{rs}{\hrulP{p_r}{e_r}}{\cdot}}
      }{r'}{rs'}
    }
  }
}
\end{mathpar}

  \caption{Instruction Transitions}
  \label{fig:step}
\end{figure}
